/*! 20221212133727
* Dynamsoft JavaScript Library
* Product: Dynamsoft Web Twain
* Web Site: https://www.dynamsoft.com
*
* Copyright 2022, Dynamsoft Corporation
* Author: Dynamsoft Support Team
*
* Module: Camera
* Version: 18.0
* 
*/
var Dynamsoft=self.Dynamsoft||{};Dynamsoft.DWT=Dynamsoft.DWT||{};Dynamsoft.aryAddonReadyFun=Dynamsoft.aryAddonReadyFun||[];Dynamsoft.AddonReady=Dynamsoft.AddonReady||function(fn){Dynamsoft.aryAddonReadyFun.push(fn);}; // jshint ignore: line
Dynamsoft.CameraVerInName = '18.0.0.0831';
Dynamsoft.AddonReady(function(DL, nil){if(!DL.product.bHTML5Edition||Dynamsoft.navInfoSync.bIE)return;
/*! 20221212 132344 */var n={757:function(e,t,n){e.exports=n(666)},666:function(t){t=function(o){var c,e=Object.prototype,u=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var i,a,o,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),r=new I(r||[]);return t._invoke=(i=e,a=n,o=r,s=d,function(e,t){if(s===f)throw new Error("Generator is already running");if(s===p){if("throw"===e)throw t;return D()}for(o.method=e,o.arg=t;;){var n=o.delegate;if(n){n=function e(t,n){var r=t.iterator[n.method];if(r===c){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=c,e(t,n),"throw"===n.method))return g;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}r=l(r,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,g;r=r.arg;if(!r)return n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g;{if(!r.done)return r;n[t.resultName]=r.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=c)}n.delegate=null;return g}(n,o);if(n){if(n===g)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(s===d)throw s=p,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s=f;n=l(i,a,o);if("normal"===n.type){if(s=o.done?p:h,n.arg!==g)return{value:n.arg,done:o.done}}else"throw"===n.type&&(s=p,o.method="throw",o.arg=n.arg)}}),t}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}o.wrap=s;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",g={};function v(){}function m(){}function b(){}var t={},_=(a(t,r,function(){return this}),Object.getPrototypeOf),_=_&&_(_(P([]))),y=(_&&_!==e&&u.call(_,r)&&(t=_),b.prototype=v.prototype=Object.create(t));function x(e){["next","throw","return"].forEach(function(t){a(e,t,function(e){return this._invoke(t,e)})})}function w(o,s){var t;this._invoke=function(n,r){function e(){return new s(function(e,t){!function t(e,n,r,i){var a,e=l(o[e],o,n);if("throw"!==e.type)return(n=(a=e.arg).value)&&"object"==typeof n&&u.call(n,"__await")?s.resolve(n.__await).then(function(e){t("next",e,r,i)},function(e){t("throw",e,r,i)}):s.resolve(n).then(function(e){a.value=e,r(a)},function(e){return t("throw",e,r,i)});i(e.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function P(t){if(t){var n,e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(u.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=c,e.done=!0,e}).next=e}return{next:D}}function D(){return{value:c,done:!0}}return a(y,"constructor",m.prototype=b),a(b,"constructor",m),m.displayName=a(b,i,"GeneratorFunction"),o.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,a(e,i,"GeneratorFunction")),e.prototype=Object.create(y),e},o.awrap=function(e){return{__await:e}},x(w.prototype),a(w.prototype,n,function(){return this}),o.AsyncIterator=w,o.async=function(e,t,n,r,i){void 0===i&&(i=Promise);var a=new w(s(e,t,n,r),i);return o.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},x(y),a(y,i,"Generator"),a(y,r,function(){return this}),a(y,"toString",function(){return"[object Generator]"}),o.keys=function(n){var e,r=[];for(e in n)r.push(e);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},o.values=P,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=c)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return a.type="throw",a.arg=n,r.next=e,t&&(r.method="next",r.arg=c),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],a=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var o=u.call(i,"catchLoc"),s=u.call(i,"finallyLoc");if(o&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&u.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}var a=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,r,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(n=i.completion).type&&(r=n.arg,C(i)),r}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:P(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=c),g}},o}(t.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}},r={};function ar(e){var t=r[e];if(void 0!==t)return t.exports;t=r[e]={exports:{}};return n[e](t,t.exports,ar),t.exports}ar.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return ar.d(t,{a:t}),t},ar.d=function(e,t){for(var n in t)ar.o(t,n)&&!ar.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},ar.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){function k(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function S(s){return function(){var e=this,o=arguments;return new Promise(function(t,n){var r=s.apply(e,o);function i(e){k(r,t,n,i,a,"next",e)}function a(e){k(r,t,n,i,a,"throw",e)}i(void 0)})}}var e=ar(757),E=ar.n(e),C=window.Dynamsoft;function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){e.prototype=Object.create(t.prototype),i(e.prototype.constructor=e,t)}function d(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e;throw new TypeError("attempted to use private field on non-instance")}var s=0;function t(e){return"__private_"+s+++"_"+e}var r={code:0,message:"ok."},O={code:80001,message:"The parameter type is wrong."},H={code:80025,message:"The camera class is required."},W={code:80028,message:"The video is shown."},j={code:80033,message:"The options is invalid."},G={code:80034,message:"The file name is invalid."},q="_updateErrorMessage",X="_canvasClick",z="_afterRender",Y="_documentClickUI",Q="_pagerChangedUI",J="__dynamsoft_camera_files",Z="dynamsoft-dvs-file",K="documentScanPage",A={ORIGINAL:"original"},$={scannerViewer:{maxDocuments:20,maxImagesInBuffer:20,fullScreen:!0,enableBorderDetection:!0,polygonStyle:{stroke:"#fe8e14",strokeWidth:"2px",dash:"solid"},headerStyle:{background:"#000000",color:"#ffffff",selectedColor:"#fe8e14"},bodyStyle:{background:"#ffffff"},footerStyle:{background:"#000000",color:"#ffffff",selectedColor:"#fe8e14"},scanButtonStyle:{background:"#fe8e14",color:"#ffffff"},resolution:{visibility:"visible",valueList:[{label:"720P",value:{width:1280,height:720}},{label:"1080P",value:{width:1920,height:1080}},{label:"2K",value:{width:2560,height:1440}},{label:"4K",value:{width:3840,height:2160}}],defaultValue:{width:1280,height:720}},autoDetect:{visibility:"visible",enableAutoDetect:!1,acceptedPolygonConfidence:0,acceptedBlurryScore:0},torch:{visibility:"visible",on:!1,enableTorch:!1},autoScan:{visibility:"visible",enableAutoScan:!1},continuousScan:{visibility:"visible",enableContinuousScan:!0},switchCamera:{visibility:"visible"},loadLocalFile:{visibility:"visible"}},documentEditorSettings:{visibility:"visible",headerStyle:{background:"#000000",color:"#ffffff",selectedColor:"#fe8e14",disabledColor:"#808080"},bodyStyle:{background:"#ffffff"},footerStyle:{background:"#000000",color:"#ffffff",selectedColor:"#fe8e14"},insert:{visibility:"visible",position:"before"},delete:{visibility:"visible"},rotateLeft:{visibility:"visible"},filter:{visibility:"visible",valueList:[{label:"Original",value:A.ORIGINAL,option:{level:1}},{label:"B&W",value:"blackAndWhite",option:{level:1}},{label:"Grayscale",value:"grayscale",option:{level:1}},{label:"Clean",value:"clean",option:{level:1}},{label:"Brightening",value:"brightening",option:{level:1}},{label:"Save Toner",value:"saveToner",option:{level:1}}],applyToAll:{visibility:"visible",enableApplyToAll:!0,label:"Apply to All"},defaultValue:A.ORIGINAL},cropViewer:{visibility:"visible",polygonStyle:{stroke:"#fe8e14",strokeWidth:"2px",dash:"solid"},rotateLeft:{visibility:"visible"},rotateRight:{visibility:"visible"},autoDetectBorder:{visibility:"visible"},apply:{visibility:"visible"}}}},ee="error",te="cropViewer",ne="mainViewer",re=0,g=1,v=2;var B,ie=function(){function e(e){this._updateData(e)}return e.prototype._updateData=function(t){var n=this;Object.keys(t).forEach(function(e){n[e]=t[e]})},e}(),P={OK:{code:0,message:"Successful"},HTTPS_REQUIRED:{code:-4201,message:"HTTPS is required for accessing cameras."},MEDIADEVICES_NOT_IMPL:{code:-4202,message:"The current browser has not implemented the MediaDevices interface."},GETUSERMEDIA_NOT_IMPL:{code:-4203,message:"The current browser has not implemented the getUserMedia interface."},NO_MEMORY:{code:-4204,message:"Not enough memory for this operation."},NO_CAMERA_SELECTED:{code:-4205,message:"No camera is selected."},VIDEO_ELEMENT_REQUIRED:{code:-4206,message:"A Video element is required for this operation."},CAMERA_PLUG_OUT:{code:-4207,message:"The camera is not plugged in."},CAMERA_NOT_OPEN:{code:-4208,message:"The camera is not open."},CAMERA_SETTINGS_NOT_SUPPORT:{code:-4209,message:"The current browser does not support camera settings."},FAILED_GET_USERMEDIA:{code:-4210,message:"Failed to get camera input."},SOURCE_NOT_FOUND:{code:-4211,message:"The camera source can not be found."},VIDEO_NOT_PLAY:{code:-4214,message:"The video must be playing for the capture operation to work."},VIDEO_NOT_STOP:{code:-4215,message:"The video is already playing. Please stop the video before attempting to play it again to a different container."},NO_CAMERA:{code:-4216,message:"No camera is found."},LICENSE_INVALID:{code:-4217,message:"The license is invalid."},MAX_DOCUMENT_LIMIT:{code:-4218,message:"The number of images processed at one time exceeds the maximum limit."},MAX_IMAGES_IN_BUFFER_LIMIT:{code:-4219,message:"The number of images processed exceeded memory limit."},CAPTURE_NO_IMAGE:{code:-4220,message:"No image is found for the capture operation."},IMAGE_FORMAT_INVALID:{code:-4221,message:"The image format is not support."},RESOLUTION_INVALID:{code:-4222,message:"The resolution is not support."}};function ae(e,t){var n,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?oe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),n=0,function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function se(e,t,n,r,i,a,o,s){void 0===s&&(s=!1);var c,u=JSON.parse(JSON.stringify({video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:s?"user":"environment"}}})),r="exact"===r&&!i;if(t&&(u.video.width=((c={})[r?"exact":"ideal"]=t,c)),n&&(u.video.height=((c={})[r?"exact":"ideal"]=n,c)),a&&a.bMobile&&a.bSafari&&i&&(c=Math.max(t||1280,n||720),u.video.width=((i={})[r?"exact":"ideal"]=c,i),delete u.video.height),e)delete u.video.facingMode,u.video.deviceId={exact:e};else if(o&&!s){for(var l,d=["rear","back","rück","arrière","trasera","trás","traseira","posteriore","后面","後面","背面","后置","後置","背置","задней","الخلفية","후","arka","achterzijde","หลัง","baksidan","bagside","sau","bak","tylny","takakamera","belakang","אחורית","πίσω","spate","hátsó","zadní","darrere","zadná","задня","stražnja","belakang","बैक"],h=ae(o);!(l=h()).done;)if("break"===function(){var e=l.value,t=e.label.toLowerCase();if(t&&d.some(function(e){return-1!=t.indexOf(e)})&&/\b0(\b)?/.test(t))return delete u.video.facingMode,u.video.deviceId={ideal:e.deviceId},"break"}())break;!u.video.deviceId&&a.bAndroid&&a.bHarmonyOS&&(delete u.video.facingMode,u.video.deviceId={ideal:o[o.length-1].deviceId})}return u.video.facingMode&&"environment"===(t=(t=(t=u.video.facingMode)instanceof Array&&t.length?t[0]:t).exact||t.ideal||t)&&(u.bFmEnvironment=!!u.video.facingMode),u}function ce(){return ue.apply(this,arguments)}function ue(){return(ue=S(E().mark(function e(t,n,r,i,a,o,s){var c,u,l,d,h,f;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c={},l=u=null,e.prev=3,h=se(t,n,r,i,!1,a,o),e.next=7,le(h,!1,a,o);case 7:if(u=e.sent){e.next=10;break}return e.abrupt("return",c);case 10:if(document&&document.createElement?l=document.createElement("video"):ot(s,P.VIDEO_ELEMENT_REQUIRED),d="exact"===i,a.bFirefox||!d)return l.srcObject=u,e.next=16,l.play();e.next=16;break;case 16:c.type=i,d?(h=u.getVideoTracks()[0],(f=h.getConstraints())&&f.width?(c.height=f.height.exact||f.height,c.width=f.width.exact||f.width):(f=h.getSettings(),c.height=f.height.exact||f.height,c.width=f.width.exact||f.width)):(c.height=l.videoHeight,c.width=l.videoWidth),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),this._fireLog&&this._fireLog("_getResolution exception:"+(e.t0.message||e.t0));case 23:if(u)return a.bFirefox&&(l.srcObject=null),e.next=27,u.getTracks().forEach(function(e){e.stop()});e.next=29;break;case 27:l=u=null;case 29:return e.abrupt("return",c);case 30:case"end":return e.stop()}},e,this,[[3,20]])}))).apply(this,arguments)}function le(){return de.apply(this,arguments)}function de(){return(de=S(E().mark(function e(t,n,r,i){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"boolean"==typeof t.video&&(t.video={}),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia(t);case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),!e.t0.name||"OverconstrainedError"!==e.t0.name){e.next=13;break}if(n)throw e.t0;e.next=12;break;case 12:return e.abrupt("return",null);case 13:return r&&r.bMobile&&r.bSafari?(delete t.video.width,delete t.video.height):t.bFmEnvironment?(delete t.video.facingMode,i&&i.length&&(t.video.deviceId={ideal:i[i.length-1].deviceId})):t.video=!0,e.abrupt("return",navigator.mediaDevices.getUserMedia(t));case 15:case"end":return e.stop()}},e,null,[[1,7]])}))).apply(this,arguments)}function he(){var e;return navigator.mediaDevices&&(null!=(e=navigator.mediaDevices.getSupportedConstraints())&&e.torch)}(e=B=B||{}).iconResolution="dynamsoft-camera-icon-resolution",e.iconAutoDetect="dynamsoft-camera-icon-autoDetect",e.iconClose="dynamsoft-camera-icon-close",e.iconLoad="dynamsoft-camera-icon-loadLocalFile",e.iconSwitch="dynamsoft-camera-icon-switchCamera",e.iconCapture="dynamsoft-camera-icon-scan",e.iconAutoCapture="dynamsoft-camera-icon-autoScan",e.iconContinuous="dynamsoft-camera-icon-continuous",e.iconBack="dynamsoft-camera-icon-back",e.iconArrow="dynamsoft-camera-icon-arrow",e.iconDelete="dynamsoft-camera-icon-remove",e.iconInsert="dynamsoft-camera-icon-insert",e.iconRotateLeft="dynamsoft-camera-icon-rotateLeft",e.iconFilter="dynamsoft-camera-icon-filter",e.iconCrop="dynamsoft-camera-icon-crop",e.iconSave="dynamsoft-camera-icon-save",e.iconRotateRight="dynamsoft-camera-icon-rotateRight",e.iconFullCrop="dynamsoft-camera-icon-autoDetectBorder",e.iconFlash="dynamsoft-camera-icon-flash",e.iconFlashOn="dynamsoft-camera-icon-flashOn",e.iconFlashOff="dynamsoft-camera-icon-flashOff",e.iconNext="dynamsoft-camera-icon-next",e.uiIcon="dynamsoft-camera-ui-icon",e.uiExitMutiple="dynamsoft-camera-ui-exitMutiple",e.uiCapture="dynamsoft-camera-ui-capture",e.uiDetect="dynamsoft-camera-ui-detect",e.uiPrevious="dynamsoft-camera-ui-previous",e.uiNext="dynamsoft-camera-ui-next",e.uiDelete="dynamsoft-camera-ui-delete",e.uiSave="dynamsoft-camera-ui-save",e.displayNone="dynamsoft-camera-display-none",e.fixedFull="dynamsoft-camera-fixed-full",e.font="dynamsoft-camera-font",e.disable="dynamsoft-camera-disable",e.filterDropDown="dynamsoft-camera-filterDropDown",e.buttonMultipleImg="dynamsoft-camera-button-multipleImg",e.filterApplyAll="dynamsoft-camera-filterApplyAll",e.hidden="dynamsoft-camera-display-none",e.previewImg="dynamsoft-camera-previewImg",e.cameraVideo="dynamsoft-camera-cameraVideo",e.cameraCvs="dynamsoft-camera-cameraCvs",e.cameraContainer="dynamsoft-camera-cameraContainer",e.overflowHidden="dynamsoft-camera-overflowHidden",e.relative="dynamsoft-camera-relative",e.cvsContainer="dynamsoft-camera-cvsContainer",e.detectCvs="dynamsoft-camera-detectCvs",e.documentScanPage="dynamsoft-camera-scanPage",e.documentEditPage="dynamsoft-camera-documentEditPage",e.cropPage="dynamsoft-camera-cropPage",e.block="dynamsoft-camera-block",e.capturing="dynamsoft-camera-capturing",e.headerfont="dynamsoft-camera-header-icon-font",e.footerfont="dynamsoft-camera-footer-icon-font",e.headerSelected="dynamsoft-camera-header-selected",e.footerSelected="dynamsoft-camera-footer-selected",e.filterSelectedItem="dynamsoft-camera-filter-selected",e.filterCheckBox="dynamsoft-camera-filter-checkBox",e.filterCheckedBox="dynamsoft-camera-filter-checkedBox",e.ddlSelectedItem="dynamsoft-camera-ddl-selected",e.BUTTON_PREFIX="dynamsoft-camera-button-";var fe=["blobList"];function pe(e){e&&!e.isDestroyed&&e.destroy()}function ge(){return(ge=S(E().mark(function e(t,n){var r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=!0),t){e.next=4;break}return document.body.classList.remove(B.overflowHidden),e.abrupt("return");case 4:if(!t.element){e.next=25;break}if(r=t.container){e.next=15;break}if(t.container=document.body,n)return e.next=11,t.show();e.next=11;break;case 11:return t.element.classList.add(B.fixedFull),document.body.appendChild(t.element),document.body.classList.add(B.overflowHidden),e.abrupt("return");case 15:if(!(r=M(r)?document.getElementById(r):r)){e.next=25;break}if(document.body.classList.contains(B.overflowHidden)&&document.body.classList.remove(B.overflowHidden),document.body===r&&document.body.classList.add(B.overflowHidden),"static"===window.getComputedStyle(r).position&&document.body!==r&&r.classList.add(B.relative),r.appendChild(t.element),t.container=r,n)return e.next=25,t.show();e.next=25;break;case 25:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ve(){return me.apply(this,arguments)}function me(){return(me=S(E().mark(function e(t,n,r){var i,a,o,s,c;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=!1,r&&(i=x(r),a=lt(i,t.imageWidth,t.imageHeight)),s=!1,c={quality:85,returnType:C.Enum_ImageType.IT_BGRA,returnBlob:!1},!a&&r&&(rt(i)&&8==i.length&&(o={points:i}),s=!0),e.abrupt("return",Fe(t,n,o,s,c,!1).then(function(e){return t.imageData=e.src,I(e.result),e.result}));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function be(e,t){var n,r=e.config,r=R(void 0===r?{}:r,"documentEditorSettings.filter"),i=r.defaultValue,i=void 0===i?A.ORIGINAL:i,a=r.applyToAll,r=r.valueList;return(n=(n=a&&a.enableApplyToAll&&M(e.filterApplyToAllValue)&&""!=e.filterApplyToAllValue?e.filterApplyToAllValue:n)||((n=M(t)&&""!=t?t:n)||i))!==A.ORIGINAL&&r.some(function(e){return e.value===n})?n:A.ORIGINAL}function _e(){return(_e=S(E().mark(function e(t,n,r,i){var a,o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((a=be(t,i))===A.ORIGINAL)return e.abrupt("return",{filterValue:a,filterBlob:r});e.next=3;break;case 3:return e.next=5,t.filterHandlerByIImageData(n,r,a);case 5:return o=e.sent,e.abrupt("return",{filterValue:a,filterBlob:o});case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ye(){return xe.apply(this,arguments)}function xe(){return(xe=S(E().mark(function e(r,i,a,o,s,c,u){var l,d,h,f,p,g,v,m,b,_,y;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),!c){e.next=14;break}if(!s){e.next=11;break}e.next=7;var t=r,n={source:t,output:{orgImage:!1,previewImage:{quality:85,width:200,height:200,returnType:C.Enum_ImageType.IT_JPG,returnBlob:!0,nInterplationMethod:5}}};return C.ImageProcWrapper.createImage(n).then(function(e){return t.imageData=e.src,I(e.preview),e.preview});case 7:l=e.sent,l=new ie({oriBlob:c,preview:l}),e.next=12;break;case 11:l=new ie({oriBlob:c});case 12:e.next=21;break;case 14:return s||(d=!1),e.next=17,Fe(r,void 0,void 0,void 0,void 0,d);case 17:h=e.sent,r.imageData=h.src,I(h.result),l=s?(I(h.preview),new ie({oriBlob:h.result,preview:h.preview})):new ie({oriBlob:h.result});case 21:if(h=R(i,"config.scannerViewer"),g=h.enableBorderDetection,g=void 0===g||g,f=r.imageWidth,p=r.imageHeight,g)return e.next=26,Ie(r,i);e.next=40;break;case 26:if(g=e.sent,b=function(e,n,r){return e.map(function(e,t){if(t%2==0)return t=e,t=Math.max(0,e),Math.min(t,n);t=Math.max(0,e);return Math.min(t,r)})}(x(g.cornerPoints),f,p),l.detectArea=b,o||a)return e.next=33,ve(r,void 0,l.detectArea);e.next=38;break;case 33:return v=e.sent,e.next=36,we(v);case 36:m=e.sent,a&&(l.resImage=v,l.resBlob=w(m));case 38:e.next=43;break;case 40:l.detectArea=[0,0,f,0,f,p,0,p],o&&(v=r,m=l.oriBlob),a&&(l.resImage=r,l.resBlob=w(l.oriBlob));case 43:if(o)return e.next=46,function(){return _e.apply(this,arguments)}(i,v,m,u);e.next=51;break;case 46:b=e.sent,_=b.filterValue,y=b.filterBlob,l.filterValue=_,l.filterBlob=y;case 51:return m=v=null,e.abrupt("return",l);case 54:case"end":return e.stop()}},e)}))).apply(this,arguments)}function D(e,t,n,r){T.log("blobToImageData");return Fe(e,t,n,r,{quality:85,returnType:C.Enum_ImageType.IT_BGRA,returnBlob:!1},!1).then(function(e){return I(e.result),e.result})}function we(t){T.log("ImageDataToBlob");var e={quality:85,returnType:C.Enum_ImageType.IT_JPG,returnBlob:!0};return Fe(t,void 0,void 0,void 0,e,!1).then(function(e){return t.imageData=e.src,I(e.result),e.result})}function ke(){return Ce.apply(this,arguments)}function Ce(){return(Ce=S(E().mark(function e(t,n,r){var i,a,o,s,c,u,l,d;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.getCurrentPage()){e.next=3;break}return e.abrupt("return");case 3:if(a=i.getHtmlElement()){e.next=6;break}return e.abrupt("return");case 6:if(o=null==a?void 0:a.querySelector("."+B.buttonMultipleImg)){e.next=9;break}return e.abrupt("return");case 9:if(s=i.queryPreviewImageElement()){e.next=12;break}return e.abrupt("return");case 12:if(!(c=n).preview){e.next=16;break}e.next=26;break;case 16:return e.next=18,D(c.oriBlob);case 18:return l=e.sent,c.detectArea&&(u={cornerPoints:c.detectArea}),e.next=22,Le(t,u,l,!1,!1);case 22:l=e.sent,c.preview=l.preview,delete l.preview,l=null;case 26:return e.next=28,new Promise(function(e,t){var n=s.src;s.src=F.createURL(c.preview),c.detectArea&&s.setAttribute("data",JSON.stringify(c.detectArea)),nt(c),c=null,s.onload=function(){s.onload=null,n&&F.revokeObjectURL(n),e(!0)},s.onerror=function(e){t(e)}});case 28:d=null==o?void 0:o.querySelector(".dynamsoft-camera-imgCount"),0<r?(d.innerText=String(r),d.classList.remove(B.displayNone)):(d.innerText="",d.classList.add(B.displayNone)),d=null==a?void 0:a.querySelector("."+B.BUTTON_PREFIX+"continuousMode"),o.classList.remove(B.displayNone),null!=d&&d.classList.add(B.footerSelected);case 33:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ie(){return Pe.apply(this,arguments)}function Pe(){return(Pe=S(E().mark(function e(t,n){var r,i,a,o,s,c,u,l,d,h;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.imageWidth,i=t.imageHeight,a=n.config.scannerViewer||{},a=a.autoDetect,o=(a=void 0===a?{}:a).acceptedPolygonConfidence,o=void 0===o?80:o,s=a.acceptedBlurryScore,s=void 0===s?80:s,c=n.getAreaDetectCallback()){e.next=7;break}return n.emit(ee,{message:"The detect function is not bind.",code:-4290}),e.abrupt("return",{cornerPoints:[],detectedArea:!1});case 7:return e.next=9,c(t,o,s,void 0,void 0);case 9:return u=e.sent,t.imageData=u.src,l=u.confidence,l=void 0===l?[0]:l,d=u.blurryScore,d=void 0===d?0:d,h=u.cornerPoints,n.emit("documentDetected",u),"function"==typeof a.processFrame?a.processFrame(u,a)?u.detectedArea=!0:(u.detectedArea=!1,u.cornerPoints=[0,0,r,0,r,i,0,i]):l[0]<o/100||d<s||h.every(function(e){return 0===e})?(u.detectedArea=!1,u.cornerPoints=[0,0,r,0,r,i,0,i]):u.detectedArea=!0,e.abrupt("return",u);case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}function De(){return(De=S(E().mark(function e(t,n,r,i,a){var o,s,c;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a===A.ORIGINAL)return e.abrupt("return",n);e.next=2;break;case 2:if(o=r.find(function(e){return e.label===a}),s=i.find(function(e){return e.value===a}),o&&o.handler&&s){e.next=6;break}return e.abrupt("return",n);case 6:return e.next=8,D(n);case 8:return c=e.sent,e.next=11,o.handler(c,s.option);case 11:return c=e.sent,e.abrupt("return",c.result);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Se(){return(Se=S(E().mark(function e(t,n,r,i,a){var o,s,c;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a===A.ORIGINAL)return e.abrupt("return",n);e.next=2;break;case 2:if(o=r.find(function(e){return e.label===a}),s=i.find(function(e){return e.value===a}),o&&o.handler&&s){e.next=6;break}return e.abrupt("return",n);case 6:return e.next=8,o.handler(t,s.option);case 8:return c=e.sent,t.imageData=c.src,I(c.result),e.abrupt("return",c.result);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function u(e,t){var e=e||{},n=e.iconCss,e=e.visibility,e=void 0===e||e;return n&&(t.icon=n),(M(e)&&"hidden"==e.toLowerCase()||!1===e)&&(t.visibility="hidden"),t}function Ee(){return(Ee=S(E().mark(function e(t,n,r,i){var a;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r)return i.blobList,a=function(e,t){if(null==e)return{};for(var n,r={},i=Object.keys(e),a=0;a<i.length;a++)n=i[a],0<=t.indexOf(n)||(r[n]=e[n]);return r}(i,fe),e.next=4,Promise.resolve(r([{iImageData:n,file:U({},a)}]));e.next=8;break;case 4:!1!==e.sent&&t.redirectToHome(),e.next=9;break;case 8:t.redirectToHome();case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ae(){return(Ae=S(E().mark(function e(t,n,r,i){var a,o,s,c,u,l,d,h,f,p,g,v,m,b,_,y,x,w,k,C,I;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.getCurrentPage(),o=t.config.scannerViewer,o=(void 0===o?{}:o).continuousScan,o=void 0===o?{}:o,0==n.length)return e.abrupt("return");e.next=5;break;case 5:if(o.enableContinuousScan||1!=n.length){e.next=20;break}return s=n[0],e.next=9,D(s);case 9:return c=e.sent,e.next=12,ye(c,t,!1,!1,!1,s);case 12:return l=e.sent,l=l.detectArea,l={cornerPoints:l,detectedArea:!0},e.next=17,Be(t,c,!1,l,r,s);case 17:a instanceof N&&a.enableMultiImages(),e.next=56;break;case 20:if(u=a.getImageCount(),l=t.config.scannerViewer||{},h=l.maxDocuments,f=h=void 0===h?20:h,d=n.length,(u+n.length>f||u+n.length>h)&&(t.emit("video-error",P.MAX_IMAGES_IN_BUFFER_LIMIT),d=f-u),h=a.getDvs(),!(0<d)){e.next=56;break}f=be(t,null),v=g=0;case 30:if(v<d)return m=n[v],e.next=34,D(m);e.next=46;break;case 34:return b=e.sent,e.next=37,ye(b,t,!0,!0,!1,m,f);case 37:b=e.sent,_=b.filterBlob,y=b.resBlob,x=b.detectArea,w=b.oriBlob,C=k=void 0,C=Oe(k=i?w:_||y),p=x,h.DataControl.appendSync(r,[{oriData:k.imageData,metadata:C,customData:{oriBlob:w,angle:g,detectArea:x,filterValue:f,resBlob:_||y}}]);case 43:v++,e.next=30;break;case 46:return I={oriBlob:n[d-1],detectArea:p},e.next=49,ke(t,I,u+d);case 49:if(nt(I),I=null,o.enableContinuousScan){e.next=56;break}if(a instanceof N)return a.enableMultiImages(),e.next=56,Ke(null,{dcs:t});e.next=56;break;case 56:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Be(){return Te.apply(this,arguments)}function Te(){return(Te=S(E().mark(function e(n,r,i,a,o,s){var c,u,l,d,h,f,p,g,v,m,b,_,y,x,w,k,C,I;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=n.getCurrentPage(),l=u.options,d=n.config.scannerViewer,d=(void 0===d?{}:d).continuousScan,d=void 0===d?{}:d,h=R(n,"config.documentEditorSettings.cropViewer"),h=h.visibility,h=void 0===h||h,f=r,p=n.config,p=(void 0===p?{}:p).documentEditorSettings,p=void 0===p?{}:p,v=n.config.scannerViewer||{},v=v.maxDocuments,m=v=void 0===v?20:v,g=u.getImageCount()+1,T.log("continuous mode."),m<g||v<g)return T.log("maxImagesInBuffer."),n.emit("video-error",P.MAX_IMAGES_IN_BUFFER_LIMIT),(n.config.scannerViewer.autoScan.enableAutoScan||n.config.scannerViewer.autoDetect.enableAutoDetect)&&(m=n.captureLoop.getLoopType(),n.captureLoop.stopCaptureLoop(),n.captureLoop.changeStyle(),n.captureLoop._setLoopType(m),n.captureLoop.setDisable()),e.abrupt("return");e.next=17;break;case 17:if(d.enableContinuousScan){e.next=61;break}if(n.showLoading("handle sigle image"),T.log("not continuous mode."),n.stop(),h)return T.log("get BlobItem no filter+noPerspective+no preview"),e.next=25,ye(f,n,!1,!1,!1,s);e.next=30;break;case 25:c=e.sent,i&&n.setImageDataBack(f.imageData),c.filterValue=be(n,null),e.next=48;break;case 30:return T.log("get BlobItem filter+Perspective+no preview"),e.next=33,ye(f,n,!0,!0,!1,s);case 33:if(c=e.sent,i&&(n.setImageDataBack(f.imageData),delete f.imageData),m=(v=c).filterBlob,_=v.resBlob,y=c.resImage,(t=c)&&(et(t),tt(t),nt(t)),y&&delete c.resImage,m&&delete c.filterBlob,"hidden"==p.visibility.toString().toLowerCase())return y={blobList:[]},e.next=44,function(){return Ee.apply(this,arguments)}(n,m||_,l.onSaveCapture,y);e.next=48;break;case 44:return n.captureLoop&&n.captureLoop.setIsLooping(!1),n.emit("focusPage"),n.hideLoading("handle sigle image"),e.abrupt("return");case 48:if(n.emit("blurPage"),b=n.getCurrentPage())return b.hide(),_=b.getDvs(),y=c.resBlob||c.oriBlob,_.DataControl.appendSync(o,[{oriData:y.imageData,metadata:Oe(y),customData:{oriBlob:c.oriBlob,detectArea:c.detectArea,filterValue:c.filterValue}}]),e.next=57,b.clickMultipleImage();e.next=57;break;case 57:b instanceof N&&(b.enableMultiImages(),b.setPreviewImageFlag()),n.hideLoading("handle sigle image"),e.next=74;break;case 61:return e.next=63,Le(n,a,f,i,!0);case 63:return x=e.sent,w=(k=x).oriBlob,k=k.detectArea,C=be(n,null),I=Oe(w),u.getDvs().DataControl.appendSync(o,[{oriData:w.imageData,metadata:I,customData:{oriBlob:w,detectArea:k,angle:0,filterValue:C}}]),e.next=72,ke(n,x,g);case 72:nt(x),x=null;case 74:case"end":return e.stop()}var t},e)}))).apply(this,arguments)}function Le(){return Ve.apply(this,arguments)}function Ve(){return(Ve=S(E().mark(function e(s,c,u,l,d){var h,f,p;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.log("package to BlobItem"),s.config.scannerViewer.enableBorderDetection){e.next=5;break}h={},e.next=12;break;case 5:if(!c){e.next=9;break}h=c,e.next=12;break;case 9:return e.next=11,Ie(u,s);case 11:h=e.sent;case 12:f=h.cornerPoints,p=R(s,"config.scannerViewer"),p=p.polygonStyle,p=void 0===p?{stroke:"#fe8e14",strokeWidth:"2px",dashed:"solid"}:p,T.log("get detected preview"),e.next=18;var t,n=u,r=f,i=p,a=d,o="fe8e14";return i&&M(i.stroke)&&0==i.stroke.indexOf("#")&&(o=i.stroke.substr(1)),r&&(i=x(r),t={points:i,lineWidth:5,strokeColor:o}),Fe(n,void 0,t,!1,a,!0).then(function(e){return n.imageData=e.src,e&&(I(e.result),I(e.preview)),e});case 18:return p=e.sent,T.log("get detected preview ok"),l&&(s.setImageDataBack(u.imageData),delete u.imageData),e.abrupt("return",new ie({oriBlob:p.result,preview:p.preview,detectArea:f}));case 22:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Me(e){if(!e)return[];for(var t=0;t<e.length;t++)e[t]=Math.fround(e[t]);return e}function x(e){var t,e=function(e){var t=e.slice().sort(function(e,t){return e.y-t.y})[0],n=e.indexOf(t),r=e[n-1],i=e[n+1];0===n&&(r=e[3]);r={x:t.x-r.x,y:t.y-r.y},i={x:i.x-t.x,y:i.y-t.y},t={x:10,y:0},r=Re(t,r),t=Re(t,i),i=n;r<t&&(i=0===n?3:n-1);return e.slice(i).concat(e.slice(0,i))}(function(e){var n;if(e&&8===e.length)return e=function(e){for(var t=[],n=0;n<e.length;n+=2){var r={x:e[n],y:e[n+1]};t.push(r)}return t}(e),n=function(e){var t={x:0,y:0};return e.forEach(function(e){t.x+=e.x,t.y+=e.y}),t.x/=e.length,t.y/=e.length,t}(e),e.sort(function(e,t){return Math.atan2(e.y-n.y,e.x-n.x)-Math.atan2(t.y-n.y,t.x-n.x)}),e}(e));return t=[],e.forEach(function(e){t.push(e.x,e.y)}),t}function Re(e,t){var n=Math.pow(Math.pow(e.x,2)+Math.pow(e.y,2),.5),r=Math.pow(Math.pow(t.x,2)+Math.pow(t.y,2),.5),e=e.x*t.x+e.y*t.y;return Math.acos(e/(n*r))}function Fe(e,t,n,r,i,a){var o=void 0,o={polygon:o,doPerspective:o,source:{angle:o},output:{orgImage:o,previewImage:o}};return b(e,o.source),o.source.angle=t,n&&rt(n.points)&&8==n.points.length&&(o.polygon=n,r&&(o.doPerspective=!0)),!1!==i&&(i instanceof Object?o.output.orgImage=i:o.output.orgImage={quality:85,returnType:C.Enum_ImageType.IT_JPG,returnBlob:!0}),!1!==a&&(a instanceof Object?o.output.previewImage=a:o.output.previewImage={quality:85,width:200,height:200,returnType:C.Enum_ImageType.IT_JPG,returnBlob:!0,nInterplationMethod:5}),C.ImageProcWrapper.createImage(o)}function m(e){e%=360;return e<0&&(e+=360),e}var T={log:function(e,t,n,r){window.Dynamsoft&&window.Dynamsoft.Lib.debug&&window.Dynamsoft.Lib.log(e,t,n,r)},error:function(e){window.Dynamsoft&&window.Dynamsoft.Lib.error(e)}};function Ne(){return Ue.apply(this,arguments)}function Ue(){return(Ue=S(E().mark(function e(t,n,r,i,a){var o,s,c;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===a&&(a={}),e.next=3,n.DataControl.getData(r);case 3:return s=e.sent,o=s.customData,s=Oe(t),o?i&&(tt(o),nt(o)):o={},a&&(c=i?["angle","detectArea","filterValue","bitDepth"]:["angle","detectArea","filterValue","bitDepth","resBlob","preview"],C.Lib.each(c,function(e){void 0!==a[e]&&(o[e]=a[e])}),!o.oriBlob&&a.oriBlob&&(o.oriBlob=w(a.oriBlob))),n.DataControl.updateSync(r,{oriData:t.imageData,metadata:s,customData:o},!0),e.abrupt("return",!0);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Oe(e){return{width:e.imageWidth,height:e.imageHeight,bitDepth:e.imageBitDepth,resolutionX:e.imageXResolution,resolutionY:e.imageYResolution,rgba:e.rgba,bgra:e.bgra}}function He(e){return{imageWidth:e.width,imageHeight:e.height,imageBitDepth:e.bitDepth,imageXResolution:e.resolutionX,imageYResolution:e.resolutionY}}function We(e){var t=null==e?void 0:e.querySelectorAll(".dynamsoft-camera-preFilter");if(t)for(var n=0;n<t.length;n++){var r=t[n];r&&"IMG"==r.tagName&&r.src&&(F.revokeObjectURL(r.src),r.onload=null,r.parentNode.remove())}}function L(e){var t,n=e.getCurrentPage();!n||(n=n.getHtmlElement())&&((t=null==n?void 0:n.querySelector("."+B.filterDropDown))&&(We(t),e&&e.removeGlobalClickEvent(t),t.remove()),null!=n&&null!=(e=n.querySelector("."+B.filterDropDown))&&e.remove())}function je(){return(je=S(E().mark(function e(t){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.turnOnTorch();case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function Ge(){return(Ge=S(E().mark(function e(t){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.turnOffTorch();case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function qe(){return Xe.apply(this,arguments)}function Xe(){return(Xe=S(E().mark(function e(t){var n,r,i,a,o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t){e.next=3;break}return e.abrupt("return");case 3:if(he()){e.next=5;break}return e.abrupt("return");case 5:if(r=n.config.scannerViewer,r=(void 0===r?{}:r).torch,r=void 0===r?{}:r,i=null==(i=n.getCurrentPage())||null==(i=i.element)?void 0:i.querySelector("."+B.BUTTON_PREFIX+"flashBtn"),a=!1,"hidden"==(null==(o=r.visibility)?void 0:o.toString().toLowerCase())?null!=i&&i.classList.add(B.hidden):null!=i&&i.classList.remove(B.hidden),(a=n.isRunPlaying())?n.getCapabilities().torch?null!=i&&i.classList.remove(B.disable):(r.on=!1,null!=i&&i.classList.add(B.disable)):r.on=!1,o=null==i?void 0:i.querySelector("."+B.iconFlash),!r.on){e.next=22;break}if(a)return e.next=17,function(){return je.apply(this,arguments)}(n);e.next=17;break;case 17:null!=i&&i.classList.add(B.headerSelected),null!=o&&o.classList.remove(B.iconFlashOff),null!=o&&o.classList.add(B.iconFlashOn),e.next=28;break;case 22:if(a)return e.next=25,function(){return Ge.apply(this,arguments)}(n);e.next=25;break;case 25:null!=i&&i.classList.remove(B.headerSelected),null!=o&&o.classList.remove(B.iconFlashOn),null!=o&&o.classList.add(B.iconFlashOff);case 28:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ze(e){var t,n,r;return(C.navInfo.biPhone||C.navInfo.biPad)&&(t=5,n=85,r=3840),C.ImageProcWrapper.getMax4kImage(e,t,n,r)}function Ye(e){var t=e.defaultViewerName,t=void 0===t?te:t,n=e.cropViewer,r=!0,n=(void 0===n?{}:n).visibility,e=e.visibility;return(M(n)&&"hidden"==n.toLowerCase()||M(e)&&"hidden"==e.toLowerCase())&&(r=!1),t=t.toLowerCase(),!(!r||t!=te.toLowerCase())}function Qe(){return(Qe=S(E().mark(function e(t,n,r,i,a){var o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Ye(r))return o={fileName:i,initFileName:i,curIndex:-1,saveData:!1,fromInternal:a},e.next=5,t.showCropPage(o,n);e.next=7;break;case 5:e.next=10;break;case 7:return o={fileName:i,initFileName:i,curIndex:-1,saveData:!1,fromInternal:a,visibility:r.visibility},e.next=10,t.showDocumentEditPage(o,n);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Je(e){if(null!=e)if(M(e)&&e.toLowerCase(),"hidden"===e||!1===e)return!1;return!0}function Ze(e,t){return!M(e)&&t==A.ORIGINAL||e==t}function Ke(e,t){return $e.apply(this,arguments)}function $e(){return($e=S(E().mark(function e(t,n){var r,i;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.dcs,i=r.getCurrentPage()){e.next=4;break}return e.abrupt("return");case 4:return r.hideLoading("handle multiple image"),r.emit("blurPage"),r.stop(),e.next=9,i.clickMultipleImage();case 9:i.setPreviewImageFlag();case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function et(e){e&&e.oriBlob&&(delete e.oriBlob.imageData,delete e.oriBlob)}function tt(e){e&&e.resBlob&&(delete e.resBlob.imageData,delete e.resBlob)}function nt(e){e&&e.preview&&(it(e.preview)&&delete e.preview.imageData,delete e.preview)}function w(t){var n;return t&&(it(t)&&t.imageData?(n={},C.Lib.each(["imageHeight","imageWidth","imageBitDepth","imageXResolution","imageYResolution","rgba","bgra","imageData"],function(e){void 0!==t[e]&&(n[e]=t[e])})):n=t),n}function I(e){e&&(delete e.code,delete e.message)}function rt(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}function it(e){return"[object Object]"===Object.prototype.toString.call(e)}function V(e){return"function"==typeof e}function M(e){return"string"==typeof e}function at(e){return"number"==typeof e&&!Number.isNaN(e)}function b(e,t){for(var n in e)void 0===t[n]?t[n]=e[n]:it(e[n])&&it(t[n])?b(e[n],t[n]):void 0!==e[n]&&(t[n]=e[n]);return t}function h(e){if(null==e||"object"!=typeof e)return e;var t,n,r;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array){for(t=[],r=e.length,n=0;n<r;n++)t[n]=h(e[n]);return t}if(e instanceof Object){for(n in t={},e)e.hasOwnProperty(n)&&(t[n]=h(e[n]));return t}return at(e)||"[object Boolean]"===Object.prototype.toString.call(e)?e:M(e)?new String(e):{}}function ot(e,t){e&&e.emit(ee,t)}function R(e,t){return t.split(".").reduce(function(e,t){return e[t]||{}},e)}function st(e){var t,n,r;return(C.navInfo.biPhone||C.navInfo.biPad)&&(t=5,n=85,r=3840),C.ImageProcWrapper.getMax4kImage(e,t,n,r)}var ct="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";var F={windowURL:window.URL||window.webkitURL,createURL:function(e){return M(e)?e:function(e){if(M(e)||void 0===e)return{type:"string",data:e};{if(e instanceof Blob)return{type:"object",data:F.createObjectURL(e)};if(e.imageData&&e.imageData instanceof Blob)return{type:"object",data:F.createObjectURL(e.imageData)}}if(e.imageData){var t=Object.prototype.toString.call(e.imageData);if(/\[object \w*Array\w*\]/.test(t))return{type:"object",data:F.createObjectURL(new Blob([e.imageData]))}}else{t=Object.prototype.toString.call(e);if(/\[object \w*Array\w*\]/.test(t))return{type:"object",data:F.createObjectURL(new Blob([e]))}}if(/data:image\/\w+;base64/.test(e))return{type:"string",data:e};return{type:"object",data:e}}(e).data},createObjectURL:function(e){if(!e)return"";e=F.windowURL.createObjectURL(e);return T.log("createObjectURL:"+e),e},revokeObjectURL:function(e){T.log("revokeObjectURL:"+e),M(e)&&0==e.indexOf("blob:http")&&F.windowURL.revokeObjectURL(e)}};function ut(e){var t=Math.random().toString(35).substring(2);return t.length<11&&(t+=Math.random().toString(35).substring(2)),e=Math.max(Math.min(Math.round(e),11),8),t=t.substring(0,e)}function _(e,t){if(e==t)return 1;var n=!1;if(rt(e)&&rt(t)){var r=e.length;if(r==t.length)for(var n=!0,i=0;i<r;i++)if(!l(e[i],t[i])){n=!1;break}}return n}function l(e,t,n){return void 0===n&&(n=1),Math.abs(e-t)<n}function lt(e,t,n){var r,i,a,o,s,c,u;return!(!rt(e)||8!=e.length)&&(r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],u=e[6],e=e[7],l(r,0)&&l(i,0)&&l(a,t)&&l(o,0)&&l(s,t)&&l(c,n)&&l(u,0)&&l(e,n))}var e=function(){function e(e){this._evtIds=[],this._oPub=null,this._bDisposePub=!1,e?this._oPub=e:(this._oPub=new dt,this._bDisposePub=!0)}var t=e.prototype;return t.getPublishSubscribe=function(){return this._oPub},t._on=function(e,t){t=this._oPub.on(e,t);this.push(e,t)},t._emit=function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];null!=(t=this._oPub)&&t.emit.apply(t,[e].concat(r))},t._off=function(e,t){var n;null!=(n=this._oPub)&&n.off(e,t)},t.push=function(e,t){this._evtIds.push({name:e,id:t})},t.dispose=function(){if(this._oPub){for(var e=this._evtIds.length,t=0;t<e;t++){var n=this._evtIds[t];this._oPub.offById(n.name,n.id)}this._bDisposePub&&this._oPub&&this._oPub.dispose()}this._oPub=null},e}(),dt=function(){function e(){this._events={}}var t=e.prototype;return t.on=function(e,t,n){this._events[e]||(this._events[e]=[]);var r=ut(10);return this._events[e].push({fn:t,once:n,evtId:r}),r},t.once=function(e,t){this.on(e,t,!0)},t.emit=function(e){var t=this._events[e];if(!t||0===t.length)return!1;for(var n=t.length,r=arguments.length,i=new Array(1<r?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];for(var o=0;o<n;o++){var s,c=t[o];c&&((s=c.fn).call.apply(s,[null].concat(i)),c.once&&(t.splice(o,1),o--))}},t.emitEx=function(e){var n=this._events[e];if(!n||0===n.length)return Promise.resolve(!0);for(var t=n.length,r=Promise.resolve(!0),i=arguments.length,a=new Array(1<i?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(1===n.length)return(e=null==(e=n[0])?void 0:(e=e.fn).call.apply(e,[null].concat(a)))instanceof Promise?e:r;for(var s=0;s<t;s++){var c=n[s];c&&!function(){var e,t=(e=c.fn).call.apply(e,[null].concat(a));t instanceof Promise&&(r=r.then(function(){return t})),c.once&&(n.splice(s,1),s--)}()}return r},t.off=function(e,t){var n=this._events[e];if(!n)return!1;if(t)for(var r=n.length-1;0<=r;r--){var i=n[r];i&&i.fn===t&&n.splice(r,1),i=null}else n&&(n.length=0)},t.offById=function(e,t){var n=this._events[e];if(!n)return!1;if(t)for(var r=n.length-1;0<=r;r--){var i=n[r];if(i&&i.evtId===t){n.splice(r,1);break}i=null}else n&&(n.length=0)},t.dispose=function(){for(var e=Object.keys(this._events),t=0,n=e.length;t<n;t++){var r=e[t],r=this._events[r];r&&r.splice(0),r=null}this._events={}},e}(),ht=function(){function e(e,t){this.name="",this.icon="",this.text="",this.color="",this.className="",this.onclick=null,this.element=null,this.options=e,this.context=t,this.element=this._initEl()}var t=e.prototype;return t._initEl=function(){var e,t,n,r,i,a,o,s,c,u,l=this.options,d=l.icon,h=l.text,f=l.colorStyle,p=l.className,g=l.bHeader,v=l.onclick,m=l.name,b=l.onmount,_=l.onunmount,y=l.dropdown,x=l.order,x=void 0===x?0:x,w=l.onSelected,k=l.isSelected,k=void 0!==k&&k,l=l.visibility,l=void 0===l?"visible":l,C=this.context,I=document.createElement("div");if(this.name=m,"capture"==this.name&&(I.style.background=f.background),p){if("hidden"===l)return I.className=p+" "+B.block,I;I.className=p}I.style.order=String(x);var m=I,l=d,p=f.color,d=(l&&((x=document.createElement("i")).className=l,x.style.color=p,m.appendChild(x)),I),l=h;return l&&((p=document.createElement("p")).innerText=l,d.appendChild(p)),e=I,n=C,r=k,(t=b)&&setTimeout(function(){t(e,n,r)},0),_&&(this._unmount=_.bind(null,I,C)),i=v,a=C,I.addEventListener("click",function(e){M(i)?a.dcs.emit(i,e,a):V(i)&&i(e,a),e.preventDefault()}),s=w,c=C,m=k,x=g,(u=o=I).bSelected=m,u.bHeader=x,s&&(m&&(x?o.classList.add(B.headerSelected):o.classList.add(B.footerSelected)),o.addEventListener("click",function(e){u.bSelected=!u.bSelected,u.bHeader?o.classList[u.bSelected?"add":"remove"](B.headerSelected):o.classList[u.bSelected?"add":"remove"](B.footerSelected),null!=s&&s(u.bSelected,c),e.preventDefault()})),function(){ft.apply(this,arguments)}(I,C,y,f),I},t.destroy=function(){var e;null!=(e=this._unmount)&&e.call(this),this.element=null},t.update=function(){var e,t;this.element&&(t=this._initEl(),null!=(e=this.element.parentElement)&&e.insertBefore(t,this.element),this.element.remove(),this.element=t)},t.setSelected=function(e){var t=this.options.onSelected;t&&t(e,this.context)},e}();function ft(){return(ft=S(E().mark(function e(t,n,r,i){var a,o,s,c,u,l,d,h;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,h=function(t,n,r){n.dataset.showDropdown="false",t.onclick=function(e){"true"!=n.dataset.showDropdown&&(n.classList.remove(B.displayNone),t.classList.add(B.headerSelected),n.dataset.showDropdown="true",e.stopPropagation(),r.dcs.addGlobalClickEvent(n,function(){return!(!n||"true"!=n.dataset.showDropdown)&&(n.classList.add(B.displayNone),n.parentElement.classList.remove(B.headerSelected),n.dataset.showDropdown="false",r.dcs.emit("hideResolutionList"),!0)}))}},d=function(r,i,a,o){void 0===i&&(i=!1);for(var s=[],e=r.children,t=0;t<e.length;t++)e[t].classList.contains(B.ddlSelectedItem)&&s.push(e[t]);var c=!0;function u(e,t){e.classList[t?"add":"remove"](B.ddlSelectedItem)}r.onclick=function(e){var t,n=!1;if(e instanceof MouseEvent){if(e.stopPropagation(),!c)return;t=e.target,n=!0}else t=e;if("LI"===(null==(e=t)?void 0:e.tagName)){c=!1;var e=s.indexOf(t);if(-1<e){if(!i)return void(c=!0);s.splice(e,1),u(t,!0)}else if(i)s.push(t),u(t,!0);else{for(;s.length;)u(s.pop(),!1);u(t,!0),s.push(t),r&&(r.parentElement.classList.remove(B.headerSelected),r.classList.add(B.displayNone),r.dataset.showDropdown="false",o.dcs.emit("hideResolutionList",r,o))}n&&(e=null==a?void 0:a(t,t.customData,o),Promise.resolve(e).then(function(){c=!0}))}}},l=function(e){var a=document.createDocumentFragment();return e.forEach(function(e,t){var n=document.createElement("li"),r=e.value,i=e.innerHtml;n.customData=r,e.isSelected&&n.classList.add(B.ddlSelectedItem),i?n.innerHTML=i:((r=document.createElement("i")).style.pointerEvents="none",r.className=e.icon||"",(i=document.createElement("p")).style.pointerEvents="none",i.innerText=e.text||"",n.appendChild(r),n.appendChild(i)),a.appendChild(n)}),a},r){e.next=6;break}return e.abrupt("return");case 6:return s=r.list,a=r.multiple,o=r.onclick,e.next=9,s(t,n);case 9:if(e.t0=e.sent,e.t0){e.next=12;break}e.t0=[];case 12:s=e.t0,c=l(s),(u=null==t?void 0:t.querySelector("dropdown"))?(u.removeEventListener("click",null),u.childNodes&&u.childNodes.forEach(function(e){e.remove()}),u.appendChild(c)):((u=document.createElement("ul")).className="resolutionList dropdown "+B.displayNone,u.style.background=i.background,u.style.color=i.color,u.appendChild(c),t.appendChild(u)),h(t,u,n),d(u,a,o,n),e.next=29;break;case 20:return e.prev=20,e.t1=e.catch(0),T.log("Error Begin---"),T.log(e.t1),T.log(t),T.log(n),T.log(r),T.log("Error End---"),e.abrupt("return",null);case 29:case"end":return e.stop()}},e,null,[[0,20]])}))).apply(this,arguments)}var pt="dvsDb",gt="dvsDoc",vt=function(){function e(e,t){this._db=e.DataControl._db,t?this.syncDb={}:((e=this._db.DBMng._d)[pt]||(e[pt]={}),e[pt][gt]||(e[pt][gt]={}),this.syncDb=e[pt][gt])}var t=e.prototype;return t.setCustomDataSync=function(e,t){if(this.syncDb)return this.syncDb[e].customData=t,!0},t.getCustomDataSync=function(e){return this.syncDb&&this.syncDb[e]&&this.syncDb[e].customData?this.syncDb[e].customData:null},t.getOriDataSync=function(e){return this.syncDb&&this.syncDb[e]?this.syncDb[e].oriData:null},t.getDataRootSync=function(e){return this.syncDb&&this.syncDb[e]?this.syncDb[e]:null},t.getMetaDataSync=function(e){if(this._db)return this._db.getMetadata(e)},t.removeMidSync=function(e){var t,n=this._db.middle._d;n&&(n=n[e])&&((t=n.customData)&&(et(t),tt(t),nt(t),delete n.customData),M(n.oriData)&&F.revokeObjectURL(n.oriData),M(n.minData)&&F.revokeObjectURL(n.minData),delete n.oriData,delete n.minData,(t=n.img)&&(t.src=ct,t.onload=null,t.onerror=null,n.img=null)),this._db.removeMid(e),this._db.removeMetadata(e)},t.removeSync=function(e){var t;this.syncDb&&this.syncDb[e]&&((t=this.syncDb[e])&&(delete t.oriData,et(t.customData),tt(t.customData),nt(t.customData),t.metadata&&delete t.metadata,t.tags&&(t.tags.slice(0),delete t.tags)),delete this.syncDb[e]),this.removeMidSync(e)},t.dispose=function(){this._db=null,this.syncDb=null},e}(),mt=function(){function e(e){this._fileTree=e._tree}var t=e.prototype;return t.createFile=function(e){if(this._fileTree)return this._fileTree.createFile(e)},t.openFile=function(e){if(!this._fileTree)return[];e=this._fileTree.findChild(this._fileTree.dfNode,e);return e&&"file"===e.type?e.chs.slice():[]},t.findFile=function(e){if(!this._fileTree)return[];if(this._fileTree.dfNode){e=this._fileTree.findChild(this._fileTree.dfNode,e);if(e&&"file"===e.type)return e}return null},t.replaceFileContent=function(e,t){e=this.findFile(e);e&&(e.chs.splice(0),e.chs=t)},t.getFileCount=function(e){e=this.findFile(e);return e?e.chs.length:0},t.getIndexByUidInFile=function(e,t){var n=this.findFile(e);if(n)for(var r=n.chs.length,i=0;i<r;i++)if(n.chs[i]==t)return i;return-1},t.removeByIndexInFile=function(e,t){e=this.findFile(e);if(e){var n=e.chs.length;if(0<=t&&t<n)return e.chs.splice(t,1)}return null},t.removeFile=function(e,t){if(e&&t)for(var n,r=this.openFile(t),i=0;i<r.length;i++)n=r[i],e.removeSync(n)},t.dispose=function(){this._fileTree=null},e}(),n=function(){function e(e,t,n){this.element=null,this.headerButtons=[],this.footerButtons=[],this.className="",this.pageName="",this.container=null,this.isDestroyed=!1,this._fileWrapper=null,this._dvsWrapper=null,this.template="",this._dcs=null,this._dvs=null,this._pagepubsub=new dt,this._dvsWrapper=new vt(t),this._fileWrapper=new mt(t.File),this.initPageOption(e,n),this._dcs=n,this._dvs=t}var t=e.prototype;return t.initPageOption=function(e,t){this.options=e},t.getDcs=function(){return this._dcs},t.getDvs=function(){return this._dvs},t.getHeaderButtons=function(){return[]},t.getFooterButtons=function(){return[]},t.getOptionsEl=function(){return null},t.createEl=function(){this.headerButtons=this.getHeaderButtons(),this.footerButtons=this.getFooterButtons(),this.container=this.getOptionsEl(),this.element||(e=this.template,(t=document.createElement("div")).innerHTML=e,t.className=this.className,this.element=t);var e,t=null==(e=this.element)?void 0:e.querySelector("header"),t=(this.insertButtons(t,this.headerButtons),null==(e=this.element)?void 0:e.querySelector("footer"));this.insertButtons(t,this.footerButtons)},t.insertButtons=function(e,t){var n;e.appendChild((e=t,n=document.createDocumentFragment(),e.forEach(function(e){n.appendChild(e.element)}),n))},t.destroy=function(){this.isDestroyed=!0,this._dvsWrapper&&this._dvsWrapper.dispose(),this._dvsWrapper=null,this._fileWrapper&&this._fileWrapper.dispose(),this._fileWrapper=null,bt(this.headerButtons),bt(this.footerButtons),this.headerButtons=[],this.footerButtons=[],this.element&&(this.element.parentElement&&this.element.parentElement.childNodes&&1==this.element.parentElement.childNodes.length?this.element.parentElement.remove():(this.element.remove(),this.element=null)),"documentScanPage"==this.pageName&&(L(this._dcs),this._dcs.emit("video-closed")),L(this._dcs),this._dcs=null},t.hide=function(){var e;null!=(e=this.element)&&e.classList.add(B.displayNone)},t.show=function(){var e=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:null!=(t=this.element)&&t.classList.remove(B.displayNone);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.updateButton=function(e,t){for(var n=[].concat(this.headerButtons,this.footerButtons),r=0;r<n.length;r++){var i=n[r];if(i.name===e)return b(t,i.options),void i.update()}},t.on=function(e,t){this._pagepubsub.on(e,t)},t.once=function(e,t){this._pagepubsub.once(e,t)},t.off=function(e,t){this._pagepubsub.off(e,t)},t.emit=function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this._pagepubsub).emit.apply(t,[e].concat(r))},t.emitEx=function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=this._pagepubsub).emitEx.apply(t,[e].concat(r))},t.setDefaultBackgroundColors=function(e,t,n){e.background||(e.background="#000"),t.background||(t.background="#323232"),n.background||(n.background="#000")},t.createIconItems=function(e,t,n,r){var i,a=[],o={dcs:this._dcs,page:this};for(i in e)e[i]&&(e[i].colorStyle="capture"==i&&r?r:t,e[i].bHeader=n,a.push(new ht(U({},e[i],{name:i}),o)));return a},t.getHtmlElement=function(){return this.element},e}();function bt(n){n.forEach(function(e,t){e.destroy(),n[t]=null})}function _t(){return{icon:B.font+" "+B.iconLoad,onclick:(n=S(E().mark(function e(t,n){var r,i,a,o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.dcs,!(o=r.getLoadCallback())){e.next=18;break}if(e.prev=3,i=r.getCurrentPage())return r.emit("blurPage"),a=i.options.documentEditorSettings,a=Ye(void 0===a?{}:a),e.next=11,o(n);e.next=13;break;case 11:(o=e.sent)&&!i.isDestroyed&&kt(o,r,a);case 13:return e.prev=13,r.emit("focusPage"),e.finish(13);case 16:e.next=19;break;case 18:!function(t){var n=document.createElement("input");n.style.display="none",document.body.appendChild(n),n.addEventListener("click",function(e){e.stopPropagation()}),n.type="file",n.multiple=!0,n.accept="image/png,image/jpeg,image/jpg",n.click(),n.onchange=function(){var e;""!=n.value&&((e=t.dcs).showLoading("load local image"),e.emit("blurPage"),yt({el:n,context:t,callback:xt})),document.body.removeChild(n)}}((t.target,n));case 19:case"end":return e.stop()}},e,null,[[3,,13,16]])})),function(e,t){return n.apply(this,arguments)}),className:B.BUTTON_PREFIX+"loadBtn",text:"Load"};var n}function yt(e){e.context.dcs.captureLoop.getIsLooping()?setTimeout(yt,200,e):e.callback.apply(null,[e.el,e.context])}function xt(e,t){return wt.apply(this,arguments)}function wt(){return(wt=S(E().mark(function e(t,n){var r,i,a,o,s,c,u;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.dcs,i=t.files,e.prev=2,a=r.getCurrentPage(),a=a.options.documentEditorSettings,a=Ye(void 0===a?{}:a),s=!(o=[]),c=0;case 9:if(!(c<i.length)){e.next=22;break}if("application/pdf"==(u=i[c]).type||"image/tiff"==u.type)return 0==s&&r.emit("video-error",P.IMAGE_FORMAT_INVALID),s=!0,e.abrupt("continue",19);e.next=15;break;case 15:return e.next=17,st(i[c]);case 17:u=e.sent,o.push(u);case 19:c++,e.next=9;break;case 22:0<o.length&&!n.page.isDestroyed&&kt(o,r,a);case 23:return e.prev=23,r.hideLoading("load local image"),t.value=null,t.files=null,t.onchange=null,t=null,r.emit("focusPage"),e.finish(23);case 31:case"end":return e.stop()}},e,null,[[2,,23,31]])}))).apply(this,arguments)}function kt(){Ct.apply(this,arguments)}function Ct(){return(Ct=S(E().mark(function e(t,n,r){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.showLoading("handleBlobList"),!function(){return Ae.apply(this,arguments)}(n,t,J,r).finally(function(){n.hideLoading("handleBlobList")});case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function It(){return{icon:B.font+" "+B.iconCapture,className:B.BUTTON_PREFIX+"captureBtn",onclick:function(e,t){t.dcs.captureLoop.startManualCapture(t)}}}function Pt(){return{icon:B.font+" "+B.iconClose,className:B.BUTTON_PREFIX+"closeBtn",onclick:(n=S(E().mark(function e(t,n){var r,i,a,o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.dcs,i=n.page,a=!1,0<i.getImageCount()&&(a=!0),i.pageName==K&&r.config.scannerViewer.funcConfirmExit)return e.next=6,r.config.scannerViewer.funcConfirmExit(a);e.next=13;break;case 6:if((o=e.sent)==re)return e.abrupt("return");e.next=11;break;case 11:if(o!=g&&o!=v)return e.abrupt("return");e.next=13;break;case 13:if(void 0===o&&(o=g),i._isClosed)return e.next=17,r.navigateBack();e.next=18;break;case 17:return e.abrupt("return");case 18:return i._isClosed=!0,r.emit("blurPage"),r.stop(),e.next=23,r.navigateBack();case 23:i.pageName!=K||o!=g&&o!=v||r.exit(i.getDvs());case 24:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)})};var n}function Dt(){return{icon:B.font+" "+B.iconSwitch,onclick:function(e,t){var n=t.dcs,t=(n.emit("blurPage"),n.showLoading("switch camera button click"),n.config.scannerViewer.resolution.defaultValue);n.toggleCamera(t.width,t.height).finally(S(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.hideLoading("switch camera button click"),n.emit("focusPage"),e.next=4,qe(n);case 4:case"end":return e.stop()}},e)})))},className:B.BUTTON_PREFIX+"toggleCamera",text:"Switch Camera"}}function St(){return{icon:B.font+" "+B.iconAutoCapture,className:B.BUTTON_PREFIX+"autoCapture",onmount:function(e,t){},onSelected:function(e,t){var n=t.dcs,r=n.config;e?(r.scannerViewer.autoDetect.enableAutoDetect=!0,r.scannerViewer.autoScan.enableAutoScan=!0):r.scannerViewer.autoScan.enableAutoScan=!1,n.captureLoop.loadLoopTypeFromConfig(),n.captureLoop.startLoop(t)}}}function Et(){return{icon:B.font+" "+B.iconResolution,className:B.BUTTON_PREFIX+"resBtn",dropdown:{multiple:!1,list:function(e,t){var s=t.dcs;return new Promise(function(o,e){s.once("onPlayed",S(E().mark(function e(){var t,n,r,i,a;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=R(s,"config.scannerViewer.resolution"),t=n.valueList,n=n.defaultValue,s.showLoading("resolution list"),e.prev=3,t&&t.length){e.next=12;break}return e.next=7,s.getResolution();case 7:r=e.sent,n=n||{width:1280,height:720},t=r.map(function(e){return{label:e.width+"×"+e.height,value:e}}),e.next=13;break;case 12:n=n||t[t.length-1].value;case 13:if((i=At(n,t))<0)return e.next=17,s.getCurrentResolution();e.next=35;break;case 17:if(!(a=e.sent)||a.width==n.width&&a.height==n.height){e.next=34;break}return e.prev=19,e.next=22,s.setResolution(n);case 22:return e.next=24,s.getCurrentResolution();case 24:a=e.sent,(i=At(a,t))<0&&(t.push({value:a,label:a.width+"×"+a.height}),i=t.length-1),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(19);case 32:e.next=35;break;case 34:i<0&&(t.push({value:a,label:a.width+"×"+a.height}),i=t.length-1);case 35:o(t.map(function(e,t){return{value:e.value,text:e.label,icon:"checkBox",isSelected:t===i}}));case 36:return e.prev=36,s.hideLoading("resolution list"),e.finish(36);case 39:case"end":return e.stop()}},e,null,[[3,,36,39],[19,29]])}))),s.on("resetResolution",function(){var e,t=s.config.scannerViewer.resolution.defaultValue,n=s.config.scannerViewer.resolution.valueList,r=At(t,n),t=(r<0&&(n.push({value:t,label:t.width+"×"+t.height}),r=n.length-1),document.getElementsByClassName("resolutionList"));if(t&&0<t.length){var i=t[0];if(i.childNodes)for(var a=0;a<i.childNodes.length;a++)e=i.childNodes[a],a==r&&i.onclick(e)}}),s.on("resetRealResolution",function(){var e=s.config.scannerViewer.resolution.defaultValue;s.showLoading("resolution button click"),s.setResolution(e).then(function(e){s.hideLoading("resolution button click")})})})},onclick:function(e,t,n){var r=n.dcs;r.showLoading("resolution button click"),r.setResolution(t).then(function(e){t.width!=e.width&&t.height!=e.height&&r.emit("video-error",P.RESOLUTION_INVALID),r.config.scannerViewer.resolution.defaultValue=t,r.hideLoading("resolution button click"),r.getCameraView().resetVideoInfo()})}},onclick:function(e,t){var n=t.dcs;n.emit("blurPage"),n.once("hideResolutionList",function(){n.emit("focusPage")})}}}function At(e,t){var n=e.width,r=e.height,e=t.findIndex(function(e){var e=e.value||{},t=e.width,e=e.height;return t===n&&e===r});return e=e<0?t.findIndex(function(e){var e=e.value||{},t=e.width,e=e.height;return t===r&&e===n}):e}function Bt(){return{icon:B.font+" "+B.iconAutoDetect,onmount:function(e,t){},onSelected:function(e,t){var n=t.dcs,r=n.config;e?r.scannerViewer.autoDetect.enableAutoDetect=!0:(r.scannerViewer.autoDetect.enableAutoDetect=!1,r.scannerViewer.autoScan.enableAutoScan=!1),n.captureLoop.loadLoopTypeFromConfig(),n.captureLoop.startLoop(t)},className:B.BUTTON_PREFIX+"detectCamera"}}function Tt(){return{icon:B.font+" "+B.iconFlash+" "+B.iconFlashOff,className:B.BUTTON_PREFIX+"flashBtn "+B.disable,onclick:(n=S(E().mark(function e(t,n){var r,i;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.dcs,n.page,i=r.config.scannerViewer,i=(void 0===i?{}:i).torch,(i=void 0===i?{}:i).on?(i.on=!1,i.enableTorch=!1):(i.on=!0,i.enableTorch=!0),e.next=6,qe(r);case 6:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)})};var n}var Lt="dynamsoft_camera_scan_page_style",Vt=t("initElement"),Mt=t("addStyle"),N=function(r){function e(e,t,n){t=r.call(this,e,t,n)||this;return Object.defineProperty(a(t),Mt,{value:Ft}),Object.defineProperty(a(t),Vt,{value:Rt}),t.fileName=null,t._nextViewerPage=null,t.pageName=K,d(a(t),Vt)[Vt](),t.attachDefaultEvent(),t.initFileName(e),t}o(e,r);var t=e.prototype;return t.initFileName=function(e){this.fileName=J,this._fileWrapper.findFile(this.fileName)||this._fileWrapper.createFile(this.fileName)},t.getFileName=function(){return this.fileName},t.getImageCount=function(){return this._fileWrapper.getFileCount(this.fileName)},t.attachDefaultEvent=function(){var a=this;this.on("onSaveCapture",function(e,t,n,r,i){return Be(t.dcs,n,r,i,a.fileName)})},t.setDefaultColors=function(e,t,n,r){this.setDefaultBackgroundColors(e,t,n),e.color||(e.color="#fff"),e.selectedColor||(e.selectedColor="#fe8e14"),t.maskColor||(t.maskColor="#323232"),n.color||(n.color="#fff"),n.selectedColor||(n.selectedColor="#fe8e14"),r.color||(r.color="#fff"),r.background||(r.background="#fe8e14")},t.getOptionsEl=function(){var e=this.options.scannerViewer,e=(void 0===e?{}:e).element;return e=M(e)?document.getElementById(e):e},t.getHeaderButtons=function(){var e=this.options,t=e.headerButtons,e=e.scannerViewer,e=void 0===e?{}:e,n=e.scanButtonStyle,e=e.headerStyle;return r.prototype.createIconItems.call(this,void 0===t?{}:t,void 0===e?{}:e,!0,void 0===n?{}:n)},t.getFooterButtons=function(){var e=this.options,t=e.footerButtons,e=e.scannerViewer,e=void 0===e?{}:e,n=e.scanButtonStyle,e=e.footerStyle;return r.prototype.createIconItems.call(this,void 0===t?{}:t,void 0===e?{}:e,!1,void 0===n?{}:n)},t.initPageOption=function(e,t){e.scannerViewer||(e.scannerViewer=h(t.config.scannerViewer),t.config&&t.config.scannerViewer&&t.config.scannerViewer.element&&(e.scannerViewer.element=t.config.scannerViewer.element));var t=e.scannerViewer,n=t.resolution,r=t.autoScan,i=t.autoDetect,a=t.switchCamera,o=t.loadLocalFile,t=t.torch,s={icon:B.font+" "+B.iconContinuous,className:B.BUTTON_PREFIX+"continuousMode"},n={headerButtons:{changeResBtn:u(n,Et()),autoDetect:U({isSelected:(null==r?void 0:r.enableAutoScan)||(null==i?void 0:i.enableAutoDetect)},u(i,Bt())),flashBtn:u(t,Tt()),closeBtn:Pt()},footerButtons:{load:u(o,_t()),toggleCamera:u(a,Dt()),capture:It(),autoCapture:U({isSelected:null==r?void 0:r.enableAutoScan},u(r,St())),multipleBtn:{onclick:Ke,onmount:function(e){e.innerHTML='<img class="'+B.previewImg+'">\n<div class="dynamsoft-camera-imgCount '+B.displayNone+'"></div>\n<div class="dynamsoft-camera-nextArr '+B.font+" "+B.iconBack+'"></div>',T.log(e)},className:B.buttonMultipleImg+" "+B.displayNone,text:"Continuous"},continuous:s},scannerViewer:{resolution:{defaultValue:{width:1280,height:720}},fullScreen:!1}};he()&&"hidden"!=(null==(i=t.visibility)?void 0:i.toString().toLowerCase())||delete n.headerButtons.flashBtn,this.options=b(e,n)},t.show=function(){var e=S(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.prototype.show.call(this);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.generatePreview=function(){var e=S(E().mark(function e(){var t,n,r,i,a,o,s,c,u,l,d;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._fileWrapper.openFile(this.fileName),n=t.length,r=null==(r=this.element)?void 0:r.querySelector("."+B.buttonMultipleImg),i=null==r?void 0:r.querySelector("."+B.previewImg),r&&i){e.next=6;break}return e.abrupt("return");case 6:if((a=null==r?void 0:r.querySelector(".dynamsoft-camera-imgCount"))&&(0<n?(a.innerText=String(n),a.classList.remove(B.displayNone)):(a.innerText="",a.classList.add(B.displayNone))),n<=0)return r.classList.add(B.displayNone),i.src!=ct&&""!=i.src&&(F.revokeObjectURL(i.src),i.src=ct),i.setAttribute("data",""),e.abrupt("return");e.next=13;break;case 13:if(a=t[n-1],!(o=this._dvsWrapper.getCustomDataSync(a))){e.next=41;break}if(s=o.detectArea,!0!==o.preview){e.next=23;break}if(_(u=M(u=i.getAttribute("data"))&&""!=u?JSON.parse(u):u,s))return e.abrupt("return");e.next=22;break;case 22:delete o.preview;case 23:if(i.src!=ct&&""!=i.src&&(F.revokeObjectURL(i.src),i.src=ct),!o.preview){e.next=28;break}c=o.preview,e.next=38;break;case 28:return e.next=30,D(o.oriBlob);case 30:return u=e.sent,s&&(l={cornerPoints:s}),e.next=34,Le(this._dcs,l,u,!1,!1);case 34:d=e.sent,c=d.preview,et(d),0;case 38:i.src=F.createURL(c),c.imageData&&delete c.imageData,s&&i.setAttribute("data",JSON.stringify(s));case 41:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.playVideo=function(){var e=S(E().mark(function e(){var t,n,r,i,a,o,s,c;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._dcs,n=this.element,n=n.children[1],t.showLoading("ShowDocumentScanPage"),e.prev=4,i=this.options,i=i.scannerViewer,a=(i=void 0===i?{}:i).resolution,a=void 0===a?{}:a,r=i.fullScreen,i=i.deviceId,i=void 0===i?"":i,o=a.valueList,o=void 0===o?[]:o,(a=a.defaultValue)||o&&0<o.length&&(a=o[o.length-1].value),!t.isRunPlaying()){e.next=13;break}if(t.getCameraManage().getCurrentCamera())return e.next=13,t.closeSource();e.next=13;break;case 13:if(""!=i)return e.next=16,t.selectSource(i);e.next=16;break;case 16:return s=(o={width:void 0,height:void 0}).width,c=o.height,a&&(s=a.width||void 0,c=a.height||void 0),e.next=20,t.play(n,s,c,r);case 20:e.next=27;break;case 22:return e.prev=22,e.t0=e.catch(4),e.next=26,t.navigateBack();case 26:t.emit(ee,e.t0);case 27:return e.prev=27,t.hideLoading("ShowDocumentScanPage"),e.finish(27);case 30:case"end":return e.stop()}},e,this,[[4,22,27,30]])}));return function(){return e.apply(this,arguments)}}(),t.queryPreviewImageElement=function(){var e=null==(e=this.element)?void 0:e.querySelector("."+B.buttonMultipleImg);return e?null==e?void 0:e.querySelector("."+B.previewImg):null},t.destroy=function(){var e=this.queryPreviewImageElement();e&&(e.src&&F.revokeObjectURL(e.src),e.onload=null,e.onerror=null),this.pageName==K&&(null!=(e=this._fileWrapper)&&e.removeFile(this._dvsWrapper,this.fileName),null!=(e=this._dvs)&&null!=(e=e.File)&&e.removeFile(this.fileName),this._dcs.exit(this._dvs)),this._nextViewerPage&&(this._nextViewerPage.destroy(),this._nextViewerPage=null),r.prototype.destroy.call(this)},t.setNextViewerPage=function(e){this._nextViewerPage=e},t.clickMultipleImage=function(){var e=S(E().mark(function e(){var t,n,r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._nextViewerPage)return t=this._nextViewerPage,n=this._fileWrapper.openFile(this.fileName),e.next=5,t.syncFiles(!1,n);e.next=13;break;case 5:return n=e.sent,t.gotoViewPage(n-1),e.next=9,this._dcs.navigateToPage(t);case 9:this.hide(),this._nextViewerPage=null,e.next=16;break;case 13:return r=this._dcs.config.documentEditorSettings,r=void 0===r?{}:r,e.next=16,function(){return Qe.apply(this,arguments)}(this._dcs,this._dvs,r,J,!0);case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.removeDataByIndex=function(e,t){e=this._fileWrapper.removeByIndexInFile(e,t);this._dvsWrapper.removeSync(e)},t.insertDataByIndex=function(e,t,n){n=0<=n?this._dvs.DataControl.insertSync(e,[t],n):this._dvs.DataControl.appendSync(e,[t]);return n&&1==n.length?n[0]:null},t.enableMultiImages=function(){var e;this.element&&((e=null==(e=this.element)?void 0:e.querySelector("."+B.iconContinuous))&&e.classList.add(B.displayNone),(e=null==(e=this.element)?void 0:e.querySelector("."+B.buttonMultipleImg))&&e.classList.remove(B.displayNone))},t.moveMultipleImgPosition=function(){var e,t;this.element&&(e=null==(e=this.element)?void 0:e.querySelector("."+B.buttonMultipleImg))&&(e.style.top="0",e.style.right="0",e.style.position="relative",(t=null==(t=this.element)?void 0:t.querySelector("."+B.BUTTON_PREFIX+"continuousMode"))&&t.appendChild(e),(null==(t=this.element)?void 0:t.querySelector("."+B.iconContinuous)).classList.add(B.displayNone))},t.refreshPreviewWhenChanged=function(){var e=S(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.generatePreview();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.setPreviewImageFlag=function(){var e=this._fileWrapper.openFile(this.fileName);if(0<e.length)for(var t=e.length,n=t-1,r=0;r<t;r++){var i=e[r],i=this._dvsWrapper.getCustomDataSync(i);i&&(r==n?i.preview=!0:void 0!==i.preview&&delete i.preview)}},e}(n);function Rt(){var e=this.options,t=e.scannerViewer,t=void 0===t?{}:t,n=t.headerStyle,n=void 0===n?{}:n,r=t.bodyStyle,r=void 0===r?{}:r,i=t.footerStyle,i=void 0===i?{}:i,t=t.scanButtonStyle,t=(this.setDefaultColors(n,r,i,void 0===t?{}:t),'\n        <header style="background:'+n.background+'"></header>\n        <div style="background:'+r.background+'" class="videoContainer"></div>\n        <footer style="background:'+i.background+'" class="buttonList">\n            '+(e.title?'<div class="modeTitle">'+e.title+"</div>":"")+"\n        </footer>\n        ");this.template=t,this.className=B.documentScanPage,this.createEl(),d(this,Mt)[Mt]()}function Ft(){var e=this.options.scannerViewer,e=void 0===e?{}:e,t=e.headerStyle,t=void 0===t?{}:t,n=e.bodyStyle,r=e.footerStyle,r=void 0===r?{}:r,e=e.scanButtonStyle,e="\n."+B.documentScanPage+" ."+B.headerSelected+" i {\n  color: "+t.selectedColor+" !important;\n}\n."+B.documentScanPage+" ."+B.footerSelected+" i {\n  color: "+r.selectedColor+" !important;\n}\n@keyframes dynamsoft-camera-glow-keyframe-insert {\n  0% {border: 3px solid transparent;}\n  100% {border: 3px solid "+(void 0===e?{}:e).background+";}\n}\n."+B.documentScanPage+" .resolutionList .checkBox {\n  border: 1px solid "+t.color+";\n}\n."+B.documentScanPage+" .resolutionList ."+B.ddlSelectedItem+" .checkBox {\n  background-color: "+t.selectedColor+";\n}\n."+B.buttonMultipleImg+" .dynamsoft-camera-imgCount {\n  color: "+r.color+";\n  background: "+r.selectedColor+";\n}\n."+B.buttonMultipleImg+" .dynamsoft-camera-nextArr {\n  color: "+r.selectedColor+";\n}\n.dcs-loading-content div>div {\n  background: "+(void 0===n?{}:n).maskColor+";\n}\n",t=document.getElementById(Lt);if(t)t.innerHTML=e;else{(t=document.createElement("style")).type="text/css",t.id=Lt;try{t.appendChild(document.createTextNode(e))}catch(e){}document.body.appendChild(t)}}function Nt(){return{icon:B.font+" "+B.iconFilter,className:B.BUTTON_PREFIX+"filter",onclick:function(e,t){var n,r,t=t.dcs,i=t.getCurrentPage();i&&(n=i.getDvs(),r=i.getViewerUid(),i.getViewerByUid(r).getCurrentIndex()<0||function(){Ut.apply(this,arguments)}(e,n,r,t))}}}function Ut(){return(Ut=S(E().mark(function e(t,f,n,p){var o,g,r,i,a,s,c,v,u,l,d,h,m,b,_,y,x,w,k,C,I,P,D;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(D=function(){var n,e,t,r=document.createElement("span"),i=document.createElement("div");i.className=""+B.filterCheckBox,n=document.createElement("span"),(e=document.createElement("input")).type="checkBox",e.id="dynamsoft-camera-"+ut(6),i.appendChild(n),n.appendChild(e);var a=(null==(a=p.config.documentEditorSettings)?void 0:a.filter).applyToAll,a=(a&&a.enableApplyToAll&&(e.checked=!0),(t=document.createElement("label")).innerHTML=a.label,t.setAttribute("for",e.id),r.appendChild(i),r.appendChild(t),document.createElement("span"));return a.className="dynamsoft-filter-close dynamsoft-camera-font dynamsoft-camera-icon-arrow",a.onclick=function(){L(p),o=!1},r.appendChild(a),e.checked?(i.classList.add(B.filterCheckedBox),n.style.background=""):(i.classList.remove(B.filterCheckedBox),n.style.background="none"),e.addEventListener("click",function(){var e=this.checked,t=(e?(i.classList.add(B.filterCheckedBox),n.style.background="",g?p.filterApplyToAllValue=g.dataset.filterValue:(e=!1,p.filterApplyToAllValue=void 0)):(i.classList.remove(B.filterCheckedBox),n.style.background="none",p.filterApplyToAllValue=void 0),null==(t=p.config.documentEditorSettings)?void 0:t.filter);t.applyToAll||(t.applyToAll={}),t.applyToAll.enableApplyToAll=e}),r},P=function(){var e;null!=(e=g)&&e.classList.remove(B.filterSelectedItem),null!=a&&null!=(e=a.querySelector("."+B.filterDropDown))&&null!=(e=e.querySelector("."+B.filterSelectedItem))&&e.classList.remove(B.filterSelectedItem)},I=function(){return(I=S(E().mark(function e(t){var n,r,i,a,o,s,c,u,l,d,h;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),(n=t.target)===g||"LI"!==n.tagName)return e.abrupt("return");e.next=4;break;case 4:if(p.showLoading("click filter"),e.prev=5,o=p.getCurrentPage(),0<=(a=v.getCurrentIndex()))return r=v.getUidByIndex(a),s=o.GetFilterDirty(),e.next=13,o.getCurImageData(r);e.next=15;break;case 13:i=e.sent,s||o.ClearFilterDirty();case 15:if(r&&i)return c=v.getRotateAngle(a),P(),(g=n).classList.add(B.filterSelectedItem),u=n.dataset.filterValue,e.next=23,we(i);e.next=38;break;case 23:if(l=e.sent,u!==A.ORIGINAL){e.next=28;break}d=l,e.next=31;break;case 28:return e.next=30,p.filterHandlerByIImageData(i,l,u);case 30:d=e.sent;case 31:return h=p.config.documentEditorSettings.filter,h=h.applyToAll,p.curFilterValue=u,h&&h.enableApplyToAll?p.filterApplyToAllValue=u:p.filterApplyToAllValue=void 0,e.next=37,Ne(d,f,r,!1,{filterValue:u,bitDepth:d.imageBitDepth});case 37:v.rotate(c);case 38:return e.prev=38,p.hideLoading("click filter"),e.finish(38);case 41:case"end":return e.stop()}},e,null,[[5,,38,41]])}))).apply(this,arguments)},C=function(e){return I.apply(this,arguments)},k=function(e,t){e&&(e.classList[t?"remove":"add"](B.displayNone),t&&g&&(e.scrollLeft=g.offsetLeft),o=t)},w=function(){var e=null==a?void 0:a.querySelector("."+B.filterDropDown);k(e,!1)},g=null,r=o=!(x=function(){r||(v.on(Y,w),v.on(X,w),v.on(Q,function(){L(p),o=!1}),r=!0)}),!(i=p.getCurrentPage())||i.isDestroyed)return e.abrupt("return");e.next=13;break;case 13:if(a=i.getHtmlElement()){e.next=16;break}return e.abrupt("return");case 16:if(s=null==a?void 0:a.querySelector("."+B.BUTTON_PREFIX+"filter"),c=null==s?void 0:s.querySelector("."+B.filterDropDown),v=i.getViewerByUid(n),(u=v.getCurrentIndex())<0)return c&&(We(c),c.remove()),e.abrupt("return");e.next=23;break;case 23:if(M(l=v.getUidByIndex(u))&&""!=l){e.next=27;break}return c&&(We(c),c.remove()),e.abrupt("return");case 27:if(c&&(d=c.getAttribute("data")),c&&d==l){e.next=39;break}return h=!c,c?(We(c),m=null==(m=c)?void 0:m.querySelector("ul")):(c=document.createElement("span"),m=document.createElement("ul"),c.appendChild(m)),e.next=33,i.appendFilterDropdownImages(v);case 33:_=e.sent,b="",_&&(m.appendChild(_),g=null==(_=m)?void 0:_.querySelector("."+B.filterSelectedItem),_=!1,(null==s?void 0:s.querySelector("."+B.filterApplyAll))?_=!0:(y=p.config.documentEditorSettings.filter,(y=y.applyToAll)&&"visible"==y.visibility&&(y=D())&&(y.classList.add(B.filterApplyAll),c.insertBefore(y,c.firstChild),_=!0)),b=_?"dynamsoft-camera-H100":"dynamsoft-camera-H71"),c.className=B.filterDropDown+" "+B.displayNone+" "+b,h&&(c.addEventListener("click",function(){var t=S(E().mark(function e(t){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:C(t);case 1:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),s.appendChild(c)),l&&c.setAttribute("data",l);case 39:k(c,o=!o),t.stopPropagation(),x();case 43:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ot(){return{icon:B.font+" "+B.iconInsert,className:B.BUTTON_PREFIX+"insert",onclick:function(e,t){var n,r,i,t=t.dcs,a=t.getCurrentPage();function o(e){var t=e.dcs;t.captureLoop.getIsLooping()?setTimeout(o,200,e):e.callback.apply(null,[e.selectedFile,t])}function s(e,t){var n;e&&("application/pdf"==e.type||"image/tiff"==e.type?t.emit("video-error",P.IMAGE_FORMAT_INVALID):(n=t.getCurrentPage())instanceof Vn&&(t.emit("blurPage"),t.showLoading("insert - load image"),o({selectedFile:e,dcs:t,callback:n.selectedFile})))}function c(t,n){var r=document.createElement("input");r.style.display="none",document.body.appendChild(r),r.addEventListener("click",function(e){e.stopPropagation()}),r.type="file",r.multiple=!1,r.accept="image/png,image/jpeg,image/jpg";r.onchange=function(){var e;""!==r.value&&0<(e=r.files).length&&(n&&n(e[0],t),n=null),document.body.removeChild(r),r.value=null,r.files=null,r.onchange=null,r=null},r.click()}a&&((n=a._dcs.getPreviousPage())&&n instanceof In&&n.exitReuseMode(),r=t,t=(n=a).getDvs(),i=!1,r.showInsertPage({fileName:n.getPageFileName(),footerButtons:{capture:{onclick:function(e,t){i||(i=!0,r.getCurrentPage()instanceof Vn&&r.captureLoop.startManualCapture({dcs:r}),i=!1)}},load:{onclick:function(e,t){r.getCurrentPage()instanceof Vn&&c(r,s)}}}},t),r.emit("focusPage"))}}}var Ht="dynamsoft_camera_viewer_style",Wt=t("bindCameraEvents"),c=t("getViewer"),jt=t("createCameraDvs"),Gt=t("removeCameraDvs"),qt=t("setViewerStyle"),Xt=t("addStyle"),zt=function(r){function i(e,t,n){t=r.call(this,e,t,n)||this;return Object.defineProperty(a(t),Xt,{value:$t}),Object.defineProperty(a(t),qt,{value:Kt}),Object.defineProperty(a(t),Gt,{value:Zt}),Object.defineProperty(a(t),jt,{value:Jt}),Object.defineProperty(a(t),c,{value:Qt}),Object.defineProperty(a(t),Wt,{value:Yt}),t._backFileName=null,t._initFileName=null,t._pageFileName=null,t._viewerId=null,t._editUid=null,t._zooming=!0,t._savedUid=null,t._copyRefMap={},t._isHandlingPageUid=!1,t._nextHandlePageUid=null,t._backInfo={origApplyToAll:"",origDocumentData:{},initDocumentData:{}},t._currentInfo={documentData:{}},t._nextViewerPage=null,t._bSyncViewerDataFromBackupData=!1,t._backFileName=e.fileName,t._initFileName=e.initFileName,t._pageFileName=e.fileName,t.setPageFilename(),t.options.initDocumentData&&(t._backInfo.initDocumentData=t.options.initDocumentData),t.setZooming(),d(a(t),jt)[jt](t.options),d(a(t),Xt)[Xt](),t}o(i,r);var e=i.prototype;return e.setPageFilename=function(){},e.setZooming=function(){},e.getPageFileName=function(){return this._pageFileName},e.getViewerUid=function(){return this._viewerId},e.getViewerByUid=function(e){return this._dvs.ViewControl.getViewerByUid(e)},e.getImageCount=function(){var e=d(this,c)[c]();return e?e.getCurrentPageUids().length:0},e.initPageOption=function(e,t){e&&0==e.fromInternal&&e.documentEditorSettings?this.options=e||{}:(this.options=b(e||{},{scannerViewer:h(t.config.scannerViewer),documentEditorSettings:h(t.config.documentEditorSettings)}),t.config&&t.config.documentEditorSettings&&t.config.documentEditorSettings.element&&(this.options.documentEditorSettings.element=t.config.documentEditorSettings.element))},e.destroy=function(){this.isDestroyed=!0,this._nextViewerPage&&(this._nextViewerPage.destroy(),this._nextViewerPage=null),d(this,Gt)[Gt](),r.prototype.destroy.call(this)},e.getOptionsEl=function(){var e=this.options.documentEditorSettings,e=(void 0===e?{}:e).element;return e=M(e)?document.getElementById(e):e},e.gotoViewPage=function(e){var t=this.getViewerByUid(this._viewerId);if(t){var n=t.getCurrentPageUids();if(0<=e&&e<n.length)return t.gotoPage(e),!0}return!1},e.handlePageByIndex=function(){var t=S(E().mark(function e(t){var n,r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getViewerByUid(this._viewerId),n=r.getCurrentPageUids(),!(0<=t&&t<n.length)){e.next=9;break}if(r.gotoPage(t),M(n=r.getUidByIndex(t))&&""!=n)return r=this._dvs,e.next=9,this.handlePageByUid(n,r);e.next=9;break;case 9:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),e.handlePageByUid=function(){var n=S(E().mark(function e(t,n){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initOrigDataByUid(t);case 2:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),e.getCurrentIndex=function(){return this.getViewerByUid(this._viewerId).getCurrentIndex()},e.removePageFile=function(){this._pageFileName&&(T.log("remove file: "+this._pageFileName),this._dvs.File.removeFile(this._pageFileName),this._pageFileName=null)},e.show=function(){var e=S(E().mark(function e(){var t,n;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(!(n=d(this,c)[c]())){e.next=12;break}if(0<=(t=n.getCurrentIndex()))return n=n.getUidByIndex(t),e.next=9,this.handlePageByUid(n,this._dvs);e.next=9;break;case 9:if(this.isDestroyed){e.next=12;break}return e.next=12,r.prototype.show.call(this);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),e.isVisible=function(){var e=!1;return e=this.element?!this.element.classList.contains(B.displayNone):e},e.backupImageDataFromUids=function(e){for(var t,n,r=e.length,i=0;i<r;i++)M(t=e[i])&&""!=t&&(n=null==(n=this._dvsWrapper)?void 0:n.getCustomDataSync(t),this.backupImageDataFromSrcUid(t,n))},e.backupImageDataFromSrcUid=function(e,t){this.isDestroyed||(this._backInfo.origDocumentData[e]=t?{detectArea:t.detectArea,angle:t.angle,filterValue:t.filterValue}:{detectArea:null,angle:0,filterValue:A.ORIGINAL})},e.isCropPage=function(){return!1},e.fileDataCopyOneToViewer=function(e,t,n,r,i){var a,o,s=null==(s=this._dvsWrapper)?void 0:s.getCustomDataSync(n),s=s?b(s,{}):{},c=s.oriBlob,u=s.resBlob;return t?c&&c.imageData&&(a=c.imageData,o=Oe(c)):u&&u.imageData&&(a=u.imageData,o=Oe(u)),a&&o||(a=null==(t=this._dvsWrapper)?void 0:t.getOriDataSync(n),(u=He(o=null==(c=this._dvsWrapper)?void 0:c.getMetaDataSync(n))).imageData=a,s.oriBlob||(s.oriBlob=w(u))),t=r<0||i<=r?this._dvs.DataControl.appendSync(this._pageFileName,[{oriData:a,metadata:o,customData:s}]):this._dvs.DataControl.insertSync(this._pageFileName,[{oriData:a,metadata:o,customData:s}],r),o=a=null,t&&1==t.length?(c=t[0],this._copyRefMap[c]=n,c):null},e.fileDataCopyToViewer=function(e){for(var t,n=this.isCropPage(),r=e.length,i=0;i<r;i++)M(t=e[i])&&""!=t&&this.fileDataCopyOneToViewer(!1,n,t,-1,r)},e.initOrigDataByUid=function(){var t=S(E().mark(function e(t){var n,r,i,a,o,s;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._dvs,this.isCropPage(),this.isDestroyed)return e.abrupt("return");e.next=4;break;case 4:if(M(t)&&""!=t){e.next=6;break}return e.abrupt("return");case 6:if(n=this._dvsWrapper.getDataRootSync(t)){e.next=9;break}return e.abrupt("return");case 9:if(r=n.customData,r=void 0===r?{}:r,i=n.metadata,i=void 0===i?{}:i,s=n.oriData,o=!1,r.oriBlob?a=r.oriBlob:(a=s,r.oriBlob=w(s)),M(a))return e.next=15,fetch(a);e.next=20;break;case 15:return s=e.sent,e.next=18,s.blob();case 18:a=e.sent,o=!0;case 20:if(a instanceof Blob)return e.next=23,ze(a);e.next=26;break;case 23:a=e.sent,1==i.bitDepth&&(a.imageBitDepth=1),o=!0;case 26:o&&(r.oriBlob=w(a),r.angle=0);case 27:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),e.ifOldDocumentDataChanged=function(){var e=this.getViewerByUid(this._viewerId),t=!1;if(e)for(var n=e.getCurrentPageUids(),r=0;r<n.length;r++){var i=n[r];if(M(i)&&""!=i){var a=this._copyRefMap[i];if(M(a)&&""!=a){a=this._backInfo.origDocumentData[a];if(!a)return!0;var o=null==(o=this._dvsWrapper)?void 0:o.getCustomDataSync(i);if(o){i=o.oriBlob;if(t=this.compareOldValueChanged(a,o,i))break}}}}return t},e.compareOldValueChanged=function(e,t,n){if(!e||!t)return!0;if(void 0===e.detectArea){if(n){var r=n.imageWidth,n=n.imageHeight;if(!lt(t.detectArea,r,n))return!0}}else if(!_(e.detectArea,t.detectArea))return!0;if(void 0===e.angle){if(0!=t.angle)return!0}else if(e.angle!=t.angle)return!0;return!Ze(e.filterValue,t.filterValue)},e.getRefUid=function(e,t){if(this.isDestroyed)return null;e=this._copyRefMap[e];if(t){var n=this._dcs.getPreviousPageByPage(this);if(n&&n instanceof i)return n.getRefUid(e,t)}return M(e)&&""!=e?e:null},e.setNextViewerPage=function(e){this._nextViewerPage=e},e.syncFiles=function(){var n=S(E().mark(function e(t,n){var r,i,a,o,s,c,u,l,d,h,f,p,g,v,m,b,_,y,x,w;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(r=this.getViewerByUid(this._viewerId),i=0,!r){e.next=74;break}if(!(a=r.getCurrentPageUids())){e.next=73;break}c=[],u=[],l=a.length,o=0;case 9:if(!(o<l)){e.next=33;break}if(M(d=a[o])&&""!=d){e.next=13;break}return e.abrupt("continue",30);case 13:if(M(h=this._copyRefMap[d])&&""!=h){e.next=17;break}return c.push(o),e.abrupt("continue",30);case 17:f=!1,s=0;case 19:if(!(s<n.length)){e.next=29;break}if(M(p=n[s])&&""!=p){e.next=23;break}return e.abrupt("continue",26);case 23:if(p==h)return f=!0,e.abrupt("break",29);e.next=26;break;case 26:s++,e.next=19;break;case 29:f||(c.push(o),this._dvsWrapper.removeSync(h),delete this._copyRefMap[d],delete this._backInfo.origDocumentData[h]);case 30:o++,e.next=9;break;case 33:0<c.length&&(l-=c.length,r.removeSync(c)),s=0;case 35:if(!(s<n.length)){e.next=43;break}if(M(g=n[s])&&""!=g){e.next=39;break}return e.abrupt("continue",40);case 39:this._backInfo.origDocumentData[g]||u.push({uid:g,index:s});case 40:s++,e.next=35;break;case 43:if(v=this.isCropPage(),!(0<u.length)){e.next=71;break}m=[],s=0;case 47:if(!(s<u.length)){e.next=60;break}if(b=u[s],M(_=b.uid)&&""!=_){e.next=52;break}return e.abrupt("continue",57);case 52:if(this._backInfo.origDocumentData[_])return e.abrupt("continue",57);e.next=54;break;case 54:x=null==(x=this._dvsWrapper)?void 0:x.getCustomDataSync(_),this.backupImageDataFromSrcUid(_,x),this._pageFileName&&(x=this.fileDataCopyOneToViewer(t,v,_,b.index,l))&&(l++,m.push(x),this._copyRefMap[x]=_,0);case 57:s++,e.next=47;break;case 60:if(!this._pageFileName){e.next=71;break}s=0;case 62:if(!(s<m.length)){e.next=71;break}if(M(y=m[s])&&""!=y){e.next=66;break}return e.abrupt("continue",68);case 66:return e.next=68,this.fillOneCustomDataByUidFirstTime(y,this.isCropPage(),!0);case 68:s++,e.next=62;break;case 71:(x=this._dvs.File.openFile(this._pageFileName,r.uid))&&(i=x.length);case 73:this._nextViewerPage&&(w=r.getCurrentPageUids(),this._nextViewerPage.syncFiles(t,w));case 74:return e.abrupt("return",i);case 75:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),e.reorderImages=function(e,t){for(var n,r,i=t.length,a={},o=0;o<i;o++)!M(r=t[o])||""==r||M(n=this._copyRefMap[r])&&""!=n&&(a[n]=r);var s,c=e.length,u=[];for(o=0;o<c;o++)M(s=e[o])&&""!=s&&u.push(a[s]);return u},e.resetViewerAngleByIndexes=function(e){var t=this.getViewerByUid(this._viewerId);if(t&&e)for(var n,r=e.length,i=0;i<r;i++)n=e[i],t.resetByIndex(n,!1)},e.restoreViewerCustomData=function(){var e=[],t=d(this,c)[c]();if(t)for(var n,r,i=t.getCurrentPageUids(),a=i.length,o=0;o<a;o++)M(r=i[o])&&""!=r&&(M(n=this._copyRefMap[r])&&""!=n&&(n=this._backInfo.origDocumentData[n])&&(r=this.restoreOneViewerCustomData(t,r,o,n)).changed&&r.needReset&&e.push(o));return e},e.regetViewerCustomDataFromSrc=function(){var e=[],t=d(this,c)[c]();if(t)for(var n,r,i,a=t.getCurrentPageUids(),o=a.length,s=0;s<o;s++)M(n=a[s])&&""!=n&&(M(i=this._copyRefMap[n])&&""!=i&&(r=null==(r=this._dvsWrapper)?void 0:r.getCustomDataSync(i))&&(i=this.restoreOneViewerCustomData(t,n,s,r)).changed&&i.needReset&&e.push(s));return e},e.restoreOneViewerCustomData=function(e,t,n,r){var i={changed:!1,needReset:!1},a=null==(a=this._dvsWrapper)?void 0:a.getCustomDataSync(t);if(!a||!r)return i;t=a.oriBlob;return this.compareOldValueChanged(r,a,t)&&(void 0!==r.detectArea&&(a.detectArea=r.detectArea),a.angle!=r.angle&&(a.angle=r.angle,i.needReset=!0),void 0!==r.filterValue&&(a.filterValue=r.filterValue),tt(a),i.changed=!0),i},e.saveViewerCustomData=function(){var e=d(this,c)[c]();if(e)for(var t,n,r,i,a=e.getCurrentPageUids(),o=a.length,s=0;s<o;s++)M(i=a[s])&&""!=i&&(M(t=this._copyRefMap[i])&&""!=t&&(n=null==(n=this._dvsWrapper)?void 0:n.getCustomDataSync(t))&&(r=null==(r=this._dvsWrapper)?void 0:r.getCustomDataSync(i))&&(i=!1,_(n.detectArea,r.detectArea)||(n.detectArea=r.detectArea,i=!0),n.angle!=r.angle&&(n.angle=r.angle,i=!0),Ze(n.filterValue,r.filterValue)||(n.filterValue=r.filterValue,i=!0),i&&n.resBlob&&delete n.resBlob,this._backInfo.origDocumentData[t]={detectArea:r.detectArea,angle:r.angle,filterValue:r.filterValue}))},e.render=function(){},e.syncFileFromExternalEvent=function(){var n=S(E().mark(function e(t,n){var r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:return r=null==(r=this._fileWrapper)?void 0:r.openFile(this._backFileName),e.next=5,this.syncFiles(t,r);case 5:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),e.getCurrentEditUid=function(){return this._editUid},e.setEditUidAfterSyncImages=function(){var t=S(E().mark(function e(t){var n,r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(!(n=d(this,c)[c]())){e.next=9;break}if(0<=(r=!at(r=n.getIndexByUid(t))||r<0?n.getCurrentIndex():r))return e.next=9,this.handlePageByIndex(r);e.next=9;break;case 9:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),e.fillOneCustomDataByUidFirstTime=function(){var r=S(E().mark(function e(t,n,r){var i,a,o,s,c,u,l,d,h,f,p;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(M(t)&&""!=t){e.next=4;break}return e.abrupt("return");case 4:if(i=this._dvsWrapper.getDataRootSync(t)){e.next=7;break}return e.abrupt("return");case 7:if(a=i.metadata,a=void 0===a?{}:a,f=i.oriData,c=s=!1,(u=i.customData)||(u={},i.customData=u,c=!0),u.resBlob?(h=n&&u.oriBlob?u.oriBlob:u.resBlob)&&h.imageData&&(i.oriData=w(h.imageData),i.metadata=Oe(h),l=h.imageWidth,d=h.imageHeight):((h=He(a)).imageData=f,n||r||(u.resBlob=w(h)),u.oriBlob?o=u.oriBlob:(o=h,u.oriBlob=w(h)),void 0===u.angle&&(u.angle=0),s=!0),M(o))return e.next=14,fetch(o);e.next=19;break;case 14:return f=e.sent,e.next=17,f.blob();case 17:o=e.sent,c=!0;case 19:if(o instanceof Blob)return e.next=22,ze(o);e.next=27;break;case 22:o=e.sent,l=o.imageWidth,d=o.imageHeight,1==a.bitDepth&&(o.imageBitDepth=1),c=!0;case 27:c&&(u.oriBlob=w(o),u.angle=0,s=!0),u.detectArea||(l&&d||(o=u.oriBlob)&&(l=o.imageWidth,d=o.imageHeight),0<l&&0<d&&(u.detectArea=[0,0,l,0,l,d,0,d]),s=!0),u.filterValue||(u.filterValue=A.ORIGINAL,s=!0),s&&(p=this._copyRefMap[t])&&this.backupImageDataFromSrcUid(p,u);case 31:case"end":return e.stop()}},e,this)}));return function(e,t,n){return r.apply(this,arguments)}}(),e.fillOrigCustomDataFirstTime=function(){var e=S(E().mark(function e(){var t,n,r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(!(t=this.getViewerByUid(this._viewerId))){e.next=17;break}if(!(t=t.getCurrentPageUids())){e.next=17;break}n=0;case 7:if(!(n<t.length)){e.next=17;break}if(M(r=t[n])&&""!=r){e.next=11;break}return e.abrupt("continue",14);case 11:return e.next=13,this.fillOneCustomDataByUidFirstTime(t[n],this.isCropPage(),!1);case 13:this.copyOneBackupToInitData(r);case 14:n++,e.next=7;break;case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),e.copyOneBackupToInitData=function(e){e=this._copyRefMap[e];M(e)&&""!=e&&(this._backInfo.initDocumentData[e]=b(this._backInfo.origDocumentData[e],{}))},i}(n);function Yt(){var n=this;this.getViewerByUid(this._viewerId).on("slideFinished",S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(t=n.getViewerByUid(n._viewerId))&&0<=(t=t.getCurrentIndex())&&n.handlePageByIndex(t);case 2:case"end":return e.stop()}},e)})))}function Qt(){return this.getViewerByUid(this._viewerId)}function Jt(e){var t=this._dvs.ViewControl.createViewer({container:null,displayMode:"single",uiConfig:{canvasConfig:{canvasMouseShape:"pointer"},outerBorder:"0px"},scrollerConfig:{},zooming:this._zooming}),n=(this._viewerId=t.uid,this.options.curIndex),r=null==(r=this._fileWrapper)?void 0:r.openFile(this._backFileName);this._dvs.File.createFile(this._pageFileName,this._viewerId),this._dvs.File.openFile(this._pageFileName,this._viewerId),0==r.length?n=-1:(this.backupImageDataFromUids(r),this._pageFileName&&this.fileDataCopyToViewer(r),0<=n&&(n>=r.length?n=r.length-1:n<0&&(n=0),t.gotoPage(n)),0<=(r=t.getCurrentIndex())&&(this._savedUid=t.getUidByIndex(n=r))),this.options.curIndex=n,t&&d(this,qt)[qt](t),d(this,Wt)[Wt]()}function Zt(){var e=d(this,c)[c]();e.removeAllSync(),this._dvs.ViewControl.removeViewer(e)}function Kt(e){var t=this.options.documentEditorSettings,t=void 0===t?{}:t,n=t.headerStyle,n=void 0===n?{}:n,r=t.bodyStyle,r=void 0===r?{}:r,t=t.footerStyle,t=void 0===t?{}:t;n.background||(n.background="#000"),r.background||(r.background="#323232"),t.background||(t.background="#000"),e.topMenuBorder="none",e.topMenuColor=n.background,e.canvasBorder="none",e.canvasBackground=r.background,e.displayMode="single",e.footerColor=t.background,e.width="100%",e.height="100%"}function $t(){var e=this.options.documentEditorSettings,e=void 0===e?{}:e,t=e.headerStyle,t=void 0===t?{}:t,n=e.bodyStyle,e=e.footerStyle,e=void 0===e?{}:e,n="."+B.headerfont+" { color: "+t.color+"; background: "+t.background+" !important; }\n."+B.footerfont+" { color: "+e.color+" !important; }\n."+B.documentEditPage+" ."+B.headerSelected+" i { color: "+t.selectedColor+" !important; }\n."+B.documentEditPage+" ."+B.footerSelected+" i { color: "+e.selectedColor+" !important; }\n."+B.cropPage+" ."+B.footerSelected+" i { color: "+e.selectedColor+" !important; }\n."+B.documentEditPage+" ."+B.cvsContainer+", ."+B.cropPage+" ."+B.cvsContainer+" { background: "+(void 0===n?{}:n).background+" !important; }\n."+B.documentEditPage+" .dvs-cameraPager, ."+B.cropPage+" .dvs-cameraPager{  color: "+t.color+" !important; }\n."+B.documentEditPage+" .dvs-cameraPager p, ."+B.cropPage+" .dvs-cameraPager p{  color: "+t.color+" !important; }\n."+B.documentEditPage+" .dvs-cameraPager .dvs-curPage, ."+B.cropPage+" .dvs-cameraPager .dvs-curPage{ color: "+t.selectedColor+" !important; }\n."+B.documentEditPage+" .dvs-cameraPager ."+B.disable+", ."+B.cropPage+" .dvs-cameraPager ."+B.disable+"{ color: "+t.disabledColor+" !important; }\n."+B.filterDropDown+" {background: "+e.background+" !important;}\n."+B.filterDropDown+" ul {background: "+e.background+" !important;}\n."+B.filterDropDown+" ul li {border-color: "+e.background+"}\n."+B.filterSelectedItem+" { border: 2px solid "+e.selectedColor+" !important; }\n."+B.filterCheckedBox+" { border-color:"+e.selectedColor+"; !important}\n."+B.filterCheckedBox+" span { background: "+e.selectedColor+" !important}\n."+B.filterCheckedBox+" +label { color: "+e.selectedColor+" }",t=document.getElementById(Ht);if(t)t.innerHTML=n;else{(t=document.createElement("style")).type="text/css",t.id=Ht;try{t.appendChild(document.createTextNode(n))}catch(e){}document.body.appendChild(t)}}var en=t("initElement"),tn=t("initViewer"),y=function(c){function e(e,t,n){t=c.call(this,e,t,n)||this;return Object.defineProperty(a(t),tn,{value:rn}),Object.defineProperty(a(t),en,{value:nn}),t.viewerPagerEventId=null,t._curImageData=null,t._filterDirty=!1,t._preEditPageCropData=null,t._bInsertingImage=!1,t._iInsertingIndex=-1,t.pageName=ne,d(a(t),en)[en](),t._backInfo.origApplyToAll=n.filterApplyToAllValue,"hidden"==e.visibility&&t.clickSaveButton(),t}o(e,c);var t=e.prototype;return t.rotateLeft=function(){this._rotate(-90)},t.rotateRight=function(){this._rotate(90)},t._rotate=function(e){if(!(this.isDestroyed||this.getImageCount()<=0)){var t=this._dcs,n=this.getViewerUid(),n=this.getViewerByUid(n),r=n.getCurrentIndex();if(!(r<0)){t.showLoading("rotate button init");try{n.rotateMode=0,n.rotate(e),this._rotateFilterDropDown(n.getRotateAngle(r))}finally{t.hideLoading("rotate button init")}}}},t._rotateFilterDropDown=function(e){var t;if(!this.isDestroyed){var n=null==(t=this.element)?void 0:t.querySelectorAll(".dynamsoft-camera-preFilter");if(n)for(var r=0;r<n.length;r++){var i=n[r];i&&"IMG"==i.tagName&&i.src&&(i.style.transform="rotate("+e+"deg)")}}},t.getOrigAngle=function(e){var t=0,e=this._copyRefMap[e];return t=e&&(e=this._backInfo.origDocumentData[e])?e.angle:t},t.getCurrentCustomData=function(){var e,t,n=this._editUid;return e=M(n)&&""!=n?(e=this._preEditPageCropData&&M(t=this._copyRefMap[n])&&""!=t?this._preEditPageCropData[t]:e)||this._dvsWrapper.getCustomDataSync(n):e},t.destroy=function(){this.isDestroyed=!0,L(this._dcs);var e=this.getViewerByUid(this._viewerId);e&&this.viewerPagerEventId&&e.offById(Q,this.viewerPagerEventId),this.viewerPagerEventId=null,this.removePageFile(),this.setCurImageData(null),c.prototype.destroy.call(this),this.options=null},t.setPageFilename=function(){this._pageFileName=["__dynamsoft_edit_files",ut(6)].join("_")},t.getHeaderButtons=function(){var e=this.options,t=e.headerButtons,e=e.documentEditorSettings,e=(void 0===e?{}:e).headerStyle;return c.prototype.createIconItems.call(this,void 0===t?{}:t,void 0===e?{}:e,!0,null)},t.getFooterButtons=function(){var e=this.options,t=e.footerButtons,e=e.documentEditorSettings,e=(void 0===e?{}:e).footerStyle;return c.prototype.createIconItems.call(this,void 0===t?{}:t,void 0===e?{}:e,!1,null)},t.initPageOption=function(e,t){c.prototype.initPageOption.call(this,e,t);var e=this.options.documentEditorSettings,n=e.remove,n=void 0===n?{}:n,r=e.insert,r=void 0===r?{}:r,i=e.filter,i=void 0===i?{}:i,a=e.rotateLeft,a=void 0===a?{}:a,o=e.crop,o=void 0===o?{}:o,e=(e.cropViewer,i.defaultValue),e=void 0===e?A.ORIGINAL:e,s=i.applyToAll,s=void 0===s?{}:s,s=(t.curFilterValue=e,s&&s.enableApplyToAll?t.filterApplyToAllValue=e:t.filterApplyToAllValue=void 0,{curIndex:-1,fileName:null,initFileName:this._initFileName,headerButtons:{close:{icon:B.font+" "+B.iconBack,className:B.BUTTON_PREFIX+"back",onclick:function(e,t){t=t.dcs.getCurrentPage();t&&t.clickBackButton()}},pager:{className:"dvs-cameraPager"},delete:u(n,{icon:B.font+" "+B.iconDelete,className:B.BUTTON_PREFIX+"delete",onclick:function(e,t){t=t.dcs.getCurrentPage();t&&t.clickDeleteButton()}})},footerButtons:{insert:u(r,Ot()),rotate:u(a,{icon:B.font+" "+B.iconRotateLeft,className:B.BUTTON_PREFIX+"rotateLeft",onclick:function(e,t){t=t.dcs.getCurrentPage();t&&t.rotateLeft()}}),filter:u(i,Nt()),crop:u(o,{icon:B.font+" "+B.iconCrop,className:B.BUTTON_PREFIX+"crop",onclick:function(e,t){t=t.dcs.getCurrentPage();t&&t.clickCropButton()}}),save:{icon:B.font+" "+B.iconSave,className:B.BUTTON_PREFIX+"save",onclick:function(e,t){t=t.dcs.getCurrentPage();t&&t.clickSaveButton()}}}});this.options=b(this.options,s)},t.changePageNumber=function(e,t){var n,r;this.element&&(n=null==(r=null==(r=this.element)?void 0:r.querySelector(".dvs-cameraPager"))?void 0:r.querySelector(".dvs-curPage"),r=null==r?void 0:r.querySelector(".dvs-totalPage"),n.innerText=String(e+1),r.innerText=String(t))},t.changeStatus=function(e,t){var n,r;this.element&&(n=null==(r=null==(r=this.element)?void 0:r.querySelector(".dvs-cameraPager"))?void 0:r.querySelector(".dvs-previousPage"),r=null==r?void 0:r.querySelector(".dvs-nextPage"),0<=e?(n.classList[e<=0?"add":"remove"](B.disable),r.classList[t===e+1?"add":"remove"](B.disable)):(n.classList.add(B.disable),r.classList.add(B.disable)))},t.handlePageByUid=function(){var n=S(E().mark(function e(t,n){var r,i,a,o,s,c,u,l,d;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(this._isHandlingPageUid)return this._nextHandlePageUid=t,e.abrupt("return");e.next=5;break;case 5:return this._isHandlingPageUid=!0,r=this._dcs,i=t,this._editUid!=i&&(this.setCurPageId(i),this.setCurImageData(null)),null!=r&&r.showLoading("handle page by uid"),e.prev=10,e.next=13,this.initOrigDataByUid(i);case 13:if(a=null==(a=this._dvsWrapper)?void 0:a.getCustomDataSync(i)){e.next=21;break}if(!(s=this.getViewerByUid(this._viewerId))){e.next=21;break}if((i=s.getUidByIndex(0))&&(a=null==(s=this._dvsWrapper)?void 0:s.getCustomDataSync(i),this.setCurPageId(i)),a){e.next=21;break}return e.abrupt("return");case 21:if(o=a.detectArea,s=a.filterValue,l=a.resBlob,c=be(r,s),s&&c==s&&l||this.SetFilterDirty(!0),!o||!s||this._filterDirty){e.next=29;break}e.next=44;break;case 29:return o||(this.setCurImageData(null),this.SetFilterDirty(!0)),e.next=32,this.getCurImageData(i);case 32:if((u=e.sent)&&this._filterDirty)return e.next=36,we(u);e.next=42;break;case 36:return l=e.sent,e.next=39,r.filterHandlerByIImageData(u,l,c);case 39:return d=e.sent,e.next=42,Ne(d,n,i,!1,{resBlob:d,filterValue:c,bitDepth:d.imageBitDepth});case 42:this._filterDirty=!1,this.setFilterDropDownDirty();case 44:return e.prev=44,null!=r&&r.hideLoading("handle page by uid"),this._isHandlingPageUid=!1,e.finish(44);case 48:if(this._nextHandlePageUid)return d=this._nextHandlePageUid,this._nextHandlePageUid=null,e.next=53,this.handlePageByUid(d,this._dvs);e.next=53;break;case 53:case"end":return e.stop()}},e,this,[[10,,44,48]])}));return function(e,t){return n.apply(this,arguments)}}(),t.setCurImageData=function(e){this._curImageData&&delete this._curImageData.imageData,this._curImageData=e},t.getCurImageData=function(){var t=S(E().mark(function e(t){var n,r,i,a,o,s,c,u,l;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(n=this._dcs,!(r=this._editUid==t)){e.next=6;break}if(this._curImageData)return e.abrupt("return",this._curImageData);e.next=6;break;case 6:if(i=null==(i=this._dvsWrapper)?void 0:i.getCustomDataSync(t)){e.next=9;break}return e.abrupt("return");case 9:if(a=i.oriBlob,o=i.detectArea,s=i.angle,s=void 0===s?0:s,null!=n&&n.showLoading("handle page by uid"),e.prev=11,o)return e.next=15,D(a);e.next=22;break;case 15:return u=e.sent,e.next=18,ve(u,s,o);case 18:c=e.sent,r&&(this.setCurImageData(c),this.SetFilterDirty(!0)),e.next=32;break;case 22:return e.next=24,D(a,s);case 24:return u=e.sent,e.next=27,ye(u,n,!0,!1,!1);case 27:l=e.sent,i.detectArea=l.detectArea,c=l.resImage,this.setCurPageId(t),r&&(this.setCurImageData(c),this.SetFilterDirty(!0));case 32:return e.prev=32,null!=n&&n.hideLoading("handle page by uid"),e.finish(32);case 35:return e.abrupt("return",c);case 36:case"end":return e.stop()}},e,this,[[11,,32,35]])}));return function(e){return t.apply(this,arguments)}}(),t.render=function(){var t=this.getViewerByUid(this._viewerId),e=t.getCurrentPageUids();e&&0<e.length&&setTimeout(function(){var e;null!=t&&null!=(e=t.ui)&&e.styleChange(),null!=t&&t.rotate(0)},0)},t.setCurPageId=function(e){this._editUid=e},t.setFilterDropDownDirty=function(){var e=null==(e=this.element)?void 0:e.querySelector("."+B.BUTTON_PREFIX+"filter");e&&(e=null==e?void 0:e.querySelector("."+B.filterDropDown))&&e.setAttribute("data","")},t.SetFilterDirty=function(e){this._filterDirty=!0},t.ClearFilterDirty=function(){this._filterDirty=!1},t.GetFilterDirty=function(){return this._filterDirty},t.clickCropButton=function(){var e=S(E().mark(function e(){var t,n,r,i,a,o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("hidden"==this.options.documentEditorSettings.cropViewer.visibility.toString().toLowerCase())return e.abrupt("return");e.next=2;break;case 2:if(this.getImageCount()<=0)return e.abrupt("return");e.next=4;break;case 4:if(t=this.getDvs(),n=this.getCurrentIndex(),!this._pageFileName){e.next=23;break}if(r=this.saveViewerAngle(),i={fileName:this._pageFileName,initFileName:this._initFileName,curIndex:n,saveData:!0,fromInternal:this.options.fromInternal,documentEditorSettings:this.options.documentEditorSettings,nextButtonCss:B.font+" "+B.iconSave},(a=this._dcs.getPreviousPage())&&a instanceof In)return o=this.getViewerByUid(this._viewerId),o=o.getCurrentPageUids(),a.enterReuseMode(i,o),a.gotoViewPage(n),e.next=17,this._dcs.navigateToPage(a);e.next=18;break;case 17:return e.abrupt("return");case 18:return(o=new In(i,t,this._dcs)).gotoViewPage(n),e.next=22,this._dcs.navigateToPage(o);case 22:this.resetViewerAngleByIndexes(r);case 23:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.updateFileDataToViewer=function(){var e=S(E().mark(function e(){var t,n,r,i,a,o,s,c,u,l,d,h,f,p;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.getViewerByUid(this._viewerId))){e.next=47;break}0<=(n=t.getCurrentIndex())&&(r=t.getUidByIndex(n)),i=t.getCurrentPageUids(),s=i.length,u=!(c=[]),o=0;case 7:if(!(o<s)){e.next=18;break}if(M(a=i[o])&&""!=a){e.next=11;break}return e.abrupt("continue",15);case 11:if(M(l=this._copyRefMap[a])&&""!=l){e.next=14;break}return e.abrupt("continue",15);case 14:c.push(l);case 15:o++,e.next=7;break;case 18:this.backupImageDataFromUids(c),o=0;case 20:if(!(o<s)){e.next=47;break}if(M(a=i[o])&&""!=a){e.next=24;break}return e.abrupt("continue",44);case 24:if(u=r==a,M(d=this._copyRefMap[a])&&""!=d){e.next=28;break}return e.abrupt("continue",44);case 28:if(h=this._backInfo.origDocumentData[d],f=this._preEditPageCropData[d],!((p=null==(p=this._dvsWrapper)?void 0:p.getCustomDataSync(a))&&f&&h)){e.next=44;break}if(!_(f.detectArea,h.detectArea)||f.angle!=h.angle){e.next=35;break}e.next=44;break;case 35:if(p.angle=h.angle,p.detectArea=h.detectArea,p.resBlob&&delete p.resBlob,this._dvsWrapper.setCustomDataSync(a,p),u)return t.resetByIndex(n,!1),this.setCurImageData(null),e.next=44,this.handlePageByUid(r,this._dvs);e.next=44;break;case 44:o++,e.next=20;break;case 47:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.hide=function(){c.prototype.hide.call(this)},t.show=function(){var e=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return this.hide(),e.abrupt("return");e.next=3;break;case 3:if(this._bSyncViewerDataFromBackupData)return e.next=6,this.updateFileDataToViewer();e.next=8;break;case 6:this._preEditPageCropData=null,this._bSyncViewerDataFromBackupData=!1;case 8:return this._dcs.config.documentEditorSettings.visibility="visible",e.next=11,c.prototype.show.call(this);case 11:(t=this.getViewerByUid(this._viewerId))&&0<t.getCurrentPageUids().length&&this.render();case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.clickDeleteButton=function(){var e=S(E().mark(function e(){var t,n,r,i,a,o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(this.getImageCount()<=0)return e.abrupt("return");e.next=4;break;case 4:if((r=this._dcs).config.documentEditorSettings.remove.funcConfirmRemove)return e.next=8,r.config.documentEditorSettings.remove.funcConfirmRemove();e.next=11;break;case 8:if(0==e.sent)return e.abrupt("return");e.next=11;break;case 11:if(t=this.getViewerByUid(this._viewerId),(n=t.getCurrentIndex())<0)return e.abrupt("return");e.next=15;break;case 15:if(r=t.getUidByIndex(n),(o=this._dcs.getPreviousPage())&&o instanceof In&&o.exitReuseMode(),o=this.getRefUid(r,!0),i=!1,!M(o)||""==o){e.next=29;break}if(!(a=this._initFileName)){e.next=29;break}if(0<=(a=this._fileWrapper.getIndexByUidInFile(a,o)))return o=this._dcs.getRemovePhotoCallback(),e.next=28,o(this._initFileName,a);e.next=29;break;case 28:i=!0;case 29:if(i||t.removeSync(n),0<t.currentPageCount)return e.next=33,this.refreshViewer();e.next=33;break;case 33:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.clickSaveButton=function(){var e=S(E().mark(function e(){var t,n,r,i,a,o,s;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(t=this.getDvs(),n=this._dcs,a=this.getViewerByUid(this._viewerId),n.showLoading("save button init"),r=!1,i=this.options.fromInternal,e.prev=7,this.saveViewerAngle(),(o=n.getPreviousPage())&&o instanceof In&&o.exitReuseMode(),this.setCurImageData(null),this.SetFilterDirty(!0),!(0<(o=a.getCurrentPageUids()).length)){e.next=23;break}if(i)return e.next=18,this._saveToWebTwain(o);e.next=21;break;case 18:t.File.removeFile(this._backFileName),e.next=23;break;case 21:return e.next=23,this.saveFromExternal(o);case 23:(s=null==(a=document)?void 0:a.querySelector(".dvs-showImageArea"))&&(""==s.style.display?s.style.display="block":s.style.display=""),L(n),r=!0,n.exit(t);case 28:return e.prev=28,n.hideLoading("save button init"),e.finish(28);case 31:if(r&&n.closeAllPages)return e.next=34,n.closeAllPages();e.next=37;break;case 34:if(n.config.documentEditorSettings.funcConfirmExitAfterSave)return e.next=37,n.config.documentEditorSettings.funcConfirmExitAfterSave(!i);e.next=37;break;case 37:case"end":return e.stop()}},e,this,[[7,,28,31]])}));return function(){return e.apply(this,arguments)}}(),t.ifOldDocumentDataChanged=function(){if(this._backInfo.origApplyToAll!=this._dcs.filterApplyToAllValue)return!0;var e=this.getViewerByUid(this._viewerId),t=!1;if(e)for(var n=e.getCurrentPageUids(),r=0;r<n.length;r++){var i=n[r];if(M(i)&&""!=i){var a=this._copyRefMap[i];if(M(a)&&""!=a){a=this._backInfo.origDocumentData[a];if(!a)return!0;var o=null==(o=this._dvsWrapper)?void 0:o.getCustomDataSync(i);if(o){i=b(o,{}),o=i.oriBlob;if(i.angle=m(i.angle+e.getRotateAngle(r)),t=this.compareOldValueChanged(a,i,o))break}}}}return t},t.refreshViewer=function(){var e=S(E().mark(function e(){var t,n;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getViewerByUid(this._viewerId),0<=(n=t.getCurrentIndex()))return n=t.getUidByIndex(n),e.next=6,this.handlePageByUid(n,this._dvs);e.next=7;break;case 6:t.render();case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t._saveToWebTwain=function(){var t=S(E().mark(function e(t){var n,r,i,a,o,s,c,u;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this._dvs,r=this._dcs,i=r.getSavePhotoCallback(),a=0;case 3:if(!(a<t.length)){e.next=24;break}if(M(o=t[a])&&""!=o){e.next=7;break}return e.abrupt("continue",21);case 7:if(s=this._dvsWrapper.getDataRootSync(o)){e.next=10;break}return e.abrupt("continue",21);case 10:return c=!1,s.customData&&!s.customData.resBlob&&(c=!0),e.next=14,on(r,s,c);case 14:return c=e.sent,u=c.filterBlob,delete c.filterBlob,e.next=19,i([{file:c,iImageData:u}]);case 19:return e.next=21,n.DataControl.removeData(o);case 21:a++,e.next=3;break;case 24:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),t.getFileName=function(){return this._backFileName},t.saveCurrentCropData=function(){var e=this.getViewerByUid(this._viewerId),t={};if(e)for(var n,r,i,a=e.getCurrentPageUids(),o=a.length,s=0;s<o;s++)M(n=a[s])&&""!=n&&(r=this._copyRefMap[n],i=null==(i=this._dvsWrapper)?void 0:i.getCustomDataSync(n),t[r]=i?{detectArea:i.detectArea,angle:i.angle,filterValue:i.filterValue}:{detectArea:null,angle:0,filterValue:A.ORIGINAL});return t},t.saveFromExternal=function(){var t=S(E().mark(function e(t){var n,r,i,a,o,s,c,u,l,d,h;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:n=this._dvs,r=this._dcs.getPreviousPageByPage(this),i=t.length-1;case 5:if(!(0<=i)){e.next=37;break}if(M(a=t[i])&&""!=a){e.next=9;break}return e.abrupt("continue",34);case 9:if(o=!0,s=void 0,c=null==(c=this._dvsWrapper)?void 0:c.getCustomDataSync(a)){e.next=13;break}return e.abrupt("continue",34);case 13:if(M(u=this._copyRefMap[a])&&""!=u&&(s=(s=this._backInfo.initDocumentData[u])||this._backInfo.origDocumentData[u])&&(this._dcs.filterApplyToAllValue?this._dcs.filterApplyToAllValue!=A.ORIGINAL||M(s.filterValue)&&s.filterValue!=A.ORIGINAL||_(s.detectArea,c.detectArea)&&s.angle==c.angle&&(o=!1):_(s.detectArea,c.detectArea)&&s.angle==c.angle&&Ze(s.filterValue,c.filterValue)&&(o=!1)),!o){e.next=34;break}if(l=this._dvsWrapper.getDataRootSync(a)){e.next=19;break}return e.abrupt("continue",34);case 19:if(l.customData&&l.customData.oriBlob){e.next=22;break}return e.next=22,this.handlePageByUid(a,n);case 22:return e.next=24,on(this._dcs,l,!0);case 24:if(d=e.sent,h=d.filterBlob,delete d.filterBlob,r&&r instanceof In)return e.next=30,r.updateUid(u,h,d);e.next=32;break;case 30:e.next=34;break;case 32:return e.next=34,Ne(h,n,u,!0,d);case 34:i--,e.next=5;break;case 37:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),t.clickBackButton=function(){var e=S(E().mark(function e(){var t,n,r,i,a,o,s,c,u,l,d,h,f,p;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(t=this._dcs,n=this.getCurrentIndex(),r=t.getPreviousPage(),i=this.ifOldDocumentDataChanged(),(u=this.options.documentEditorSettings.funcConfirmExit)&&V(u))return l="",r&&(l=r.pageName),e.next=12,u(i,l);e.next=19;break;case 12:if((a=e.sent)==re)return e.abrupt("return");e.next=17;break;case 17:if(a!=g&&a!=v)return e.abrupt("return");e.next=19;break;case 19:if(void 0===a&&(a=r?v:g),!r){e.next=23;break}e.next=29;break;case 23:if(a!=g){e.next=26;break}e.next=29;break;case 26:if(a==v)return this.clickSaveButton(),e.abrupt("return");e.next=29;break;case 29:if(o=!1,e.prev=30,c=t.getCurrentPage(),L(t),r&&r instanceof In)return r.exitReuseMode(),a==v?(s=this.saveViewerAngle(),this.resetViewerAngleByIndexes(s),this.saveViewerCustomData()):a==g&&(this.restoreViewerCustomData(),this.resetViewerAngle()),i&&(u=r.getViewerByUid(r.getViewerUid()),l=u.getCurrentPageUids(),s=r.resetCropInfoByUids(l),r.resetViewerAngleByIndexes(s)),this._bSyncViewerDataFromBackupData=!0,this._preEditPageCropData=this.saveCurrentCropData(),r.gotoViewPage(n),e.next=42,t.navigateBack(1,!1);e.next=47;break;case 42:d=e.sent,t.showLoading("close edit page"),1==d.length?r.setNextViewerPage(d.pop()):t.destroyRemovedPages(),e.next=88;break;case 47:if(r&&r instanceof N)return a==v?(s=this.saveViewerAngle(),this.resetViewerAngleByIndexes(s),this.saveViewerCustomData()):a==g&&(this.restoreViewerCustomData(),this.resetViewerAngle()),e.next=51,r.refreshPreviewWhenChanged();e.next=78;break;case 51:return e.next=53,t.navigateBack(1,!1);case 53:if(d=e.sent,t.showLoading("close edit page"),1==d.length?r.setNextViewerPage(d.pop()):t.destroyRemovedPages(),"playing"!=(h=t.getStatus())){e.next=60;break}e.next=74;break;case 60:if("paused"!=h){e.next=64;break}t.resume(),e.next=74;break;case 64:if(f=r.element,f=f.children[1],(p=this.options.scannerViewer)&&p.resolution&&p.resolution.defaultValue)return e.next=70,t.play(f,p.resolution.defaultValue.width,p.resolution.defaultValue.height,p.fullScreen);e.next=72;break;case 70:e.next=74;break;case 72:return e.next=74,t.play(f);case 74:t.emit("resetResolution"),t.emit("focusPage"),e.next=88;break;case 78:if(t.showLoading("close edit page"),r)return e.next=82,t.navigateBack();e.next=85;break;case 82:c.hide(),e.next=88;break;case 85:o=!0,c.hide(),t.exit(this._dvs);case 88:return e.prev=88,t.hideLoading("close edit page"),e.finish(88);case 91:if(o&&t.closeAllPages)return e.next=94,t.closeAllPages();e.next=94;break;case 94:case"end":return e.stop()}},e,this,[[30,,88,91]])}));return function(){return e.apply(this,arguments)}}(),t.insertImgByBlobItem=function(){var n=S(E().mark(function e(t,n){var r,i,a,o,s;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.oriBlob,s=t.detectArea,i=t.filterBlob||t.resBlob||r,o=(null==(o=n.config.documentEditorSettings)?void 0:o.filter)||{},o=o.defaultValue,s={detectArea:s,oriBlob:r,resBlob:i,filterValue:o,angle:0},r={oriData:i.imageData,metadata:Oe(i),customData:s},o=n.config.scannerViewer||{},i=o.maxDocuments,o=s=void 0===i?20:i,i=this.getViewerByUid(this._viewerId),a=(null==(a=n.config.documentEditorSettings)?void 0:a.insert)||{},a=a.position,a="before"===(void 0===a?"before":a)?i.getCurrentIndex():i.getCurrentIndex()+1,!this.options.fromInternal||i.currentPageCount+1<=o&&i.currentPageCount+1<=s)return o=i.currentPageCount,(a<0||o-1<a)&&(a=-1),this._bInsertingImage=!0,s=this._dcs.getInsertPhotoCallback(),e.next=17,s(this._initFileName,r,a);e.next=19;break;case 17:e.next=20;break;case 19:n.emit("video-error",P.MAX_IMAGES_IN_BUFFER_LIMIT);case 20:return e.abrupt("return",a);case 21:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),t.insertFile=function(){var t=S(E().mark(function e(t){var n,r,i,a,o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._dcs,this.isDestroyed)return e.abrupt("return");e.next=3;break;case 3:if(e.prev=3,a=n.config.scannerViewer||{},a=a.maxDocuments,r=a=void 0===a?20:a,i=this.getViewerByUid(this._viewerId),!this.options.fromInternal||i.currentPageCount+1<=r&&i.currentPageCount+1<=a)return e.next=10,st(t);e.next=29;break;case 10:return r=e.sent,e.next=13,D(r);case 13:return i=e.sent,e.next=16,n.packageBlobItemFromIImageData(i,!0,!0,!0);case 16:return a=e.sent,e.next=19,this.insertImgByBlobItem(a,n);case 19:if(o=e.sent,0<=(this._iInsertingIndex=o))return e.next=24,this.handlePageByIndex(o);e.next=24;break;case 24:return e.next=26,n.navigateBack();case 26:e.sent,e.next=32;break;case 29:return n.emit("video-error",P.MAX_IMAGES_IN_BUFFER_LIMIT),e.next=32,n.navigateBack();case 32:return e.prev=32,n.stop(),e.finish(32);case 35:case"end":return e.stop()}},e,this,[[3,,32,35]])}));return function(e){return t.apply(this,arguments)}}(),t.isInsertingImage=function(){return this._bInsertingImage},t.setInsertingImageIndex=function(e){this._iInsertingIndex=e,this._bInsertingImage=!0},t.clearInserting=function(){var e=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._bInsertingImage=!1,0<=(t=(t=this._iInsertingIndex)<0&&0<this.getImageCount()?0:t))return this.setCurImageData(null),this.SetFilterDirty(!0),e.next=8,this.handlePageByIndex(t);e.next=8;break;case 8:this._iInsertingIndex=-1;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.applyChanged=function(){var e=this.getViewerByUid(this._viewerId);if(e)for(var t=e.getCurrentPageUids(),n=0;n<t.length;n++){var r,i,a,o=t[n];!M(o)||""==o||(a=null==(a=this._dvsWrapper)?void 0:a.getCustomDataSync(o))&&(r=a.detectArea,i=a.angle,(o=this._copyRefMap[o])&&(a=a.filterValue,this._backInfo.origDocumentData[o]&&(a=this._backInfo.origDocumentData[o].filterValue),this._backInfo.origDocumentData[o]={detectArea:r,angle:void 0===i?0:i,filterValue:a}))}},t.appendFilterDropdownImages=function(){var t=S(E().mark(function e(r){var i,a,o,s,c,u,l,d,h,f,p,g,v,m,b,_,y,x,w,k;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._dcs,e.prev=1,0<=(o=r.getCurrentIndex()))return s=r.getUidByIndex(o),u=this.GetFilterDirty(),e.next=8,this.getCurImageData(s);e.next=10;break;case 8:c=e.sent,u||this.ClearFilterDirty();case 10:if(!s||!c){e.next=48;break}l=r.getRotateAngle(o),w=this._dvsWrapper.getCustomDataSync(s),h=null==(h=i.config.documentEditorSettings)?void 0:h.filter,k=h.defaultValue,k=void 0===k?"original":k,b=h.applyToAll,h=h.valueList,d=(d=b&&b.enableApplyToAll&&M(i.filterApplyToAllValue)&&""!=i.filterApplyToAllValue?i.filterApplyToAllValue:d)||((d=w.filterValue)||k),e.next=19;var t=c,n={source:t,output:{orgImage:!1,previewImage:{quality:85,width:200,height:200,returnType:C.Enum_ImageType.IT_BGRA,returnBlob:!1,nInterplationMethod:5}}};return C.ImageProcWrapper.createImage(n).then(function(e){return t.imageData=e.src,I(e.preview),e.preview});case 19:if(f=e.sent)return e.next=23,we(f);e.next=48;break;case 23:p=e.sent,v=!(g=[]),m=0;case 27:if(!(m<h.length)){e.next=43;break}if(b=h[m],_=b.value,y=b.label,x=void 0,"original"!==_){e.next=35;break}x=p,v=!0,e.next=39;break;case 35:return e.next=37,i.filterHandlerByIImageData(f,p,_);case 37:w=e.sent,x=w;case 39:x&&(k=F.createURL(x),g.push({value:_,url:k,label:y}));case 40:m++,e.next=27;break;case 43:f=null,v||g.unshift({value:A.ORIGINAL,url:F.createURL(p),label:"Original"}),h.some(function(e){return e.value===d})||(d=A.ORIGINAL),0<g.length&&(a=document.createDocumentFragment()),g.forEach(function(e,t){var n=document.createElement("li");n.innerHTML='<img class="dynamsoft-camera-preFilter" src="'+e.url+'" style="transform:rotate('+l+'deg)"><p>'+e.label+"</p>",a.appendChild(n),n.dataset.filterValue=e.value,e.value===d&&n.classList.add(B.filterSelectedItem)});case 48:return e.prev=48,e.finish(48);case 50:return e.abrupt("return",a);case 51:case"end":return e.stop()}},e,this,[[1,,48,50]])}));return function(e){return t.apply(this,arguments)}}(),t.initOrigDataByUid=function(){var t=S(E().mark(function e(t){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.prototype.initOrigDataByUid.call(this,t);case 2:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),t.restoreViewerCurrentCustomData=function(){var e=[],t=this.getViewerByUid(this._viewerId),n=t.getCurrentIndex();if(0<=n){var r=t.getCurrentPageUids()[n],i=this._copyRefMap[r];if(!M(i)||""==i)return;var a=null==(a=this._dvsWrapper)?void 0:a.getCustomDataSync(i),i=this.restoreOneViewerCustomData(t,r,n,a);i.changed&&(this.setCurImageData(null),i.needReset&&e.push(n))}return e},t.saveViewerAngle=function(){var e=[],t=this.getViewerByUid(this._viewerId);if(t)for(var n,r=t.getCurrentPageUids(),i=r.length,a=t.getCurrentIndex(),o=0;o<i;o++)M(n=r[o])&&""!=n&&this.saveViewerOneAngle(t,o==a,o,n)&&e.push(o);return e},t.resetViewerAngle=function(){var e=[],t=this.getViewerByUid(this._viewerId);if(t)for(var n=t.getCurrentPageUids().length,r=0;r<n;r++)0!==t.getRotateAngle(r)&&e.push(r);this.resetViewerAngleByIndexes(e)},t.saveViewerOneAngle=function(e,t,n,r){var i=!1,e=e.getRotateAngle(n),n=null==(n=this._dvsWrapper)?void 0:n.getCustomDataSync(r);return n&&0!=e&&(n.angle=m(n.angle+e),n.resBlob&&delete n.resBlob,t&&this.setCurImageData(null),i=!0),i},e}(zt);function nn(){var e=this.options.documentEditorSettings,e=void 0===e?{}:e,t=e.headerStyle,t=void 0===t?{}:t,n=e.bodyStyle,e=e.footerStyle,e=void 0===e?{}:e;this.setDefaultBackgroundColors(t,void 0===n?{}:n,e),this.template=['<header style="background:'+t.background+'" class="headerButtons"></header>','<div class="'+B.cvsContainer+'" style="width:100%;height:100%"></div>','<footer style="background:'+e.background+'" class="footerButtons"></footer>'].join(""),this.className=B.documentEditPage,this.createEl(),d(this,tn)[tn]()}function rn(){return an.apply(this,arguments)}function an(){return(an=S(E().mark(function e(){var n,t,r,i,a,o,s,c=this;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.element){e.next=2;break}return e.abrupt("return");case 2:i=this.options,i=i.documentEditorSettings,i=(void 0===i?{}:i).bodyStyle,i=void 0===i?{}:i,n=this._dvs,this._dcs,o=null==(o=this.element)?void 0:o.querySelector(".dvs-cameraPager"),s=null==o?void 0:o.querySelector(".dvs-previousPage"),t=null==o?void 0:o.querySelector(".dvs-nextPage"),(r=this.getViewerByUid(this._viewerId)).canvasBackground=i.background,r.bindView(null==(i=this.element)?void 0:i.querySelector("."+B.cvsContainer)),i=r.getCurrentTab(),s&&t||(o.innerHTML='<div class="dvs-previousPage '+B.font+" "+B.iconArrow+" "+B.headerfont+" "+B.disable+'"></div>\n      <p><span class="dvs-curPage">0</span>/<span class="dvs-totalPage">0</span></p>\n      <div class="dvs-nextPage '+B.font+" "+B.iconArrow+" "+B.headerfont+" "+B.disable+'"></div>',s=null==o?void 0:o.querySelector(".dvs-previousPage"),t=null==o?void 0:o.querySelector(".dvs-nextPage"),i&&0<=i.total&&(s.onclick=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!=(t=r.getPrePageIndex()))return t=r.getUidByIndex(t),e.next=5,c.handlePageByUid(t,n);e.next=6;break;case 5:r.prevPage();case 6:case"end":return e.stop()}},e)})),t.onclick=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!=(t=r.getNextPageIndex()))return t=r.getUidByIndex(t),e.next=5,c.handlePageByUid(t,n);e.next=6;break;case 5:r.nextPage();case 6:case"end":return e.stop()}},e)})),(a=this).viewerPagerEventId=r.on(Q,function(e){a&&e&&(a.changePageNumber(e.cur,e.total),a.changeStatus(e.cur,e.total))}))),i&&0<=(o=i.total)&&0<=(s=r.getCurrentIndex())&&(this.changeStatus(s,o),this.changePageNumber(s,o)),null!=(t=r.ui)&&t._resizeViewer();case 16:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function on(){return sn.apply(this,arguments)}function sn(){return(sn=S(E().mark(function e(t,n,r){var i,a,o,s,c,u,l,d,h,f,p,g,v;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=n.customData,i=u.oriBlob,a=u.detectArea,s=u.filterValue,o=u.angle,o=void 0===o?0:o,u=u.bitDepth,u=void 0===u?0:u,h=r,o=m(o),s=s,c=w(i),t.filterApplyToAllValue&&s&&s!=t.filterApplyToAllValue&&(s=t.filterApplyToAllValue,h=!0),!h&&a&&s&&0==o)return(h=n.metadata?He(n.metadata):{}).imageData=n.oriData,0<u&&(h.imageBitDepth=u),t.emit("resetResolution"),e.abrupt("return",{filterBlob:h,detectArea:a,oriBlob:c,angle:0,filterValue:s});e.next=14;break;case 14:if(a)return e.next=17,D(i);e.next=32;break;case 17:return u=e.sent,e.next=20,ve(u,o,a);case 20:return l=e.sent,d=be(t,s),e.next=24,we(l);case 24:return h=e.sent,e.next=27,t.filterHandlerByIImageData(l,h,d);case 27:return p=e.sent,t.emit("resetResolution"),e.abrupt("return",{filterBlob:p,detectArea:a,oriBlob:c,angle:o,filterValue:d});case 32:return f=be(t,s),e.next=35,D(i,o);case 35:return p=e.sent,e.next=38,t.packageBlobItemFromIImageData(p,!0,!0,!1,f);case 38:return v=e.sent,g=v.detectArea,v=v.filterBlob,t.emit("resetResolution"),e.abrupt("return",{filterBlob:v,detectArea:g,oriBlob:c,angle:o,filterValue:f});case 42:case"end":return e.stop()}},e)}))).apply(this,arguments)}var cn=function(){function e(t){var n=this;this.mode="normal",this.vertexes=[],this.midpoints=[],this.probePoints=[],this.slopeRatio=[],this.isCrop=!1,this.ctrlRadius=4,this.sensorRadius=4,this.defaultLineColor="rgba(0,0,0,1)",this.defaultFirstPointColor="rgba(255,0,0,1)",this.invalidLineColor="rgba(255,0,0,1)",this.invalidFirstPointColor="rgba(0,0,0,1)",this.lineColor="rgba(0,0,0,1)",this.firstPointColor="rgba(0,0,0,1)",this.pointFillColor="rgba(255,255,255,0)",this.lineWidth=1,this.dashLine=[4,2],this.isPointSelected=!1,this.activeProbePoint=null,this.moveLeft=0,this.moveTop=0,this.isMoveBox=!1,this.width=0,this.height=0,this.imgWidth=0,this.imgHeight=0,this.leftEdge=0,this.topEdge=0,this.type="bottomRight",this.keepAspectRatio=!1,this.aspectRatio=0,this._startX=null,this._startY=null,this._lastX=null,this._lastY=null,this._lastWhr=1,this.dpr=1,Object.keys(t).forEach(function(e){n[e]=t[e]}),this.resetBox()}var t=e.prototype;return t.getRect=function(){var e=this._getMaxPoint(),t=e.minX,n=e.maxX,r=e.minY,e=e.maxY;return{x:Math.floor(t),y:Math.floor(r),width:Math.floor(n-t),height:Math.floor(e-r)}},t.resetBox=function(){this.midpoints=un(this.vertexes),this.probePoints=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=ln(this.vertexes)},t._getMaxPoint=function(){return{minX:Math.min(this.probePoints[0],this.probePoints[2],this.probePoints[4],this.probePoints[6]),maxX:Math.max(this.probePoints[0],this.probePoints[2],this.probePoints[4],this.probePoints[6]),minY:Math.min(this.probePoints[1],this.probePoints[3],this.probePoints[5],this.probePoints[7]),maxY:Math.max(this.probePoints[1],this.probePoints[3],this.probePoints[5],this.probePoints[7])}},t.checkPointPosition=function(e){var t=this._getMaxPoint(),n=t.minX,r=t.maxX,i=t.minY,t=t.maxY,a=this.probePoints[2*e],o=this.probePoints[2*e+1];return e<4?a===r&&o===t?"se":a===r&&o===i?"ne":a===n&&o===i?"nw":a===n&&o===t?"sw":null:a===r?"e":o===t?"s":a===n?"w":o===i?"n":null},t.onStartHandler=function(e,t,n){var r=this.isBoxSelected(e,t);null!==(r=void 0!==n?n:r)&&(this._startX=e,this._startY=t,this._lastX=e,this._lastY=t,-1===r?(this.isPointSelected=!1,this.activeProbePoint=null,"normal"===this.mode&&(this.isMoveBox=!0)):(this.isPointSelected=!0,this.activeProbePoint=r,this.isMoveBox=!1),"free"===this.mode&&3<r&&(this.k1=this.slopeRatio[(1+(n=r-4))%4],this.b1=this.probePoints[(2*n+3)%8]-this.k1*this.probePoints[(2*n+2)%8],this.k2=this.slopeRatio[(3+n)%4],this.b2=this.probePoints[(2*n+1)%8]-this.k2*this.probePoints[(2*n+0)%8]))},t.onMoveHandler=function(e,t,n){if(this.isPointSelected||this.isMoveBox){var r=this.probePoints.slice();if(this.isPointSelected){var i=this.activeProbePoint;void 0!==n&&(i=n),"normal"===this.mode?r=this._movePointNormal(r,i,e,t):(r=this._movePointFree(r,i,e,t),this.slopeRatio=ln(this.probePoints).slice(0,4)),this.probePoints=r.slice(),this._checkRectConvexity(this.probePoints)?(this.lineColor=this.defaultLineColor,this.firstPointColor=this.defaultFirstPointColor):(this.lineColor=this.invalidLineColor,this.firstPointColor=this.invalidFirstPointColor)}else if(this.isMoveBox){n=e-this._lastX,i=t-this._lastY;if(0==n&&0==i)return;r=this._moveBox(r,n,i),this.probePoints=r.slice()}n=un(this.probePoints);this.probePoints=this.probePoints.slice(0,8).concat(n),this.midpoints=n,this._lastX=e,this._lastY=t}},t.onEndHandler=function(){this.lineColor=this.defaultLineColor,this.firstPointColor=this.defaultFirstPointColor;var e,t=this._startX,n=this._startY,r=(this._startX=0,this._startY=0,this._lastX),i=this._lastY;(this.isPointSelected||this.isMoveBox)&&(this.isPointSelected=!1,this.isMoveBox=!1,this.activeProbePoint=null,e=this._checkRectConvexity(this.probePoints),(t!==r||n!==i)&&e||(this.probePoints=this.vertexes.slice().concat(this.midpoints)),this.vertexes=this.probePoints.slice(0,8),this.midpoints=un(this.probePoints),this.probePoints=this.probePoints.slice(0,8).concat(this.midpoints),this.slopeRatio=ln(this.probePoints).slice(0,4))},t._checkEdge=function(e,t){return!!(0<=e&&e<=this.width&&0<=t&&t<this.height)},t._movePointNormal=function(e,t,n,r){n=Math.max(this.leftEdge,Math.min(this.width,n)),r=Math.max(this.topEdge,Math.min(this.height,r));var i=0,a=0;if(this.keepAspectRatio){var o=this._getMaxPoint(),s=o.minX,c=o.maxX,u=o.minY,o=o.maxY,l=this.checkPointPosition(t),c=(c-s)/(o-u),s=(0===c||c===1/0||c===-1/0||Number.isNaN(c)?c=this._lastWhr:this._lastWhr=c,a=i=0,"width");if(t<4){if(i=n-e[2*t],a=r-e[2*t+1],0===i||0===a)return e;s="width"}else{o=t-4;if("e"===l?(t=(1+o)%4,s="width"):"s"===l?(t=o,s="height"):"w"===l?(t=o,s="width"):"n"===l&&(t=(1+o)%4,s="height"),i=n-e[2*o],a=r-e[2*o+1],0===i||0===a)return e}"height"===s?(i=a*c,"ne"!==l&&"sw"!==l&&"n"!==l&&"w"!==l||(i=-i)):(a=i/c,"ne"!==l&&"sw"!==l&&"n"!==l&&"w"!==l||(a=-a));u=e[2*t]+i,o=e[2*t+1]+a,s=(u<0?(i=0-e[2*t],a=0):u>this.width?(i=this.width-e[2*t],a=0):o<0?(a=0-e[2*t+1],i=0):o>this.height&&(a=this.height-e[2*t+1],i=0),e[2*t]+=i,e[2*t+1]+=a,(t+1)%4),c=(t+3)%4;t%2?(e[2*s]+=i,e[2*c+1]+=a):(e[2*s+1]+=a,e[2*c]+=i)}else if(t<4){if(i=n-e[2*t],a=r-e[2*t+1],0===i&&0===a)return e;e[2*t]=n,e[2*t+1]=r;l=(t+1)%4,u=(t+3)%4;t%2?(e[2*l]=n,e[2*u+1]=r):(e[2*l+1]=r,e[2*u]=n)}else{o=t-4,s=this.slopeRatio[o%4];0===s?(e[(2*o+3)%8]=r,e[(2*o+1)%8]=r):s!==1/0&&s!==-1/0||(e[(2*o+2)%8]=n,e[(2*o+0)%8]=n)}return e},t._movePointFree=function(e,t,n,r){n=Math.max(this.leftEdge,Math.min(this.width,n)),r=Math.max(this.topEdge,Math.min(this.height,r));var i=e.slice();if(t<4){var a=n-e[2*t],o=r-e[2*t+1];if(0==a&&0==o)return e;e[2*t]=n,e[2*t+1]=r}else{var a=t-4,o=this.slopeRatio[a%4],t=r-o*n,s=-t/o,c=t,u=e[(2*a+9)%8]-o*e[(2*a+8)%8],l=-u/o,d=this.k1,h=this.b1,f=this.k2,p=this.b2;0===o?(e[(2*a+3)%8]=r,d!==1/0&&d!==-1/0&&(e[(2*a+2)%8]=(r-h)/d),e[(2*a+1)%8]=r,f!==1/0&&f!==-1/0&&(e[(2*a+0)%8]=(r-p)/f)):o===1/0||o===-1/0?(e[(2*a+2)%8]=n,e[(2*a+3)%8]=d*n+h,e[(2*a+0)%8]=n,e[(2*a+1)%8]=f*n+p):(0===d?e[(2*a+2)%8]+=s-l:d===1/0||d===-1/0?e[(2*a+3)%8]+=c-u:(e[(2*a+2)%8]=(h-t)/(o-d),e[(2*a+3)%8]=(o*h-d*t)/(o-d)),0===f?e[(2*a+0)%8]+=s-l:f===1/0||f===-1/0?e[(2*a+1)%8]+=c-u:(e[(2*a+0)%8]=(p-t)/(o-f),e[(2*a+1)%8]=(o*p-f*t)/(o-f)));for(var g=0;g<4;g++){var v=e[2*g],m=e[2*g+1];if(v<this.leftEdge-.5||v>this.width+.5||m<this.topEdge-.5||m>this.height+.5)return i}}return e},t._moveBox=function(e,t,n){if("normal"===this.mode){var r=Math.min(e[0],e[2],e[4],e[6]),i=Math.max(e[0],e[2],e[4],e[6]),a=Math.min(e[1],e[3],e[5],e[7]),o=Math.max(e[1],e[3],e[5],e[7]);i+(t=r+t<0?-r:t)>this.width&&(t=this.width-i),o+(n=a+n<0?-a:n)>this.height&&(n=this.height-o);for(var s=0;s<4;s++)e[2*s]+=t,e[2*s+1]+=n}return e},t._isPointOnBox=function(e,t){var n,r,i,a;return"normal"===this.mode&&(n=(a=this._getMaxPoint()).minX,r=a.maxX,i=a.minY,a=a.maxY,n<=e&&e<=r&&i<=t&&t<=a)},t.isBoxSelected=function(e,t){var n=this._isPointOnBox(e,t),e=this.isCtrlPointSelected(e,t);return null!==e?e:n?-1:null},t.isCtrlPointSelected=function(e,t){var n=this.sensorRadius,r=this._getMaxPoint(),i=r.minX,a=r.maxX,o=r.minY,r=r.maxY,s=Math.min(Math.max(n,.1*(a-i)),3*n)*this.dpr,c=Math.min(Math.max(n,.1*(r-o)),3*n)*this.dpr,u=8;"free"===this.mode&&(u=8);for(var l=0;l<u;l++){var d=this.probePoints[2*l],h=this.probePoints[2*l+1];if(e<=d+s&&d-s<=e&&t<=h+c&&h-c<=t)return l}return null},t._checkRectConvexity=function(e){var t=(e[6]-e[0])*(e[3]-e[1])-(e[7]-e[1])*(e[2]-e[0]),n=(e[0]-e[2])*(e[5]-e[3])-(e[1]-e[3])*(e[4]-e[2]),r=(e[2]-e[4])*(e[7]-e[5])-(e[3]-e[5])*(e[6]-e[4]),i=(e[4]-e[6])*(e[1]-e[7])-(e[5]-e[7])*(e[0]-e[6]);if(t*n*r*i<0)return!1;var a=e.slice().concat(e.slice(0,2));if(this.slopeRatio.length)for(var o=0;o<2;o++)if(this.slopeRatio[o]!==this.slopeRatio[o+2])if(function(e,t,n,r){if(function(e,t,n,r){var i=Math.min,a=Math.max;return i(e[0],t[0])<=a(n[0],r[0])&&i(n[0],r[0])<=a(e[0],t[0])&&i(e[1],t[1])<=a(n[1],r[1])&&i(n[1],r[1])<=a(e[1],t[1])}(e,t,n,r)&&function(e,t,n,r){var i,a;if(i=e[0]*(n[1]-t[1])+t[0]*(e[1]-n[1])+n[0]*(t[1]-e[1]),a=e[0]*(r[1]-t[1])+t[0]*(e[1]-r[1])+r[0]*(t[1]-e[1]),0<=(i^a)&&0!==i&&0!==a)return;if(i=n[0]*(e[1]-r[1])+r[0]*(n[1]-e[1])+e[0]*(r[1]-n[1]),a=n[0]*(t[1]-r[1])+r[0]*(n[1]-t[1])+t[0]*(r[1]-n[1]),0<=(i^a)&&0!==i&&0!==a)return;return 1}(e,t,n,r)){var i,a;if(i=(r[0]-n[0])*(e[1]-t[1])-(t[0]-e[0])*(n[1]-r[1]),a=(e[1]-n[1])*(t[0]-e[0])*(r[0]-n[0])+n[0]*(r[1]-n[1])*(t[0]-e[0])-e[0]*(t[1]-e[1])*(r[0]-n[0]),0==i||0===a){var o=dn(e,t),s=dn(n,r),c=o[0],u=o[1],l=s[0],d=s[1];if(u[0]===l[0]&&u[1]===l[1])return u;if(c[0]===d[0]&&c[1]===d[1])return c;if(hn(u,s)&&hn(l,o))return[l,u];if(hn(c,s)&&hn(d,o))return[c,d];if(hn(c,s)&&hn(u,s))return[c,u];if(hn(l,s)&&hn(d,s))return[l,d]}o=a/i,c=(i=(e[0]-t[0])*(r[1]-n[1])-(t[1]-e[1])*(n[0]-r[0]),(a=t[1]*(e[0]-t[0])*(r[1]-n[1])+(r[0]-t[0])*(r[1]-n[1])*(e[1]-t[1])-r[1]*(n[0]-r[0])*(t[1]-e[1]))/i);return[o,c]}return!1}(a.slice(2*o,2*o+2),a.slice(2*o+2,2*o+4),a.slice(2*o+4,2*o+6),a.slice(2*o+6,2*o+8)))return!1;return 0<t*n*r*i},e}();function un(e){for(var t=e.slice(0,8).concat(e[0],e[1]),n=[],r=0;r<4;r++){var i=(t[2*r]+t[2*r+2])/2,a=(t[2*r+1]+t[2*r+3])/2;n.push(i,a)}return n}function ln(e){for(var t=[],n=null,r=e.slice(0,8).concat(e[0],e[1]),i=0;i<4;i++)n=r[2*i+3]-r[2*i+1]==0&&r[2*i+2]-r[2*i]==0?0:r[2*i+2]-r[2*i]==0?1/0:(r[2*i+3]-r[2*i+1])/(r[2*i+2]-r[2*i]),t.push(n);return t}function dn(e,t){return e[0]===t[0]?e[1]<t[1]?[e,t]:[t,e]:e[0]<t[0]?[e,t]:[t,e]}function hn(e,t){return t[0][0]===t[1][0]?e[1]>=t[0][1]&&e[1]<=t[1][1]:e[0]>=t[0][0]&&e[0]<=t[1][0]}var fn=function(){function e(e){this._cvs=null,this._cropBox=null,this._isCropping=!1,this._zoom=1,this._edgeMargin=10,this._cropStyle={cornerColor:"#FE8E14",lineColor:"#FE8E14",lineWidth:2,lineDash:"solid"},this._cvs=e,this._initEvent()}var t=e.prototype;return t.getEdgeMargin=function(){return this._edgeMargin},t.dispose=function(){this._cvs.removeEventListener("touchstart",null),this._cvs.removeEventListener("touchmove",null),this._cvs.removeEventListener("touchend",null),this._cvs.removeEventListener("mousedown",null),document.removeEventListener("mousemove",null),document.removeEventListener("mouseup",null),this._cvs=null,this.onAreaChanged=null},t.setCropMode=function(e){this._isCropping=e},t.getCropMode=function(){return this._isCropping},t.clearCropBox=function(){this._cropBox=null,this._cvs.getContext("2d",{willReadFrequently:!0}).clearRect(0,0,this._cvs.width,this._cvs.height)},t.setZoom=function(e){this._zoom=e},t.setCropArea=function(e,t){var n,r,i,a,o,s;e&&(n=t.relLeft,r=t.relTop,o=t.relWidth,t.relHeight,this._limitArea=t,t=this._cvs,i=this._zoom,a=this._edgeMargin,s=o=o/i,e=x(Me(e.map(function(e,t){return t%2==0?e/i+n+a:e/i+r+a}))),this._cropBox=new cn({vertexes:e,width:t.width-a-n,height:t.height-a-r,leftEdge:a+n,topEdge:a+r,imgWidth:o,imgHeight:s,mode:"free",dpr:window.devicePixelRatio}),this._isCropping&&this._drawCropArea())},t.getCropArea=function(){var e=this._cropBox,n=this._zoom,r=this._edgeMargin,i=this._limitArea;return e?x(Me(e.vertexes.map(function(e,t){return t%2==0?(e-i.relLeft-r)*n:(e-i.relTop-r)*n}))):[]},t.setCropStyle=function(e){b(e,this._cropStyle),this._isCropping&&this._drawCropArea()},t.resize=function(e){var t,n,r=this._cropBox,i=this._edgeMargin;r&&(t=(n=this._cvs).width,n=n.height,r.width=t-i-e.relLeft,r.height=n-i-e.relTop,r.leftEdge=i+e.relLeft,r.topEdge=i+e.relTop,r.imgWidth=e.relWidth,r.imgHeight=e.relHeight)},t._initEvent=function(){var n=this,e=this._cvs;function t(e){this._cvsBoundingRect=this._cvs.getBoundingClientRect();var t=this._cropBox,n=this._cvsBoundingRect;t&&(t=n.left,n=n.top,this._cropBox.onStartHandler(e.clientX-t,e.clientY-n))}function r(e){var t,n;this._cropBox&&this._cropBox.isPointSelected&&(t=(n=this._cvsBoundingRect).left,n=n.top,this._cropBox.onMoveHandler(e.clientX-t,e.clientY-n),this._drawCropArea())}function i(){var e;this._cropBox&&this._cropBox.isPointSelected&&(this._cropBox.onEndHandler(),this._drawCropArea(),null!=(e=this.onAreaChanged)&&e.call(this,this.getCropArea()))}e.addEventListener("touchstart",function(e){e=e.touches;1<e.length||t.call(n,e[0])},{passive:!1}),e.addEventListener("mousedown",t.bind(this)),e.addEventListener("touchmove",function(e){var t=e.touches;1<t.length||n._cropBox&&n._cropBox.isPointSelected&&(r.call(n,t[0]),e.preventDefault())},{passive:!1}),document.addEventListener("mousemove",r.bind(this)),e.addEventListener("touchend",i.bind(this)),document.addEventListener("mouseup",i.bind(this))},t._drawCropArea=function(){var e=this._cropBox,t=this._cvs,n=this._cropStyle;if(e){var r=e.probePoints.slice(),e=t.getContext("2d",{willReadFrequently:!0}),i=(e.clearRect(0,0,t.width,t.height),n.lineWidth);if(i%2!=0)for(var a=0;a<r.length;a++)r[a]=Math.floor(r[a])-i/2;var o=r.slice(0,8),s=(e.fillStyle="rgba(255,255,255,0)",e.fillRect(0,0,t.width,t.height),e),c=o,t=n;s.save(),s.beginPath(),s.strokeStyle=t.lineColor,s.lineWidth=t.lineWidth,"dashed"===t.lineDash&&s.setLineDash([5,5]),s.moveTo(c[0],c[1]);for(var u=0;u<c.length;u+=2){var l=(u+2)%8,l=[c[l],c[1+l]];s.lineTo.apply(s,l)}s.closePath(),s.globalCompositeOperation="destination-out",s.fillStyle="rgba(0,0,0)",s.fill(),s.globalCompositeOperation="source-over",s.stroke(),s.closePath(),s.restore();var d=e,h=r,o=n,f=Math.floor(8);d.save(),d.strokeStyle=o.cornerColor,d.lineWidth=o.lineWidth;for(var p=0;p<h.length;p+=2){var g=[h[p],h[p+1]];d.clearRect(g[0]-f/2,g[1]-f/2,f,f),d.strokeRect(g[0]-f/2,g[1]-f/2,f,f)}d.restore()}},t.setFullArea=function(){var e,t,n,r;this._cropBox&&(e=(r=this._cropBox).imgWidth,t=r.imgHeight,n=r.leftEdge,r=r.topEdge,this._cropBox.vertexes=[n,r,n+e,r,n+e,r+t,n,r+t],this._cropBox.resetBox(),this._isCropping&&this._drawCropArea())},t.checkFull=function(){if(!this._cropBox)return!1;var e=this.getInnerCropArea(),t=this._cropBox.getRect();return lt(e,t.width,t.height)},t.getInnerCropArea=function(){var e=this._cropBox,n=this._edgeMargin,r=this._limitArea;return e?x(Me(e.vertexes.map(function(e,t){return t%2==0?e-r.relLeft-n:e-r.relTop-n}))):[]},e}();var pn=function(){function e(e,t){this._obElement=null,this._callback=null,this._unbindFn=null,this._callback=t,this._obElement=e,this._initObserver()}var t=e.prototype;return t._initObserver=function(){var e,t,n=this._callback,r=this._obElement;void 0!==window.ResizeObserver?((e=new window.ResizeObserver(function(e){e=e[0];n(e.contentRect)})).observe(r),this._unbindFn=function(){e.unobserve(r),e.disconnect(),e=null}):((t=document.createElement("iframe")).id="fm",t.style.cssText="width:100%;height:100%;z-index:-1;",t.onresize=function(){var e=r.getBoundingClientRect();n(e)},this._unbindFn=function(){t.remove(),t=null})},t.dispose=function(){this._unbindFn(),this._unbindFn=null,this._callback=null,this._obElement=null},t.getCallback=function(){return this._callback},e}(),gn=0,vn=1,mn=2,bn=3,_n=function(){function e(){this._cropInfoObjs={}}var t=e.prototype;return t.getCropInfo=function(e){return this._cropInfoObjs[e]||(this._cropInfoObjs[e]={}),this._cropInfoObjs[e]},t.destroy=function(){if(this._cropInfoObjs)for(var e in this._cropInfoObjs)delete this._cropInfoObjs[e];this._cropInfoObjs=null},e}(),f=t("getCropInfo"),yn=t("initCanvas"),xn=t("initToggleButtonEvent"),wn=t("getImageArea"),kn=t("initElement"),Cn=t("initViewer"),In=function(s){function e(e,t,n){e=s.call(this,e,t,n)||this;return Object.defineProperty(a(e),Cn,{value:Bn}),Object.defineProperty(a(e),kn,{value:An}),Object.defineProperty(a(e),wn,{value:En}),Object.defineProperty(a(e),xn,{value:Sn}),Object.defineProperty(a(e),yn,{value:Dn}),Object.defineProperty(a(e),f,{value:Pn}),e.viewerPagerEventId=null,e.cropMng=null,e._resizeMng=null,e._cropInfoHelper=null,e._renderEvents=[],e._imageArea=null,e._reused=!1,e._bk={_cropInfoHelper:null,_backInfo:null,_backFileName:null,_copyRefMap:null,_customData:null},e._renderType=vn,e.pageName=te,d(a(e),kn)[kn](),e}o(e,s);var t=e.prototype;return t.isCropPage=function(){return!0},t.enterReuseMode=function(e,t){var n,r,i,a,o=this.getViewerByUid(this._viewerId),s=o.getCurrentPageUids(),c=0;if(!this._reused){for(this._reused=!0,this._bk._cropInfoHelper=this._cropInfoHelper,this._bk._backInfo=this._backInfo,this._bk._backFileName=this._backFileName,this._bk._copyRefMap=this._copyRefMap,this._bk._customData={},c=0;c<s.length;c++){var u=s[c],l=null==(l=this._dvsWrapper)?void 0:l.getCustomDataSync(u);l&&(this._bk._customData[u]={detectArea:l.detectArea,angle:l.angle})}this._cropInfoHelper=new _n,this._copyRefMap={},this._backInfo={origApplyToAll:"",origDocumentData:{},initDocumentData:{}},this._backFileName=e.fileName}for(this.backupImageDataFromUids(t),c=0;c<s.length;c++)u=s[c],n=t[c],this._copyRefMap[u]=n,(r=null==(r=this._dvsWrapper)?void 0:r.getCustomDataSync(u))&&(i=null==(i=this._dvsWrapper)?void 0:i.getCustomDataSync(n))&&(r.detectArea=i.detectArea,r.angle=i.angle,d(this,f)[f](u).alreadyHandle=!1,o.resetByIndex(c,!1));e.nextButtonCss&&((null==(a=this.element)?void 0:a.querySelector("."+B.BUTTON_PREFIX+"save i")).className=e.nextButtonCss),this._editUid=null,this.render()},t.render=function(){var t,n=this.getViewerByUid(this._viewerId),e=n.getCurrentPageUids();e&&0<e.length&&(t=this,setTimeout(function(){var e;null!=n&&null!=(e=n.ui)&&e.styleChange(),t._renderType=vn,n.rotate(0),t._resizeMng&&V(e=t._resizeMng.getCallback())&&e(null)},0))},t.exitReuseMode=function(){var e;if(this._reused){var t=this.getViewerByUid(this._viewerId),n=t.getCurrentPageUids(),r=0;for(this._cropInfoHelper=this._bk._cropInfoHelper,this._backInfo=this._bk._backInfo,this._backFileName=this._bk._backFileName,this._copyRefMap=this._bk._copyRefMap,r=0;r<n.length;r++){var i,a=n[r],o=null==(o=this._dvsWrapper)?void 0:o.getCustomDataSync(a);o&&this._bk._customData&&((i=this._bk._customData[a])&&(o.detectArea=i.detectArea,o.angle=i.angle)),d(this,f)[f](a).alreadyHandle=!1,t.resetByIndex(r,!1)}this._bk._cropInfoHelper=null,this._bk._backInfo=null,this._bk._backFileName=null,this._bk._copyRefMap=null,this._bk._customData=null,this._editUid=null,this._reused=!1}(null==(e=this.element)?void 0:e.querySelector("."+B.BUTTON_PREFIX+"save i")).className=B.font+" "+B.iconNext},t.getCurrentArea=function(){if(this.cropMng){var e=this.cropMng.getCropArea();if(e&&0<e.length)return e}return d(this,f)[f](this._editUid).savedArea},t.getEditUid=function(){return this._editUid},t.setPageFilename=function(){this._pageFileName=["__dynamsoft_crop_files",ut(6)].join("_")},t.initImageCropInfoByUid=function(e){var t,n,r,i,a,o,s;this.isDestroyed||M(e)&&""!=e&&(t=d(this,f)[f](e),(n=null==(n=this._dvsWrapper)?void 0:n.getCustomDataSync(e))&&(r=null==(r=this._dvsWrapper)?void 0:r.getMetaDataSync(e),e=!1,s=o=0,n.detectArea?i=n.detectArea:(i=[],o=r.width,s=r.height,n.detectArea=i=0<o&&0<s?[0,0,o,0,o,s,0,s]:i),n.angle?a=m(n.angle):n.angle=a=0,r&&(o=r.width,s=r.height,0<o&&0<s&&(t.w=o,t.h=s),e=lt(i,o,s)),t.fullArea=e,t.savedArea=i,t.angle=a))},t._updateViewerSize=function(){var e,t,n;!this.isDestroyed&&this.element&&(t=null==(t=this.element)?void 0:t.querySelector("."+B.cvsContainer))&&(e=(t=t.getBoundingClientRect()).width,t=t.height,n=null==(n=this.element)?void 0:n.querySelector(".dvs-WebViewer"),e-=2*this.cropMng.getEdgeMargin(),t-=2*this.cropMng.getEdgeMargin(),n.width=e,n.height=t,n.style.cssText="width:"+e+"px;height:"+t+"px")},t._resetCropCanvas=function(){var e=null==(e=this.element)?void 0:e.querySelector(".dvs-cropper"),e=(e&&(e.width=1,e.height=1,e.style.cssText="width:1px !important;height:1px !important"),null==(e=this.element)?void 0:e.querySelector(".dvs-canvasEventLayer"));e&&(e.width=1,e.height=1,e.style.cssText="width:1px !important;height:1px !important;background:rgba(255,255,255,0)")},t._listenResize=function(){var n=this,e=(e=null==(e=this.element)?void 0:e.querySelector(".dvs-WebViewer"))||this.element;this._resizeMng=new pn(e,function(){setTimeout(function(){var e,t=n._editUid;t&&(n._setDetectCanvasSize(t),n._updateViewerSize(),e=n._rotateSavedArea(t,0),n._drawCropArea(t,e),n._renderType=mn)},0)})},t._drawFullArea=function(){this._setDetectCanvasSize(this._editUid);var e=d(this,wn)[wn]();if(!e)return this._renderType=vn,void this.render();this.cropMng.resize(e),this.cropMng.setFullArea()},t.getAreaForResize=function(){var e=this.cropMng.getCropArea(),t=d(this,f)[f](this._editUid);return this.isAreaFulfilled(e)?[0,0,e=t.w,0,e,e=t.h,0,e]:t.savedArea},t.rotateLeft=function(){this._rotate(this._editUid,-90)},t.rotateRight=function(){this._rotate(this._editUid,90)},t._rotateSavedArea=function(e,t,n){void 0===n&&(n=null);var r,i,a,o,t=m(t);return this.cropMng&&(r=(i=(e=d(this,f)[f](e)).angle%180==0)?e.w:e.h,i=i?e.h:e.w,a=!1,0==(o=n||this.cropMng.getCropArea()).length&&(o=e.savedArea),a=this.isAreaFulfilled(o),o=Ln(o,t,i,r),a?(e.fullArea=!0,0!=t&&(e.savedArea=Ln(e.savedArea,t,i,r))):(e.fullArea=!1,e.savedArea=o)),o},t._rotate=function(e,t,n){if(void 0===n&&(n=-1),!(this.isDestroyed||this.getImageCount()<=0)){var r=this._dcs,i=this.getViewerByUid(this._viewerId),t=m(t),a=i.getCurrentPageUids();if(0!=a.length){var o=-1;try{if(null!=r&&r.showLoading("rotate button init"),(o=(o=i&&e?i.getIndexByUid(e):o)<0?this.options.curIndex:o)<0||o>=a.length)return;var s,c,u,l=this._rotateSavedArea(e,t);0!=t&&(this._renderType=bn,i.rotateMode=0,i.rotate(t,o),(c=null==(s=this._dvsWrapper)?void 0:s.getCustomDataSync(e))&&(-1==n&&(n=void 0===(u=c.angle)?0:u),c.angle=m(n+t),c.resBlob&&delete c.resBlob,d(this,f)[f](e).angle=c.angle))}finally{null!=r&&r.hideLoading("rotate button init")}this._drawCropArea(e,l)}}},t.getAngle=function(e){e=d(this,f)[f](e);return at(e.angle)?m(e.angle):e.angle=0},t.hide=function(){s.prototype.hide.call(this)},t.show=function(){var e=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return this.hide(),e.abrupt("return");e.next=3;break;case 3:return this._dcs.config.documentEditorSettings.visibility="visible",e.next=6,s.prototype.show.call(this);case 6:this._updateViewerSize(),(t=this.getViewerByUid(this._viewerId))&&(t.getCurrentPageUids().length<=0&&this.disableCrop(),t.render());case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.destroy=function(){var e;this._reused?this.hide():(this.isDestroyed=!0,(e=this.getViewerByUid(this._viewerId))&&this.viewerPagerEventId&&e.offById(Q,this.viewerPagerEventId),this.viewerPagerEventId=null,this.removePageFile(),null!=(e=this._resizeMng)&&e.dispose(),(this._resizeMng=null)!=(e=this.cropMng)&&e.dispose(),this.detectCvsEl&&(this.detectCvsEl.width=0,this.detectCvsEl.height=0),null!=(e=this.detectCvsEl)&&e.remove(),this.cropMng=null,this.detectCvsEl=null,this._renderEvents.slice(0),null!=(e=this._cropInfoHelper)&&e.destroy(),this._cropInfoHelper=null,s.prototype.destroy.call(this),this.options=null)},t._calImageArea=function(e){var t=this.getViewerByUid(this._viewerId);if(!t)return null;t=t.getCurrentTab();if(!t)return null;t=t.getCurPage();if(!t)return null;t={x:t.style.left,y:t.style.top,width:t.style.width,height:t.style.height};if(t.width<=1||t.height<=1)return null;var e=this.getAngle(e)%180==0,n=d(this,f)[f](this._editUid),r=n.w,n=n.h,i=e?t.width:t.height,a=e?t.height:t.width,o=Math.min(i/r,a/n),r=Math.fround(o*r),n=Math.fround(o*n),i=Math.floor(.5*Math.abs(i-r)),a=Math.floor(.5*Math.abs(a-n));return this._imageArea={relLeft:t.x+(e?i:a),relTop:t.y+(e?a:i),relWidth:e?r:n,relHeight:e?n:r,zoom:1/o},this._imageArea},t._drawCropArea=function(e,t){if(!this.isDestroyed&&(this._setDetectCanvasSize(e),this.cropMng)){var n=d(this,wn)[wn]();if(!n)return this._renderType=vn,void this.render();this.cropMng.resize(n);n=t;n=n?x(n=Me(n)):d(this,f)[f](e).savedArea,this.cropMng.setCropArea(n,d(this,wn)[wn]())}},t._setDetectCanvasSize=function(e){var t,n,r;this.element&&(t=(n=(null==(n=this.element)?void 0:n.querySelector("."+B.cvsContainer)).getBoundingClientRect()).width,n=n.height,(r=this.detectCvsEl)&&(r.width=t,r.height=n,r.style.cssText="left:0px;top:0px;width:"+t+"px;height:"+n+"px")),this.cropMng&&e&&((r=this._calImageArea(e))&&this.cropMng.setZoom(r.zoom))},t.getCropManage=function(){return this.cropMng},t.getDetectAreaForNotRotate=function(e){if(!this.cropMng)return[];var t=this.cropMng.getCropArea(),n=d(this,wn)[wn]();if(!n)return this._renderType=vn,this.render(),[];var r=n.relWidth,n=n.relHeight,i=this.cropMng._zoom;return x(function(e,t,n,r){var i=[],a=m(t);if(0==a)return e;for(var o=0;o<e.length;o+=2){var s=void 0,c=void 0,u=e[o],l=e[o+1],c=90==a?(s=l,n-u):180==a?(s=n-u,r-l):270==a?(s=r-l,u):(s=u,l);i.push(s,c)}return i}(t,this.getAngle(e),Math.fround(r*i),Math.fround(n*i)))},t.isAreaFulfilled=function(e){var t=this.cropMng;if(!t)return!1;if(this._editUid){var n=this._calImageArea(this._editUid);if(!n)return!0;var r=n.relWidth,n=n.relHeight,t=t._zoom;return lt(e,Math.fround(r*t),Math.fround(n*t))}return!0},t.toggleFullAreaButton=function(){var e=this.cropMng;if(!e)return!1;if(!(this.getImageCount()<=0)){var t=d(this,f)[f](this._editUid),n=t.angle%180==0,r=n?t.w:t.h,n=n?t.h:t.w,i=this._calImageArea(this._editUid);if(!i)return!1;var a,r=Math.fround(+r),n=Math.fround(+n),o=this.getCurrentArea(),s=lt(o,r,n);return s?0===t.savedArea.length?(t.savedArea=[0,0,r-2,0,r-2,n-2,0,n-2],a=t.savedArea):lt(a=x(a=Me(a=t.savedArea)),r,n)&&(t.savedArea=a=[0,0,r-2,0,r-2,n-2,0,n-2]):(t.savedArea=o,a=[0,0,r,0,r,n,0,n]),e.setCropArea(a.slice(),i),s}},t.setZooming=function(){this._zooming=!1},t.getHeaderButtons=function(){var e=this.options,t=e.headerButtons,e=e.documentEditorSettings,e=(void 0===e?{}:e).headerStyle;return s.prototype.createIconItems.call(this,void 0===t?{}:t,void 0===e?{}:e,!0,null)},t.getFooterButtons=function(){var e=this.options,t=e.footerButtons,e=e.documentEditorSettings,e=(void 0===e?{}:e).footerStyle;return s.prototype.createIconItems.call(this,void 0===t?{}:t,void 0===e?{}:e,!1,null)},t.resetCropInfoByUids=function(e){var t=[],n=this.getViewerByUid(this._viewerId);if(e&&n)for(var r,i,a=n.getCurrentPageUids().length,o=0;o<e.length;o++)!M(i=e[o])||""==i||at(r=n.getIndexByUid(i))&&0<=r&&r<a&&(this.initImageCropInfoByUid(i),d(this,f)[f](i).alreadyHandle=!1,t.push(r));return t},t._resetViewerWhenChanged=function(){var e=[],t=[],n=this.getViewerByUid(this._viewerId);if(n)for(var r=n.getCurrentPageUids(),i=0;i<r.length;i++){var a,o,s,c=r[i];M(c)&&""!=c&&d(this,f)[f](c).alreadyHandle&&(this._editUid=null,(o=this._copyRefMap[c])&&(o=this._backInfo.origDocumentData[o])?(a=o.detectArea,o=o.angle,(s=null==(s=this._dvsWrapper)?void 0:s.getCustomDataSync(c))&&_(a,s.detectArea)&&o==s.angle||(t.push(c),e.push(i))):(t.push(c),e.push(i)))}return this.resetCropInfoByUids(t),e},t.clickBackButton=function(){var e=S(E().mark(function e(){var t,n,r,i,a,o,s,c,u,l,d;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(t=this._dcs,this.options.fromInternal,t.getCurrentPage(),n=t.getPreviousPage(),this.saveCurrentDataToUid(this._editUid),r=this.ifOldDocumentDataChanged(),o=this.options.documentEditorSettings.cropViewer,(o=(void 0===o?{}:o).funcConfirmExit)&&V(o))return s="",n&&(s=n.pageName),e.next=14,o(r,s);e.next=21;break;case 14:if((i=e.sent)==re)return e.abrupt("return");e.next=19;break;case 19:if(i!=g&&i!=v)return e.abrupt("return");e.next=21;break;case 21:if(void 0===i&&(i=!n||n instanceof y?g:v),!n){e.next=35;break}if(!(n instanceof y)){e.next=33;break}if(i!=g){e.next=27;break}e.next=31;break;case 27:if(i==v)return e.next=30,this.clickSaveButton();e.next=31;break;case 30:return e.abrupt("return");case 31:e.next=33;break;case 33:e.next=42;break;case 35:if(i!=g){e.next=38;break}e.next=42;break;case 38:if(i!=v){e.next=42;break}t.showLoading("crop back button SaveAndExit");try{this.clickSaveButton(!0)}finally{t.hideLoading("crop back button SaveAndExit")}return e.abrupt("return");case 42:if(a=!1,e.prev=43,!n){e.next=85;break}if(r&&(o=this._resetViewerWhenChanged(),this.resetViewerAngleByIndexes(o),i==v?this.saveViewerCustomData():i==g&&(o=this.restoreViewerCustomData(),this.resetViewerAngleByIndexes(o))),n instanceof y)return a=!0,t.showLoading("click crop back"),s=this.getCurrentIndex(),n.hide(),n.gotoViewPage(s),e.next=54,t.navigateBack();e.next=56;break;case 54:e.next=85;break;case 56:if(n instanceof N)return a=!0,e.next=60,t.navigateBack(1,!1);e.next=85;break;case 60:return c=e.sent,t.showLoading("click crop back"),e.next=64,n.refreshPreviewWhenChanged();case 64:if(1==c.length?n.setNextViewerPage(c.pop()):t.destroyRemovedPages(),"playing"!=(u=t.getStatus())){e.next=69;break}e.next=84;break;case 69:if("paused"!=u){e.next=73;break}t.isHidden()||t.resume(),e.next=84;break;case 73:if(t.isHidden()){e.next=84;break}if(l=n.element,l=l.children[1],(d=this.options.scannerViewer)&&d.resolution&&d.resolution.defaultValue)return e.next=80,t.play(l,d.resolution.defaultValue.width,d.resolution.defaultValue.height,d.fullScreen);e.next=82;break;case 80:e.next=84;break;case 82:return e.next=84,t.play(l);case 84:t.isHidden()||t.emit("resetResolution");case 85:if(n){e.next=93;break}if(t.showLoading("click crop back"),t.closeAllPages)return e.next=90,t.closeAllPages();e.next=90;break;case 90:t.exit(this._dvs),e.next=96;break;case 93:if(a){e.next=96;break}return e.next=96,t.navigateBack();case 96:return e.prev=96,n&&t.emit("focusPage"),t.hideLoading("click crop back"),e.finish(96);case 100:case"end":return e.stop()}},e,this,[[43,,96,100]])}));return function(){return e.apply(this,arguments)}}(),t.initPageOption=function(e,t){var n,r=this,t=(s.prototype.initPageOption.call(this,e,t),this.options.documentEditorSettings.cropViewer),t=void 0===t?{}:t,i=t.rotateLeft,a=t.rotateRight,t=t.autoDetectBorder,o={icon:B.font+" "+B.iconNext,className:B.BUTTON_PREFIX+"save",onclick:function(e,t){t=t.dcs.getCurrentPage();t&&t.clickSaveButton()}},e=(e.nextButtonCss&&(o.icon=e.nextButtonCss),{footerButtons:{rotateLeft:u(i,{icon:B.font+" "+B.iconRotateLeft,className:B.BUTTON_PREFIX+"rotateLeft",onclick:function(e,t){t=t.dcs.getCurrentPage();t&&t.rotateLeft()}}),rotateRight:u(a,{icon:B.font+" "+B.iconRotateRight,className:B.BUTTON_PREFIX+"rotateRight",onclick:function(e,t){t=t.dcs.getCurrentPage();t&&t.rotateRight()}}),toggleFullArea:u(t,{icon:B.font+" "+B.iconFullCrop,className:B.BUTTON_PREFIX+"toggleFullArea",onclick:function(e,t){var n=t.page;t.dcs;n.getImageCount()<=0||(t=n.toggleFullAreaButton(),(n=null==e?void 0:e.currentTarget)&&n.classList[t?"remove":"add"](B.footerSelected))}}),save:o},headerButtons:{backBtn:{icon:B.font+" "+B.iconBack,className:B.BUTTON_PREFIX+"backBtn",onclick:(n=S(E().mark(function e(t,n){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.dcs,e.next=3,r.clickBackButton();case 3:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)})},pager:{className:"dvs-cameraPager"}}});this.options=b(this.options,e)},t.changePageNumber=function(e,t){var n,r;this.element&&(n=null==(r=null==(r=this.element)?void 0:r.querySelector(".dvs-cameraPager"))?void 0:r.querySelector(".dvs-curPage"),r=null==r?void 0:r.querySelector(".dvs-totalPage"),n.innerText=String(e+1),r.innerText=String(t))},t.changeStatus=function(e,t){var n,r;this.element&&(n=null==(r=null==(r=this.element)?void 0:r.querySelector(".dvs-cameraPager"))?void 0:r.querySelector(".dvs-previousPage"),r=null==r?void 0:r.querySelector(".dvs-nextPage"),0<=e?(n.classList[e<=0?"add":"remove"](B.disable),r.classList[t===e+1?"add":"remove"](B.disable)):(n.classList.add(B.disable),r.classList.add(B.disable)))},t.handlePageByUid=function(){var n=S(E().mark(function e(t,n){var r,i,a,o,s;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._dcs,this.isDestroyed)return e.abrupt("return");e.next=3;break;case 3:if(this._editUid==t){e.next=7;break}this._editUid=t,e.next=8;break;case 7:return e.abrupt("return");case 8:if(this.isDestroyed)return e.abrupt("return");e.next=10;break;case 10:return r.showLoading("handle crop page by uid"),e.prev=11,this._renderType=vn,e.next=15,this.initOrigDataByUid(t);case 15:if(this.isDestroyed)return e.abrupt("return");e.next=17;break;case 17:this.initImageCropInfoByUid(t),i=0,s=d(this,f)[f](t),o=s.fullArea,i=s.angle,s.alreadyHandle?null!=s.angle&&(i=s.angle,s.angle=0,a=this._rotateSavedArea(t,i,s.savedArea),s.angle=i,this._drawCropArea(t,a)):(0!=(i=null==i?this.getAngle(t):i)?(s.angle=0,a=this._rotateSavedArea(t,0,s.savedArea),this._drawCropArea(t,a),this._rotate(t,i,0)):(a=this._rotateSavedArea(t,0,s.savedArea),this._drawCropArea(t,a)),this._renderType=vn,s.alreadyHandle=!0),(s=null==(i=this.element)?void 0:i.querySelector("."+B.BUTTON_PREFIX+"toggleFullArea"))&&s.classList[o?"add":"remove"](B.footerSelected);case 25:return e.prev=25,r.hideLoading("handle crop page by uid"),e.finish(25);case 28:case"end":return e.stop()}},e,this,[[11,,25,28]])}));return function(e,t){return n.apply(this,arguments)}}(),t.saveCurrentDataToUid=function(e){if(M(e)&&""!=e){this._dcs.showLoading("crop save current data");try{var t,n,r,i=this.getAngle(e),a=null==(t=this._dvsWrapper)?void 0:t.getCustomDataSync(e);a&&(n=!1,this.cropMng&&this.cropMng.getCropMode()&&(r=this.getDetectAreaForNotRotate(e),a.detectArea=r,n=!0),a.angle!=i&&(a.angle=i,n=!0),n&&a.resBlob&&delete a.resBlob)}finally{this._dcs.hideLoading("crop save current data")}}},t.clickSaveButton=function(){var t=S(E().mark(function e(t){var n,r,i,a,o,s,c,u,l,d,h,f,p,g,v,m;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=!1),this.isDestroyed)return e.abrupt("return");e.next=3;break;case 3:if((n=this._dcs).showLoading("crop save"),e.prev=5,s=n.getPreviousPage(),this.saveCurrentDataToUid(this._editUid),r=!1,!s){e.next=24;break}if(s instanceof y)return(l=this.ifOldDocumentDataChanged())&&(s.setCurPageId(null),s.setCurImageData(null),s.SetFilterDirty(!0)),this.mergeChangedToSavedFileSync(),this._reused&&this.saveChangedTo_bk(),l&&(this._editUid=null),this.options.fromInternal&&s.applyChanged(),r=!0,l=this.getCurrentIndex(),s.hide(),s.gotoViewPage(l),e.next=23,n.navigateBack();e.next=24;break;case 23:L(n);case 24:if(r){e.next=85;break}if(a=this.getDvs(),o=this.getCurrentIndex(),s=this.getViewerByUid(this._viewerId),c=s.getCurrentPageUids(),(u=this._nextViewerPage)&&u instanceof y)return e.next=33,u.syncFiles(!1,c);e.next=53;break;case 33:if(i=u.regetViewerCustomDataFromSrc(),u.resetViewerAngleByIndexes(i),l=u.getCurrentIndex(),o!=l&&(u.setCurImageData(null),u.SetFilterDirty(!0)),this.isNextEditPageCurrentDataDifferent(u)&&(i=u.restoreViewerCurrentCustomData(),u.resetViewerAngleByIndexes(i),u.setCurImageData(null),u.SetFilterDirty(!0)),u.gotoViewPage(o),t)return e.next=42,this._dcs.navigateToPage(u,!1);e.next=48;break;case 42:return u.hide(),this.show(),e.next=46,u.clickSaveButton();case 46:e.next=50;break;case 48:return e.next=50,this._dcs.navigateToPage(u);case 50:this._nextViewerPage=null,e.next=83;break;case 53:if(d={fileName:this._pageFileName,initFileName:this._initFileName,curIndex:o,fromInternal:this.options.fromInternal,documentEditorSettings:this.options.documentEditorSettings},this.options.fromInternal){e.next=70;break}h={},f=0;case 57:if(!(f<c.length)){e.next=69;break}if(M(p=c[f])&&""!=p){e.next=61;break}return e.abrupt("continue",66);case 61:if(M(g=this._copyRefMap[p])&&""!=g){e.next=64;break}return e.abrupt("continue",66);case 64:m=this._backInfo.initDocumentData[g],h[p]=b(m,{});case 66:f++,e.next=57;break;case 69:d.initDocumentData=h;case 70:if(v=new y(d,a,n),t)return e.next=74,n.navigateToPage(v,!1);e.next=80;break;case 74:return v.hide(),this.show(),e.next=78,v.clickSaveButton();case 78:e.next=83;break;case 80:return v.gotoViewPage(o),e.next=83,n.navigateToPage(v);case 83:t||((m=n.getPreviousPage())&&m.hide(),i=this._resetViewerWhenChanged(),this.resetViewerAngleByIndexes(i)),r=!0;case 85:return e.prev=85,n.hideLoading("crop save"),e.finish(85);case 88:case"end":return e.stop()}},e,this,[[5,,85,88]])}));return function(e){return t.apply(this,arguments)}}(),t.isNextEditPageCurrentDataDifferent=function(e){var t=e.getCurrentEditUid();if(t){var t=e.getRefUid(t,!1),n=e.getCurrentCustomData();if(n&&t){var r=null==(r=this._dvsWrapper)?void 0:r.getCustomDataSync(t);if(r)return e.compareOldValueChanged(r,n,null)}}return!0},t.mergeChangedToSavedFileSync=function(){for(var e=this.getViewerByUid(this._viewerId).getCurrentPageUids(),t=0;t<e.length;t++){var n,r,i=e[t],a=this._copyRefMap[i];!M(a)||""==a||(n=null==(n=this._dvsWrapper)?void 0:n.getCustomDataSync(i))&&(i=this._backInfo.origDocumentData[a],!(r=null==(r=this._dvsWrapper)?void 0:r.getCustomDataSync(a))||_(r.detectArea,n.detectArea)&&r.angle==n.angle||(a=!1,_(r.detectArea,n.detectArea)||(r.detectArea=n.detectArea,a=!0),r.angle!=n.angle&&(r.angle=n.angle,a=!0),a&&r.resBlob&&delete r.resBlob,i&&(a=!1,_(i.detectArea,n.detectArea)||(i.detectArea=n.detectArea,a=!0),i.angle!=n.angle&&(i.angle=n.angle,a=!0),a&&i.resBlob&&delete i.resBlob)))}},t.compareOldValueChanged=function(e,t,n){if(!e||!t)return!0;if(void 0===e.detectArea){var r=n.imageWidth,n=n.imageHeight;if(!lt(t.detectArea,r,n))return!0}else if(!_(e.detectArea,t.detectArea))return!0;if(void 0===e.angle){if(0!=t.angle)return!0}else if(e.angle!=t.angle)return!0;return!1},t.saveChangedTo_bk=function(){if(this._bk&&this._bk._customData){var e=this._cropInfoHelper;this._cropInfoHelper=this._bk._cropInfoHelper;for(var t=this.getViewerByUid(this._viewerId).getCurrentPageUids(),n=0;n<t.length;n++){var r,i,a=t[n],o=null==(o=this._dvsWrapper)?void 0:o.getCustomDataSync(a);o&&((r=this._bk._customData[a])&&(i=!1,_(r.detectArea,o.detectArea)||(r.detectArea=o.detectArea,i=!0),r.angle!=o.angle&&(r.angle=o.angle,i=!0),i&&r.resBlob&&delete r.resBlob),this._cropInfoHelper&&this.initImageCropInfoByUid(a))}this._cropInfoHelper=e}},t.updateUid=function(){var r=S(E().mark(function e(t,n,r){var i,a;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._reused)return e.abrupt("return");e.next=2;break;case 2:if(i=this._dvs,M(a=this._copyRefMap[t])&&""!=a){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,Ne(n,i,a,!0,r);case 8:case"end":return e.stop()}},e,this)}));return function(e,t,n){return r.apply(this,arguments)}}(),t.syncFileFromExternalEvent=function(){var n=S(E().mark(function e(t,n){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(this._reused)return e.next=5,this.syncFileForReusedFromExternalEvent(t,n);e.next=7;break;case 5:e.next=9;break;case 7:return e.next=9,s.prototype.syncFileFromExternalEvent.call(this,t,n);case 9:this.getImageCount()<=0&&this.disableCrop();case 10:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),t.syncFileForReusedFromExternalEvent=function(){var n=S(E().mark(function e(t,n){var r,i,a,o,s,c,u,l,d,h;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._reused)return r=this._copyRefMap,i=this._backInfo,this._copyRefMap=this._bk._copyRefMap,this._backInfo=this._bk._backInfo,o=this._fileWrapper.openFile(this._bk._backFileName),e.next=8,this.syncFiles(t,o);e.next=19;break;case 8:for(this._copyRefMap=r,this._backInfo=i,this._bk._copyRefMap=this._copyRefMap,this._bk._backInfo=this._backInfo,a=this._fileWrapper.openFile(this._backFileName),this.backupNewImageDataFromUids(a),o=this.getViewerByUid(this._viewerId),s=o.getCurrentPageUids(),c=s.length,l=a.length,u=0;u<c;u++)d=s[u],u<l?(h=a[u],this._copyRefMap[d]=h):this._copyRefMap[d]=void 0;case 19:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),t.backupNewImageDataFromUids=function(e){for(var t,n,r=e.length,i=0;i<r;i++)M(t=e[i])&&""!=t&&!this._backInfo.origDocumentData[t]&&(n=null==(n=this._dvsWrapper)?void 0:n.getCustomDataSync(t),this._backInfo.origDocumentData[t]=n?{detectArea:n.detectArea,angle:n.angle,filterValue:n.filterValue}:{detectArea:null,angle:0,filterValue:this._dcs.curFilterValue})},t.disableCrop=function(){this.cropMng&&(this.cropMng.setCropMode(!1),this.cropMng.clearCropBox());var e=null==(e=this.element)?void 0:e.querySelector("."+B.BUTTON_PREFIX+"toggleFullArea");e&&e.classList.remove(B.footerSelected)},e}(zt);function Pn(e){return this._cropInfoHelper||(this._cropInfoHelper=new _n),this._cropInfoHelper.getCropInfo(e)}function Dn(){var n=this,e=this.element;this.detectCvsEl=null==e?void 0:e.querySelector("."+B.detectCvs),this.detectCvsEl&&(e=(void 0===(e=this.options.documentEditorSettings.cropViewer)?{}:e).polygonStyle,this.cropMng=new fn(this.detectCvsEl),e&&this.cropMng.setCropStyle({lineColor:e.stroke,lineWidth:parseInt(e.strokeWidth,10),cornerColor:e.stroke,lineDash:e.dash}),this.cropMng.onAreaChanged=function(e){for(var t in n.isAreaFulfilled(e)||(d(n,f)[f](n._editUid).savedArea=e),n._renderEvents)V(n._renderEvents[t])&&n._renderEvents[t](e)})}function Sn(){var n=this;this._renderEvents.push(function(e){var e=e||n.getCurrentArea(),e=n.isAreaFulfilled(e),t=null==(t=n.element)?void 0:t.querySelector("."+B.iconFullCrop);t&&t.parentElement&&t.parentElement.classList[e?"add":"remove"](B.footerSelected)})}function En(){return this._imageArea||(this._imageArea=this._calImageArea(this._editUid)),this._imageArea}function An(){var e=this.options.documentEditorSettings,e=void 0===e?{}:e,t=e.headerStyle,t=void 0===t?{}:t,n=e.bodyStyle,e=e.footerStyle,e=void 0===e?{}:e;this.setDefaultBackgroundColors(t,void 0===n?{}:n,e),this.template=['<header style="background:'+t.background+'" class="headerButtons"></header>','<div class="'+B.cvsContainer+'"><canvas class="'+B.detectCvs+'"></canvas></div>','</div><footer style="background:'+e.background+'" class="footerButtons"></footer>'].join(""),this.className=B.cropPage,this.createEl(),this._listenResize(),d(this,Cn)[Cn](),d(this,yn)[yn](),d(this,xn)[xn]()}function Bn(){return Tn.apply(this,arguments)}function Tn(){return(Tn=S(E().mark(function e(){var n,r,t,i,a,o,s,c=this;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.element){e.next=2;break}return e.abrupt("return");case 2:t=this.options,t=t.documentEditorSettings,t=(void 0===t?{}:t).bodyStyle,t=void 0===t?{}:t,n=this._dvs,this._dcs,a=null==(a=this.element)?void 0:a.querySelector(".dvs-cameraPager"),o=null==a?void 0:a.querySelector(".dvs-previousPage"),s=null==a?void 0:a.querySelector(".dvs-nextPage"),(r=this.getViewerByUid(this._viewerId)).canvasBackground=t.background,r.bindView(null==(t=this.element)?void 0:t.querySelector("."+B.cvsContainer)),r.on(z,function(){if(!c.isDestroyed)if(c._renderType==bn)c._renderType=gn;else{c._renderType!=gn&&(c._renderType=gn);var e=r.getCurrentTab();if(e){e=e.getCurPage();if(e&&1<e.style.width&&1<e.style.height){c.cropMng.setCropMode(!0),c._resetCropCanvas();var t,n=c._rotateSavedArea(c._editUid,0);for(t in c._drawCropArea(e.uid,n),c._renderEvents)V(c._renderEvents[t])&&c._renderEvents[t]()}}}}),this._resetCropCanvas(),t=r.getCurrentTab(),o&&s||(a.innerHTML='<div class="dvs-previousPage '+B.font+" "+B.iconArrow+" "+B.headerfont+" "+B.disable+'"></div>\n      <p><span class="dvs-curPage">0</span>/<span class="dvs-totalPage">0</span></p>\n      <div class="dvs-nextPage '+B.font+" "+B.iconArrow+" "+B.headerfont+" "+B.disable+'"></div>',o=null==a?void 0:a.querySelector(".dvs-previousPage"),s=null==a?void 0:a.querySelector(".dvs-nextPage"),t&&0<=t.total&&(o.onclick=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(-1!=(t=r.getPrePageIndex()))return t=r.getUidByIndex(t),c.saveCurrentDataToUid(c._editUid),e.next=8,c.handlePageByUid(t,n);e.next=10;break;case 8:c.disableCrop(),r.prevPage();case 10:case"end":return e.stop()}},e)})),s.onclick=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(-1!=(t=r.getNextPageIndex()))return t=r.getUidByIndex(t),c.saveCurrentDataToUid(c._editUid),e.next=8,c.handlePageByUid(t,n);e.next=10;break;case 8:c.disableCrop(),r.nextPage();case 10:case"end":return e.stop()}},e)})),(i=this).viewerPagerEventId=r.on(Q,function(e){c.isDestroyed||i&&e&&(i.changePageNumber(e.cur,e.total),i.changeStatus(e.cur,e.total))}))),t&&0<=(a=t.total)&&0<=(o=r.getCurrentIndex())&&(this.changeStatus(o,a),this.changePageNumber(o,a),M(s=r.getUidByIndex(o))&&""!=s&&this._editUid&&this.saveCurrentDataToUid(this._editUid)),null!=(t=r.ui)&&t._resizeViewer();case 18:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function Ln(e,t,n,r){var i=[],a=m(t);if(0==a)return h(e);for(var o=0;o<e.length;o+=2){var s=void 0,c=void 0,u=Math.fround(e[o]),l=Math.fround(e[o+1]),c=90==a?(s=n-l,u):180==a?(s=r-u,n-l):270==a?(s=l,r-u):(s=u,l);i.push(s,c)}return i}var Vn=function(r){function e(e,t,n){e=r.call(this,e,t,n)||this;return e.pageName="insertPage",e}o(e,r);var t=e.prototype;return t.initFileName=function(e){e&&e.fileName&&(this.fileName=e.fileName)},t.attachDefaultEvent=function(){this.on("onSaveCapture",function(e,t,n,r,i){!function(){Mn.apply(this,arguments)}(e,t,n,r,i)})},t.initPageOption=function(e,t){e.scannerViewer||(e.scannerViewer=h(t.config.scannerViewer),t.config&&t.config.scannerViewer&&t.config.scannerViewer.element&&(e.scannerViewer.element=t.config.scannerViewer.element));var t=e.scannerViewer,n=t.resolution,r=t.autoScan,i=t.autoDetect,a=t.switchCamera,o=t.loadLocalFile,t=t.torch,n={headerButtons:{changeResBtn:u(n,Et()),autoDetect:U({isSelected:(null==r?void 0:r.enableAutoScan)||(null==i?void 0:i.enableAutoDetect)},u(i,Bt())),flashBtn:u(t,Tt()),closeBtn:Pt()},footerButtons:{load:u(o,_t()),toggleCamera:u(a,Dt()),capture:It(),autoCapture:U({isSelected:null==r?void 0:r.enableAutoScan},u(r,St())),continuous:{icon:B.font+" "+B.iconContinuous,className:B.BUTTON_PREFIX+"continuousMode",visibility:"hidden"}},scannerViewer:{resolution:{defaultValue:{width:1280,height:720}},fullScreen:!1}};he()&&"hidden"!=(null==(i=t.visibility)?void 0:i.toString().toLowerCase())||delete n.headerButtons.flashBtn,this.options=b(e,n)},t.selectedFile=function(){var n=S(E().mark(function e(t,n){var r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.stop(),e.prev=1,(r=n.getPreviousPage())&&r instanceof y)return e.next=6,r.insertFile(t);e.next=6;break;case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(1),n.hideLoading("insert - load image"),e.t0;case 12:return e.prev=12,n.hideLoading("insert - load image"),e.finish(12);case 15:case"end":return e.stop()}},e,null,[[1,8,12,15]])}));return function(e,t){return n.apply(this,arguments)}}(),e}(N);function Mn(){return(Mn=S(E().mark(function e(t,n,r,i,a){var o,s,c,u,l;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.dcs,!(s=o.getPreviousPage()).isDestroyed&&s instanceof y){e.next=4;break}return e.abrupt("return");case 4:if(o.showLoading("OnInsertPageSave"),e.prev=5,c=o.config.scannerViewer||{},c=c.maxDocuments,u=c=void 0===c?20:c,l=s.getViewerByUid(s.getViewerUid()),!s.options.fromInternal||l.currentPageCount+1<=u&&l.currentPageCount+1<=c)return o.config&&o.config.scannerViewer&&o.config.scannerViewer.autoScan&&!o.config.scannerViewer.autoScan.enableAutoScan&&o.setLoadingNumber(2),e.next=13,o.packageBlobItemFromIImageData(r,!0,!0,!1);e.next=28;break;case 13:return u=e.sent,e.next=16,s.insertImgByBlobItem(u,o);case 16:if(l=e.sent,s.setInsertingImageIndex(l),0<=l)return e.next=21,s.handlePageByIndex(l);e.next=21;break;case 21:return i&&o.setImageDataBack(r.imageData),o.emit("blurPage"),e.next=25,o.navigateBack();case 25:e.sent,e.next=31;break;case 28:return o.emit("video-error",P.MAX_IMAGES_IN_BUFFER_LIMIT),e.next=31,o.navigateBack();case 31:return e.prev=31,o.stop(),o.hideLoading("OnInsertPageSave"),e.finish(31);case 35:case"end":return e.stop()}},e,null,[[5,,31,35]])}))).apply(this,arguments)}var Rn=[{width:320,height:240,type:"exact"},{width:640,height:480,type:"exact"},{width:640,height:360,type:"exact"},{width:800,height:600,type:"exact"},{width:1280,height:720,type:"exact"},{width:1920,height:1080,type:"exact"},{width:2560,height:1440,type:"exact"},{width:3840,height:2160,type:"exact"}],Fn={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}};function Nn(e){function n(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(Nn=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(e){var t=this.s.return;return void 0===t?Promise.resolve({value:e,done:!0}):n(t.apply(this.s,arguments))},throw:function(e){var t=this.s.return;return void 0===t?Promise.reject(e):n(t.apply(this.s,arguments))}},new Nn(e)}var Un=function(){function e(e,t,n,r){this.videoSettings=Fn,this._browserInfo=null,this._isPlugOut=!1,this._resolutionSelector=null,this._cameraInfo=null,this._allCameras=null,this._videoTrack=null,this._allResolutions=[],this._curResolution=null,this._videoEle=null,this._isFill=!1,this._isUser=!1,this._useWebgl=!0,this.videoGlCvs=null,this.videoGl=null,this.glImgData=null,this.glCropImgData=null,this._cameraManager=null,this._oPub=null,this._browserInfo=C.navInfo,!this._browserInfo.bMobile&&this._browserInfo.bSafari?15<=parseInt(this._browserInfo.strBrowserVersion)&&(this._useWebgl=!1):this._browserInfo.bHuaWeiBrowser&&(this._useWebgl=!1),this._cameraInfo=e||{deviceId:"",label:""},this._videoEle=t,this._allCameras=n,this._oPub=r||new dt}var t=e.prototype;return t.getFrame=function(){Date.now();var e,t,n=this._videoEle.videoWidth,r=this._videoEle.videoHeight,i=(this.videoGlCvs||(this.videoGlCvs=globalThis.OffscreenCanvas?new globalThis.OffscreenCanvas(n,r):document.createElement("canvas")),this.videoGlCvs),a=this._useWebgl,o=null;return(o=a?this.videoGl||i.getContext("webgl",{alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!0})||i.getContext("experimental-webgl",{alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!0}):o)&&a||(a=!1,this.videoGlCvs=document.createElement("canvas"),i=this.videoGlCvs),i.width==n&&i.height==r||(i.height=r,i.width=n,o&&o.viewport(0,0,n,r)),a?(this.videoGl||(a=(this.videoGl=o).createShader(o.VERTEX_SHADER),o.shaderSource(a,"\nattribute vec4 a_position;\nattribute vec2 a_uv;\n\nvarying vec2 v_uv;\n\nvoid main() {\ngl_Position = a_position;\nv_uv = a_uv;\n}\n"),o.compileShader(a),o.getShaderParameter(a,o.COMPILE_STATUS),t=o.createShader(o.FRAGMENT_SHADER),o.shaderSource(t,"\nprecision lowp float;\n\nvarying vec2 v_uv;\n\nuniform sampler2D u_texture;\n\nvoid main() {\nvec4 sample =  texture2D(u_texture, v_uv);\ngl_FragColor = vec4(sample.b, sample.g, sample.r, 1.0);\n}\n"),o.compileShader(t),o.getShaderParameter(t,o.COMPILE_STATUS),e=o.createProgram(),o.attachShader(e,a),o.attachShader(e,t),o.linkProgram(e),o.getProgramParameter(e,o.LINK_STATUS),o.useProgram(e),o.bindBuffer(o.ARRAY_BUFFER,o.createBuffer()),o.bufferData(o.ARRAY_BUFFER,new Float32Array([-1,1,0,1,1,1,1,1,-1,-1,0,0,1,-1,1,0]),o.STATIC_DRAW),a=o.getAttribLocation(e,"a_position"),o.enableVertexAttribArray(a),o.vertexAttribPointer(a,2,o.FLOAT,!1,16,0),t=o.getAttribLocation(e,"a_uv"),o.enableVertexAttribArray(t),o.vertexAttribPointer(t,2,o.FLOAT,!1,16,8),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,o.createTexture()),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.uniform1i(o.getUniformLocation(e,"u_texture"),0)),(!this.glImgData||this.glImgData.length<n*r*4)&&(this.glImgData=new Uint8Array(n*r*4)),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,this._videoEle),o.drawArrays(o.TRIANGLE_STRIP,0,4),a=this.glImgData,o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,a),this.glImgData):((t=i.getContext("2d")).drawImage(this._videoEle,0,0),0===i.width||0===i.height?null:((!this.glImgData||this.glImgData.length<i.width*i.height*4)&&(this.glImgData=new Uint8Array(i.width*i.height*4)),this.glImgData.set(t.getImageData(0,0,i.width,i.height).data),this.glImgData))},t.capture=function(){var t=S(E().mark(function e(t){var n,r,i,a,o,s,c,u,l,d,h,f,p,g,v;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=!1),n=null,e.prev=2,T.log("capture"),s=this._videoEle,s.videoHeight,r=s.videoWidth,s=this.getVideoSizeInfo(),i=s.width,a=s.height,o=s.offsetX,s=s.offsetY,c=this.getFrame(),l=u=!1,this.videoGl?l=!0:u=!0,n={imageData:null,imageWidth:i,imageHeight:a,rgba:u,bgra:l},this._isFill){for((!this.glCropImgData||this.glCropImgData.length<i*a*4)&&(this.glCropImgData=new Uint8Array(i*a*4)),d=this.glCropImgData,h=0,f=s+a,p=s;p<f;p++)g=4*(p*r+o),v=h*i*4,d.set(c.subarray(g,g+4*i),v),h++;n.imageData=d.buffer}else n.imageData=c.buffer;if(t){e.next=16;break}return e.next=15,we(n);case 15:return e.abrupt("return",e.sent);case 16:e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(2),e.abrupt("return",Promise.reject(e.t0));case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}},e,this,[[2,18]])}));return function(e){return t.apply(this,arguments)}}(),t.setImageDataBack=function(e){T.log("setImageDataBack"),this._isFill?this.glCropImgData=new Uint8Array(e):this.glImgData=new Uint8Array(e)},t.getVideoSizeInfo=function(){var e=this._videoEle;if("none"==(null==e||null==(t=e.style)?void 0:t.display))return t=e.videoHeight,{width:e.videoWidth,height:t,offsetX:0,offsetY:0};if("playing"!==this.getStatus())throw P.VIDEO_NOT_PLAY;var t=e.getBoundingClientRect(),n=t.width,t=t.height;if(0===n||0===t)throw P.CAPTURE_NO_IMAGE;var r,i,a,o=0,s=0,c=e.videoHeight,e=e.videoWidth;return this._isFill?(r=n/(e*(n=Math.max(n/e,t/c))),t=t/(c*n),i=Math.floor(e*r),a=Math.floor(c*t),o=Math.floor((1-r)/2*e),s=Math.floor((1-t)/2*c)):(i=e,a=c),{width:i,height:a,offsetX:o,offsetY:s}},t.setFillMode=function(e){this._isFill=e,this._videoEle&&(this._videoEle.style.objectFit=e?"cover":"contain")},t.setPlugOut=function(){this._isPlugOut=!0},t._checkPlugOut=function(){this._isPlugOut&&this._oPub.emit("video-error",P.CAMERA_PLUG_OUT)},t.getResolutions=function(){var t=S(E().mark(function e(t){var n,r,i,a,o,s,c,u,l,d;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=!1),0<this._allResolutions.length&&!t)return e.abrupt("return",this._allResolutions);e.next=3;break;case 3:if(this._cameraInfo){e.next=5;break}return e.abrupt("return",null);case 5:n=[],this._allResolutions=[],i=r=!1,e.prev=9,o=function(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new Nn(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}(Rn);case 11:return e.next=13,o.next();case 13:if(r=!(l=e.sent).done)return l=l.value,s=l.width,c=l.height,l=l.type,e.next=18,ce(this._cameraInfo.deviceId,s,c,l,this._browserInfo,this._allCameras,this._oPub);e.next=32;break;case 18:if(u=e.sent,l=u&&u.height,d=u.height===c&&u.width===s||u.height===s&&u.width===c,l&&d){e.next=27;break}return e.next=24,ce(this._cameraInfo.deviceId,s,c,"ideal",this._browserInfo,this._allCameras,this._oPub);case 24:return(d=e.sent)&&d.height&&!function(e,t){for(var n=e.width,r=e.height,i=ae(t);!(a=i()).done;){var a=a.value;if(a.height===r&&a.width===n)return 1}}({width:d.width,height:d.height},n)&&(delete d.type,n.push(d)),e.abrupt("continue",29);case 27:delete u.type,n.push(u);case 29:r=!1,e.next=11;break;case 32:e.next=38;break;case 34:e.prev=34,e.t0=e.catch(9),i=!0,a=e.t0;case 38:if(e.prev=38,e.prev=39,r&&null!=o.return)return e.next=43,o.return();e.next=43;break;case 43:if(e.prev=43,i)throw a;e.next=46;break;case 46:return e.finish(43);case 47:return e.finish(38);case 48:return this._allResolutions=n,e.abrupt("return",n);case 50:case"end":return e.stop()}},e,this,[[9,34,38,48],[39,,43,47]])}));return function(e){return t.apply(this,arguments)}}(),t.setResolution=function(){var n=S(E().mark(function e(t,n){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.playing())return e.abrupt("return",this.play(t,n,this._cameraManager));e.next=2;break;case 2:return this._curResolution={width:t,height:n},e.abrupt("return",this._curResolution);case 4:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),t.getCurrentResolution=function(){return this._curResolution},t.getCameraInfo=function(){return this._cameraInfo},t.destroy=function(){this.stop(),this._cameraInfo=null,this._allCameras=null,this._allResolutions=null,this._videoEle=null,this._browserInfo=null,this.videoGlCvs&&(this.videoGlCvs.width=0,this.videoGlCvs.height=0),this.videoGlCvs=null},t.stop=function(){this._videoEle&&this._videoEle.srcObject&&(this._videoEle.srcObject.getTracks().forEach(function(e){e.stop()}),this._videoEle.srcObject=null,this._videoTrack=null)},t.getDeviceId=function(e){if(e){e=e.getVideoTracks();if(e.length)return this._videoTrack=e[0],this._videoTrack.getSettings().deviceId}return""},t.updateCameraInfo=function(e){var t={};return e&&(e=e.getVideoTracks()).length&&(this._videoTrack=e[0],e={deviceId:(t=this._videoTrack.getSettings()).deviceId,label:this._videoTrack.label},this._cameraInfo=e),t},t.getBestMediaStream=function(){var r=S(E().mark(function e(t,n,r){var i,a,o,s;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.videoSettings=se(this._cameraInfo.deviceId,t,n,r,!0,this._browserInfo,this._allCameras,this._isUser),i=this.videoSettings,e.prev=2,e.next=5,le(i,!0,this._browserInfo,this._allCameras);case 5:if(a=e.sent,o=this.getDeviceId(a),this._cameraManager&&i.bFmEnvironment&&!this._isUser)return e.next=10,this._cameraManager.getAllCamerasInfo();e.next=21;break;case 10:if(this._allCameras=e.sent,this.videoSettings=se(this._cameraInfo.deviceId,t,n,r,!0,this._browserInfo,this._allCameras,this._isUser),"boolean"==typeof(i=this.videoSettings).video&&(i.video={}),(s=(s=i.video.deviceId)&&(s.exact||s.ideal||s))&&0<o.length&&o!=s)return a.getTracks().forEach(function(e){e.stop()}),e.next=20,le(i,!0,this._browserInfo,this._allCameras);e.next=21;break;case 20:a=e.sent;case 21:return s=this.updateCameraInfo(a),e.abrupt("return",{settings:s,stream:a});case 25:e.prev=25,e.t0=e.catch(2),"NotAllowedError"===e.t0.name||"Permission denied"===e.t0.message?this.throwError(P.CAMERA_NOT_OPEN):this.throwError(P.FAILED_GET_USERMEDIA);case 28:case"end":return e.stop()}},e,this,[[2,25]])}));return function(e,t,n){return r.apply(this,arguments)}}(),t.play=function(){var r=S(E().mark(function e(t,n,r){var i,a,o,s,c;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(i=this._videoEle)||this.throwError(P.VIDEO_ELEMENT_REQUIRED),this._cameraManager=r,this._checkPlugOut(),c=this._curResolution,s=this._allResolutions,"number"==typeof t&&0<t&&"number"==typeof n&&0<n||(t=c?c.width:1280,n=c?c.height:720),c=function(e,t){for(var n=e.width,r=e.height,i=ae(t);!(a=i()).done;){var a=a.value;if(a.height===r&&a.width===n)return a.type}return"ideal"}({width:t,height:n},s),this.stop(),e.next=10,this.getBestMediaStream(t,n,c);case 10:if(a=e.sent){e.next=13;break}return e.abrupt("return",Promise.reject(P.NO_CAMERA_SELECTED));case 13:return o=a.settings,s=a.stream,i.srcObject=s,e.next=17,new Promise(function(t){i.onloadedmetadata=function(e){t(e)}});case 17:return e.prev=17,e.next=20,i.play();case 20:e.next=28;break;case 22:return e.prev=22,e.t0=e.catch(17),e.next=26,new Promise(function(e){setTimeout(e,1e3)});case 26:return e.next=28,i.play();case 28:return c={width:i.videoWidth,height:i.videoHeight},o.width&&o.height&&(o.width===t&&o.height===n||o.width===n&&o.height===t)&&(c.width=t,c.height=n),this._curResolution=c,this._oPub.emit("onPlayed",i),e.abrupt("return",c);case 33:case"end":return e.stop()}},e,this,[[17,22]])}));return function(e,t,n){return r.apply(this,arguments)}}(),t.pause=function(){this._videoEle&&this._videoEle.pause()},t.resume=function(){this._videoEle&&this.paused()&&this.playing()&&this._videoEle.play()},t.paused=function(){return!!this._videoEle&&this._videoEle.paused},t.playing=function(){if(this._isPlugOut)return!1;if(this._videoEle&&this._videoEle.srcObject)try{var e=this._videoEle.srcObject;if(e){var t=e.getVideoTracks();if(t&&0!==t.length)return!0}}catch(e){this.throwError(e)}return!1},t.getStatus=function(){return this.playing()?this.paused()?"paused":"playing":"stopped"},t.getVideoSetting=function(){return this.videoSettings},t.toggleCamera=function(e,t,n){return this._isUser=!this._isUser,this._cameraInfo.deviceId="",this.play(e,t,n)},t.throwError=function(e){this._oPub.emit(ee,e)},t.getCapabilities=function(){try{var e,t=null!=(e=this._videoTrack)&&e.getCapabilities?this._videoTrack.getCapabilities():{}}catch(e){t={}}return he()||(t.torch=!1),t},t.getCameraSettings=function(){var e;return null==(e=this._videoTrack)?void 0:e.getSettings()},t.getConstraints=function(){var e;return null==(e=this._videoTrack)?void 0:e.getConstraints()},t._throw_NotSupportException=function(){throw this._oPub.emit("onThrowError",P.CAMERA_SETTINGS_NOT_SUPPORT),P.CAMERA_SETTINGS_NOT_SUPPORT},t._fireLog=function(e){this._oPub.emit("onLog",e)},t.applyConstraints=function(){var t=S(E().mark(function e(t){var n;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null!=(n=this._videoTrack)&&n.applyConstraints||this._throw_NotSupportException(),e.next=3,null==(n=this._videoTrack)?void 0:n.applyConstraints(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),t.turnOnTorch=function(){var e=S(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._videoTrack){e.next=2;break}return e.abrupt("return");case 2:if(this.getCapabilities().torch)return e.next=6,this._videoTrack.applyConstraints({advanced:[{torch:!0}]});e.next=7;break;case 6:return e.abrupt("return",e.sent);case 7:this._throw_NotSupportException();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.turnOffTorch=function(){var e=S(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._videoTrack){e.next=2;break}return e.abrupt("return");case 2:if(this.getCapabilities().torch)return e.next=6,this._videoTrack.applyConstraints({advanced:[{torch:!1}]});e.next=7;break;case 6:return e.abrupt("return",e.sent);case 7:this._throw_NotSupportException();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.setColorTemperature=function(){var t=S(E().mark(function e(t){var n;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getCapabilities(),(n=n.colorTemperature)||this._throw_NotSupportException(),t<n.min?t=n.min:t>n.max&&(t=n.max),e.next=6,null==(n=this._videoTrack)?void 0:n.applyConstraints({advanced:[{colorTemperature:t}]});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),t.setExposureCompensation=function(){var t=S(E().mark(function e(t){var n;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getCapabilities(),(n=n.exposureCompensation)||this._throw_NotSupportException(),t<n.min?t=n.min:t>n.max&&(t=n.max),e.next=6,null==(n=this._videoTrack)?void 0:n.applyConstraints({advanced:[{exposureCompensation:t}]});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),t.setZoom=function(){var t=S(E().mark(function e(t){var n;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getCapabilities(),(n=n.zoom)||this._throw_NotSupportException(),t<n.min?t=n.min:t>n.max&&(t=n.max),e.next=6,null==(n=this._videoTrack)?void 0:n.applyConstraints({advanced:[{zoom:t}]});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),t.setFrameRate=function(){var t=S(E().mark(function e(t){var n;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getCapabilities(),(n=n.frameRate)||this._throw_NotSupportException(),t<n.min?t=n.min:t>n.max&&(t=n.max),e.next=6,null==(n=this._videoTrack)?void 0:n.applyConstraints({width:{ideal:Math.max(this._videoEle.videoWidth,this._videoEle.videoHeight)},frameRate:t});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),e}();function On(e,t){var n,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Hn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Hn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),n=0,function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Hn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Wn=function(n){function e(e,t){e=n.call(this,e)||this;return e._allCamerasInfo=[],e.selectedCamera=null,e.videoEl=null,e._trackCameraDeviceChanged(),e._initEl(t),e}o(e,n);var t=e.prototype;return t.selectCamera=function(){var t=S(E().mark(function e(t){var n,r,i,a,o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._allCamerasInfo.length){e.next=3;break}return e.next=3,this.getAllCamerasInfo();case 3:if(n=this._allCamerasInfo,t=t||new Un(null,this.videoEl,n,this._oPub),r=null,!M(t)){e.next=21;break}i={deviceId:"",label:""},a=0;case 9:if(!(a<n.length)){e.next=19;break}if(o=n[a],t===o.deviceId)return i.deviceId=o.deviceId,i.label=o.label,r=new Un(i,this.videoEl,n,this._oPub),e.abrupt("break",19);e.next=16;break;case 16:a++,e.next=9;break;case 19:e.next=22;break;case 21:t instanceof Un&&(r=t);case 22:return this.selectedCamera&&this.selectedCamera.destroy(),this.selectedCamera=r,e.abrupt("return",r);case 25:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),t.closeCamera=function(){this.selectedCamera&&(this.selectedCamera.destroy(),this.selectedCamera=null)},t.getCurrentCamera=function(){return this.selectedCamera},t.destroy=function(){this._oPub.off("onCameraChanged")},t.getAllCamerasInfo=function(){var e=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return jn(this._oPub),e.next=3,function(){return Gn.apply(this,arguments)}();case 3:return t=e.sent,this._allCamerasInfo=t,e.abrupt("return",this._allCamerasInfo);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t._trackCameraDeviceChanged=function(){var t=this;void 0!==navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=function(e){t._cameraChangedHandler(e)})},t._initEl=function(e){e?this.videoEl=e:((e=document.createElement("video")).className=B.cameraVideo,e.playsInline=!0,e.muted=!0,this.videoEl=e,this._oPub.on("onPlayed",function(e){qn(e)}))},t._cameraChangedHandler=function(e){},t._requestCamera=function(){var e=S(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return jn(this._oPub),0===this._allCamerasInfo.length&&this._oPub.emit("onThrowError",P.NO_CAMERA),e.next=4,this._checkAllowCamera();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t._checkAllowCamera=function(){var e=S(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),t.requestCamera=function(){var e=S(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),e.cameraExist=function(e,t){return!0},e}(e);function jn(e){if(void 0===navigator.mediaDevices)throw t=location.origin,n="https://",0!==t.lastIndexOf(n,0)?(ot(e,P.HTTPS_REQUIRED),P.HTTPS_REQUIRED):(ot(e,P.MEDIADEVICES_NOT_IMPL),P.MEDIADEVICES_NOT_IMPL);if(void 0===navigator.mediaDevices.getUserMedia)throw ot(e,P.GETUSERMEDIA_NOT_IMPL),P.GETUSERMEDIA_NOT_IMPL;var t,n}function Gn(){return(Gn=S(E().mark(function e(){var t,n,r,i,a,o,s,c;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,navigator.mediaDevices.enumerateDevices();case 3:t=e.sent,n=[],i=r=0;case 7:if(!(i<t.length)){e.next=24;break}if("videoinput"!==(a=t[i]).kind)return e.abrupt("continue",21);e.next=11;break;case 11:o=!1,s=On(n);case 13:if((c=s()).done){e.next=20;break}if(c.value.deviceId===a.deviceId)return o=!0,e.abrupt("break",20);e.next=18;break;case 18:e.next=13;break;case 20:o||((c={}).deviceId=a.deviceId,c.label=!a.label||/^camera\s[0-9]+$/.test(a.label)?"camera "+r++:a.label,n.push(c));case 21:i++,e.next=7;break;case 24:return e.abrupt("return",n);case 25:case"end":return e.stop()}},e)}))).apply(this,arguments)}function qn(e,t,n){var r,i,a,o;e&&(i=e.style.objectFit,t=t&&n?(o=t,n):(o=e.videoWidth,e.videoHeight),a=(n=e.getBoundingClientRect()).width,n=n.height,r={zoom:1,left:0,top:0},"cover"===i?(i=Math.max(a/o,n/t),r.zoom=i):(a=(a-o*(i=Math.min(a/o,n/t)))/2,o=(n-t*i)/2,r.zoom=i,r.left=a,r.top=o),e.videoLayout=r)}var Xn=function(n){function e(e,t){e=n.call(this,e)||this;return e._showCanvas=null,e._containerEl=null,e._videoEl=null,e._obEl=null,e._srcVideoInfo=null,e._videoEl=t,e._showCanvas=e.createCameraCanvas(),e}o(e,n);var t=e.prototype;return t.createCameraCanvas=function(){var e=document.createElement("canvas");return e.className=B.cameraCvs,e.addEventListener("touchstart",function(e){"touchstart"===e.type&&e.cancelable&&e.preventDefault()},{passive:!1}),e},t.getCameraDvs=function(){return this._showCanvas},t.resetVideoInfo=function(){var e;C.navInfo.bMobile&&(C.navInfo.biPhone||C.navInfo.biPad)&&(e=0==(e=window.orientation)||180==e?0:90,this._srcVideoInfo={videoWidth:this._videoEl.videoWidth,videoHeight:this._videoEl.videoHeight,orientation:e})},t.bindView=function(e){var i=this,e=M(e)?document.getElementById(e):e;if(!e)return!1;var t=this._showCanvas,n=this._videoEl,r=n.parentElement,r=(null!=r&&r.remove(),document.createElement("div")),a=(r.className=B.cameraContainer,r.appendChild(n),r.appendChild(t),this._containerEl=r,e.appendChild(r),this.updateCanvasRect(),this);return this._obEl=new pn(r,function(e){var t,n,r;C.navInfo.bMobile&&(C.navInfo.biPhone||C.navInfo.biPad)&&a._videoEl&&0<a._videoEl.videoWidth&&0<a._videoEl.videoHeight&&(r=0==(r=window.orientation)||180==r?0:90,a._srcVideoInfo?r==a._srcVideoInfo.orientation?(t=a._srcVideoInfo.videoWidth,n=a._srcVideoInfo.videoHeight):(n=a._srcVideoInfo.videoHeight,t=a._srcVideoInfo.videoWidth):(a._srcVideoInfo={videoWidth:a._videoEl.videoWidth,videoHeight:a._videoEl.videoHeight,orientation:r},t=a._srcVideoInfo.videoWidth,n=a._srcVideoInfo.videoHeight)),qn(a._videoEl,t,n),a.updateCanvasRect(),i._oPub.emit("uiResize",e)}),!0},t.updateCanvasRect=function(){this._showCanvas&&(this._showCanvas.width=this._showCanvas.getBoundingClientRect().width,this._showCanvas.height=this._showCanvas.getBoundingClientRect().height)},t.unbindView=function(){this._obEl&&(this._obEl.dispose(),this._obEl=null);var e=this._containerEl;return!!e&&(e.remove(),!0)},t.dispose=function(){this.unbindView(),this._showCanvas&&(this._showCanvas.removeEventListener("touchstart",null),this._showCanvas.width=1,this._showCanvas.height=1,this._showCanvas.remove()),this._showCanvas=null,this._containerEl=null,this._videoEl=null,this._obEl=null},e}(e);function zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p,Yn=function(){function e(){this.path=[],this._removedPages=[],this._currentPage=null}var t,n,r=e.prototype;return r.setCurrentPage=function(){var n=S(E().mark(function e(t,n){var r,i,a;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=!0),r=this._currentPage,this._currentPage=t,r&&r instanceof N?(i=r.getDcs())&&i.emit("blurPage"):t&&t instanceof N&&t.pageName==K&&(i=t.getDcs())&&i.emit("focusPage"),t)return e.next=7,function(){return ge.apply(this,arguments)}(t,n);e.next=7;break;case 7:r&&!t&&(a=r.getDcs())&&(a.off("blurPage"),a.off("focusPage"));case 8:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),r.navigateTo=function(){var n=S(E().mark(function e(t,n){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=!0),this.path.push(t),e.next=4,this.setCurrentPage(t,n);case 4:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),r.redirectTo=function(e){this.closeAllPages(),this.navigateTo(e)},r.redirectToHome=function(){var e=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.path.length,this.navigatePopPageSync(t-1),e.next=4,this.resetCurrentPageAfterPopPage();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),r.navigatePopPageSync=function(e,t){void 0===e&&(e=1),void 0===t&&(t=!0);for(var n=this.path;0<e;){var r=n.pop();r&&!r.isDestroyed&&(t&&r.hide(),this._removedPages.push(r)),e--}return null},r.getRemovedPages=function(){return this._removedPages},r.destroyRemovedPages=function(){this._removedPages.forEach(function(e){pe(e)}),this._removedPages=[]},r.closeAllPages=function(){this.path.forEach(function(e){pe(e)}),this.path=[],this.destroyRemovedPages(),this.setCurrentPage(null)},r.hideAllPages=function(){this.path.forEach(function(e){e.hide()})},r.showAllPages=function(){this.path.forEach(function(e){e.show()})},r.showDocumentScanPage=function(e,t,n){e=new N(e,t,n);return this.navigateTo(e),n.captureLoop&&(n.captureLoop.setEnable(),n.once("onPlayed",function(){n.captureLoop&&n.captureLoop.startLoop({dcs:n})}),n.once("video-closed",function(){L(n),n.captureLoop&&n.captureLoop.stopCaptureLoop()}),(n.config.scannerViewer.autoDetect||n.config.scannerViewer.autoScan)&&(n.captureLoop.loadLoopTypeFromConfig(),n.captureLoop.clearCaptureTimer()),n.on("blurPage",function(){n.captureLoop&&n.captureLoop.isEnable()&&(n.captureLoop.saveLoopTypeToConfig(),n.captureLoop.stopCaptureLoop(),n.captureLoop.setDisable())}),n.on("focusPage",function(){n.captureLoop&&(n.captureLoop.setEnable(),n.config.scannerViewer.autoScan.enableAutoScan?n.captureLoop.setAutoScan():n.config.scannerViewer.autoDetect.enableAutoDetect&&!n.config.scannerViewer.autoScan.enableAutoScan?n.captureLoop.setAutoDetect():n.captureLoop.changeStyle())})),e.moveMultipleImgPosition(),e},r.showInsertPage=function(e,t,n){var r=n.getCurrentPage(),e=new Vn(e,t,n);return this.navigateTo(e),r.hide(),n.captureLoop&&(n.captureLoop.setEnable(),n.once("onPlayed",function(){n.captureLoop&&n.captureLoop.startLoop({dcs:n})}),n.once("video-closed",function(){L(n),n.captureLoop&&n.captureLoop.stopCaptureLoop()}),n.captureLoop.loadLoopTypeFromConfig()),e},r.showCropPage=function(n,e,t){var r=t.getCurrentPage(),i=new In(n,e,t),a=n.documentEditorSettings||t.config.documentEditorSettings,o=this,e=n.doFillData?i.fillOrigCustomDataFirstTime():Promise.resolve();return e.then(S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:return t=Je(n.visibility)&&Je(a.visibility),e.next=5,o.navigateTo(i,t);case 5:!i.isDestroyed&&t?i.render():i.hide(),r&&r.pageName!=te.toLowerCase&&r.hide();case 7:case"end":return e.stop()}},e)}))),i},r.showDocumentEditPage=function(n,e,t){var r,i=t.getCurrentPage(),a=new y(n,e,t),o=n.documentEditorSettings||t.config.documentEditorSettings,e=n.doFillData?a.fillOrigCustomDataFirstTime():Promise.resolve();return Je(n.visibility)&&(r=this,e.then(S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:return t=Je(n.visibility)&&Je(o.visibility),e.next=5,r.navigateTo(a,t);case 5:!a.isDestroyed&&t?a.render():a.hide(),i&&i.pageName!=ne.toLowerCase&&i.hide();case 7:case"end":return e.stop()}},e)})))),a},r.removePage=function(){var t=S(E().mark(function e(t){var n,r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.path.length)<=1)return this.navigatePopPageSync(),e.next=5,this.resetCurrentPageAfterPopPage();e.next=6;break;case 5:return e.abrupt("return");case 6:if(this.path[n-1]==t)return this.navigatePopPageSync(),e.next=11,this.resetCurrentPageAfterPopPage();e.next=12;break;case 11:return e.abrupt("return");case 12:r=n-2;case 13:if(!(0<=r)){e.next=21;break}if(this.path[r]==t)return this.path.splice(r,1),e.abrupt("return");e.next=18;break;case 18:r--,e.next=13;break;case 21:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),r.resetCurrentPageAfterPopPage=function(){var t=S(E().mark(function e(t){var n,r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=!0),0<(n=this.path).length)return r=n[n.length-1],e.next=6,this.setCurrentPage(r,t);e.next=7;break;case 6:return e.abrupt("return",r);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),r=e,(t=[{key:"currentPage",get:function(){return this._currentPage}},{key:"previousPage",get:function(){var e=this.path;return 2<=e.length?e[e.length-2]:null}}])&&zn(r.prototype,t),n&&zn(r,n),Object.defineProperty(r,"prototype",{writable:!1}),e}(),Qn=((n=p=p||{})[n.None=0]="None",n[n.AutoScan=1]="AutoScan",n[n.AutoDetect=2]="AutoDetect",function(){function t(e){this.isLooping=!1,this._dcs=null,this._cameraCvs=null,this._enabled=!1,this._loopType=p.None,this.loopTimer=null,this.lastConfirmTime=0,this.lastDetectTime=(new Date).getTime(),this._captureLoopSub=new dt,this._oldLoopType=[],this._dcs=e}var e=t.prototype;return e.dispose=function(){this._loopType=p.None,this.clearCaptureTimer(),this._dcs=null,this._captureLoopSub=null,this._cameraCvs=null},e.resetLastConfirmTime=function(){this.lastConfirmTime=0},e.setAutoScan=function(){this.innerSetNextLoopType(p.AutoScan)},e.setAutoDetect=function(){this.innerSetNextLoopType(p.AutoDetect)},e.innerSetNextLoopType=function(e){this._loopType==t.EnumLoopType_ManualScan?0==this._oldLoopType.length?this._oldLoopType.push(e):this._oldLoopType[0]=e:(this._loopType=e,this.changeStyle(),this.clearCaptureTimer(),this.startLoop({dcs:this._dcs}))},e.saveLoopTypeToConfig=function(){this._loopType==p.AutoScan?(this._dcs.config.scannerViewer.autoScan.enableAutoScan=!0,this._dcs.config.scannerViewer.autoDetect.enableAutoDetect=!0):this._loopType==p.AutoDetect?(this._dcs.config.scannerViewer.autoScan.enableAutoScan=!1,this._dcs.config.scannerViewer.autoDetect.enableAutoDetect=!0):(this._dcs.config.scannerViewer.autoScan.enableAutoScan=!1,this._dcs.config.scannerViewer.autoDetect.enableAutoDetect=!1)},e.loadLoopTypeFromConfig=function(){this.isAutoButtonEnabled()&&this._dcs.config.scannerViewer.autoScan.enableAutoScan?(this._loopType=p.AutoScan,this._dcs.config.scannerViewer.autoDetect.enableAutoDetect=!0):this.isAutoButtonEnabled()&&this._dcs.config.scannerViewer.autoDetect.enableAutoDetect?this._loopType=p.AutoDetect:(this._loopType=p.None,this._dcs.config.scannerViewer.autoDetect.enableAutoDetect=!1,this._dcs.config.scannerViewer.autoScan.enableAutoScan=!1),this.changeStyle()},e.getLoopType=function(){return this._loopType},e._setLoopType=function(e){this._loopType=e},e.setIsLooping=function(e){this.isLooping=e},e.getIsLooping=function(){return this.isLooping},e.setEnable=function(){this.isAutoButtonEnabled()&&(this._enabled=!0)},e.setDisable=function(){this._enabled=!1},e.isEnable=function(){return this._enabled},e.isAutoButtonDisabled=function(){return 1!=this._dcs.config.scannerViewer.enableBorderDetection},e.isAutoButtonEnabled=function(){return 1==this._dcs.config.scannerViewer.enableBorderDetection},e.startManualCapture=function(e){var s=this;T.log("startManualCapture"),this._oldLoopType.push(this._loopType),this._captureLoopSub.once("onCapturedImage",function(){var r=S(E().mark(function e(t,n,r){var i,a,o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={dcs:t,page:t.getCurrentPage()},e.prev=1,a=t.config.scannerViewer,a=(void 0===a?{}:a).continuousScan,0==(void 0===a?{}:a).enableContinuousScan&&s.loadLoopTypeFromConfig(),e.next=7,i.page.emitEx("onSaveCapture",!1,i,n,!0,r);case 7:e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),T.log("manual capture error."),T.log(e.t0),702==e.t0.code&&(t.hideLoading("startManualCapture 1"),t.emit(ee,e.t0));case 14:if(!t.captureLoop){e.next=30;break}if((o=t.captureLoop._oldLoopType).length<=0)return T.log("manual capture stack error."),t.captureLoop._loopType=p.None,t.hideLoading("startManualCapture 2"),e.abrupt("return");e.next=21;break;case 21:if(t.captureLoop._loopType=o.pop(),t.captureLoop.resetLastConfirmTime(),t.captureLoop.loopTypeIsManualScan())return t.captureLoop.innerLoop(i),t.hideLoading("startManualCapture 3"),e.abrupt("return");e.next=27;break;case 27:t.hideLoading("startManualCapture 4"),t.captureLoop.innerLoop(i),t.captureLoop.changeStyle();case 30:case"end":return e.stop()}},e,null,[[1,9]])}));return function(e,t,n){return r.apply(this,arguments)}}()),this.lastConfirmTime=(new Date).getTime(),this.loopTypeIsManualScan()||(this._loopType=t.EnumLoopType_ManualScan,this._dcs.showLoading("startManualCapture start loop"),this.isLooping||(this.clearCaptureTimer(),this.innerLoop(e)))},e.startLoop=function(e){T.log("startLoop"),this.isAutoButtonDisabled()&&(this._loopType=p.None),this._loopType==p.AutoScan||this._loopType==p.AutoDetect?null==this.loopTimer&&(this.lastConfirmTime=0,this.isLooping||(this.clearCaptureTimer(),this.innerLoop(e))):(this.stopCaptureLoop(),this._dcs.hideLoading("startLoop")),this.changeStyle()},e.changeStyle=function(){var e=null==(e=this._dcs)||null==(e=e.getCurrentPage())?void 0:e.element;if(e){var t=null==e?void 0:e.querySelector("."+B.BUTTON_PREFIX+"autoCapture"),n=null==e?void 0:e.querySelector("."+B.BUTTON_PREFIX+"captureBtn"),e=null==e?void 0:e.querySelector("."+B.BUTTON_PREFIX+"detectCamera");if(this.isAutoButtonDisabled())return t&&(t.classList.remove(B.footerSelected),t.classList.add(B.disable),t.bSelected=!1),e&&n.classList.remove(B.capturing),void(e&&(e.classList.remove(B.headerSelected),e.classList.add(B.disable),e.bSelected=!1));this._loopType==p.AutoScan?(t&&(t.classList.add(B.footerSelected),t.bSelected=!0),e&&n.classList.add(B.capturing),e&&(e.classList.add(B.headerSelected),e.bSelected=!0)):this._loopType==p.AutoDetect?(t&&(t.classList.remove(B.footerSelected),t.bSelected=!1),e&&n.classList.remove(B.capturing),e&&(e.classList.add(B.headerSelected),e.bSelected=!0)):(t&&(t.classList.remove(B.footerSelected),t.classList.remove(B.disable),t.bSelected=!1),e&&n.classList.remove(B.capturing),e&&(e.classList.remove(B.headerSelected),e.classList.remove(B.disable),e.bSelected=!1))}},e.getDetectRemainTime=function(){var e=(new Date).getTime(),t=R(this._dcs,"config.scannerViewer.autoDetect").fpsLimit,e=e-this.lastDetectTime;return Math.max(0,1e3/(void 0===t?3:t)-e)},e.loopTypeIsNone=function(){return this._loopType==p.None},e.loopTypeIsManualScan=function(){return this._loopType==t.EnumLoopType_ManualScan},e.innerLoop=function(n){var r=this,i=n.dcs,e=i.getAreaDetectCallback(),t=this.getDetectRemainTime();if(e)return this.loopTypeIsNone()?this.exitAutoCaptureFromInner(0):void((this._loopType!=p.AutoScan&&this._loopType!=p.AutoDetect||this.isEnable())&&(clearTimeout(this.loopTimer),this.loopTimer=setTimeout(S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.loopTypeIsNone())return e.abrupt("return",r.exitAutoCaptureFromInner(1));e.next=2;break;case 2:if(r.isLooping)return e.abrupt("return");e.next=4;break;case 4:return r.isLooping=!0,e.next=7,r.innerLoopTimeout(n);case 7:t=e.sent,r.isLooping=!1,t&&(r._loopType==p.AutoScan||r._loopType==p.AutoDetect)&&r.isEnable()?setTimeout(function(){!i.captureLoop||i.captureLoop._loopType!=p.AutoScan&&i.captureLoop._loopType!=p.AutoDetect||!i.captureLoop.isEnable()||i.captureLoop.innerLoop(n)},10):r.clearCaptureTimer();case 10:case"end":return e.stop()}},e)})),t)))},e.innerLoopTimeout=function(){var t=S(E().mark(function e(t){var n,r,i,a,o,s,c,u,l,d,h,f;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.dcs,this.lastDetectTime=(new Date).getTime(),i=n.config.scannerViewer,r=i.polygonStyle,r=void 0===r?{stroke:"#fe8e14",strokeWidth:"2px",dashed:"solid"}:r,i=i.autoDetect,i=void 0===i?{}:i,a=!0,e.prev=4,"playing"!=n.getStatus())return e.abrupt("return",!0);e.next=7;break;case 7:return e.next=9,n.capture(a);case 9:if(o=e.sent,this.loopTypeIsNone())return e.abrupt("return",this.exitAutoCaptureFromInner(2));e.next=14;break;case 14:if(this.loopTypeIsManualScan())return this._captureLoopSub.emit("onCapturedImage",n,o),e.abrupt("return",!1);e.next=17;break;case 17:return e.prev=17,e.next=20,Ie(o,n);case 20:if(s=e.sent,this._loopType!=p.AutoScan){e.next=69;break}if(c=s.cornerPoints,this.loopTypeIsNone())return T.log("loop setImageDataBack"),n.setImageDataBack(o.imageData),e.abrupt("return",this.exitAutoCaptureFromInner(3));e.next=27;break;case 27:if(!s.detectedArea){e.next=58;break}if(this.drawArea(c,r,n.getVideoElement()),this.loopTypeIsNone())return T.log("loop setImageDataBack"),n.setImageDataBack(o.imageData),e.abrupt("return",this.exitAutoCaptureFromInner(5));e.next=35;break;case 35:if(this.loopTypeIsManualScan())return this._captureLoopSub.emit("onCapturedImage",n,o,s),e.abrupt("return",!1);e.next=38;break;case 38:if(d=i.autoCaptureDelay,d=void 0===d?2e3:d,u=(new Date).getTime(),!(this._loopType==p.AutoScan&&0<this.lastConfirmTime&&u-this.lastConfirmTime>d)){e.next=55;break}if(0,n.showLoading("auto capture"),e.prev=43,d=t.dcs.getCurrentPage())return e.next=48,d.emitEx("onSaveCapture",!0,t,o,!0,s);e.next=48;break;case 48:return e.prev=48,n.hideLoading("auto capture"),e.finish(48);case 51:return n.captureLoop.resetLastConfirmTime(),e.abrupt("return",!0);case 55:0==this.lastConfirmTime&&(this.lastConfirmTime=u);case 56:e.next=62;break;case 58:T.log("[capture loop] detect result:"),T.log(s),this.lastConfirmTime=0,this.clearCanvas();case 62:if(this.loopTypeIsManualScan())return this._captureLoopSub.emit("onCapturedImage",n,o,s),e.abrupt("return",!1);e.next=65;break;case 65:T.log("loop setImageDataBack"),n.setImageDataBack(o.imageData),e.next=85;break;case 69:if(this._loopType!=p.AutoDetect){e.next=82;break}if(l=s.cornerPoints,T.log("loop setImageDataBack"),n.setImageDataBack(o.imageData),this.loopTypeIsNone())return e.abrupt("return",this.exitAutoCaptureFromInner(3));e.next=75;break;case 75:if(d=o.imageWidth,h=o.imageHeight,h=lt(l,d,h),this.loopTypeIsNone())return e.abrupt("return",this.exitAutoCaptureFromInner(4));e.next=79;break;case 79:h?this.clearCanvas():(f=n.getVideoElement(),n.captureLoop.drawArea(l,r,f)),e.next=85;break;case 82:if(this.loopTypeIsManualScan())return this._captureLoopSub.emit("onCapturedImage",n,o,s),e.abrupt("return",!1);e.next=85;break;case 85:e.next=90;break;case 87:e.prev=87,e.t0=e.catch(17),T.log(e.t0);case 90:e.next=95;break;case 92:e.prev=92,e.t1=e.catch(4),T.log(e.t1);case 95:return e.abrupt("return",!0);case 97:case"end":return e.stop()}},e,this,[[4,92],[17,87],[43,,48,51]])}));return function(e){return t.apply(this,arguments)}}(),e.exitAutoCaptureFromInner=function(e){return this.clearCaptureTimer(),this._dcs.hideLoading("innerLoop exitAutoCaptureFromInner"),T.log("auto capture loop: loopType is None "+e),!1},e.clearCaptureTimer=function(){clearTimeout(this.loopTimer),this.loopTimer=null,this.lastConfirmTime=0},e.stopCaptureLoop=function(){this._loopType=p.None,this.clearCaptureTimer(),this.clearCanvas()},e.getCameraCvs=function(){return this._cameraCvs||(this._cameraCvs=this._dcs.getCameraView().getCameraDvs()),this._cameraCvs},e.clearCanvas=function(){var e=this.getCameraCvs();e&&e.getContext("2d",{willReadFrequently:!0}).clearRect(0,0,e.width,e.height)},e.drawArea=function(e,t,n){var r=this.getCameraCvs(),i=r.getContext("2d",{willReadFrequently:!0}),r=(i.save(),i.clearRect(0,0,r.width,r.height),n.videoLayout),n=r.zoom,a=r.left,r=r.top;i.translate(a,r),i.scale(n,n),i.beginPath(),i.moveTo(e[0],e[1]);for(var o=2;o<e.length;o+=2){var s=e[o],c=e[o+1];i.lineTo(s,c)}i.closePath();a=parseInt(t.strokeWidth,10)/n;i.strokeStyle=t.stroke,i.lineCap="round",i.lineWidth=a,"dashed"===t.dash&&i.setLineDash([Math.max(2,a),Math.max(4,2*a)]),i.stroke(),i.restore()},t}()),Jn=(Qn.EnumLoopType_ManualScan=3,Qn._defaultConfig={autoScan:{enableAutoScan:!1},autoDetect:{enableAutoDetect:!1},enableBorderDetection:!0},new Map),Zn=new Map,Kn=new Map,$n=function(){function e(e){this._cameraMng=null,this._cameraView=null,this._uiRouters=null,this.captureLoop=null,this.filterApplyToAllValue=void 0,this.curFilterValue=void 0,this._runPlaying=!1,this._loadingConfig={imageSource:null,background:"rgba(0, 0, 0, 0.2)"},this._loadingNumber=0,this.config={},this._container=null,this._savedFilename=null,this._externalViewerUid=null,this._oPub=null,this._areaDetectCallback=null,this._perspectiveCallback=null,this._licenseCallback=null,this._filterHandleList=[],this._savePhotoCallback=null,this._insertPhotoCallback=null,this._removeImageCallback=null,this._changeIndexCallback=null,this._freeCallback=null,this._loadCallback=null,this._exiting=!1,this._oPub=e,this._cameraMng=new Wn(this._oPub),this._cameraView=new Xn(this._oPub,this._cameraMng.videoEl),this._uiRouters=new Yn,this.captureLoop=new Qn(this),document.addEventListener("click",er),window.addEventListener("focus",nr),window.addEventListener("blur",tr)}var t=e.prototype;return t.bindView=function(e){return(e=M(e=void 0===e?this._container:e)?document.getElementById(e):e)?(this._cameraView||(this._cameraView=new Xn(this._oPub,this._cameraMng.videoEl)),this.captureLoop||(this.captureLoop=new Qn(this)),this._cameraView.bindView(e),this._container=e,!0):(ot(this._oPub,P.VIDEO_ELEMENT_REQUIRED),!1)},t.unbindView=function(){var e;return(this._container=null)!=(e=this._cameraView)&&e.dispose(),(this._cameraView=null)!=(e=this.captureLoop)&&e.dispose(),this.captureLoop=null,document.body.classList.remove(B.overflowHidden),!0},t.getVideoElement=function(){return this._cameraMng.videoEl},t.getCameraView=function(){return this._cameraView},t.play=function(){var a=S(E().mark(function e(t,n,r,i,a){var o,s,c,u;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===a&&(a=!1),this._checkLicense()){e.next=4;break}return e.abrupt("return",{width:0,height:0});case 4:if(!a&&this._runPlaying)return e.abrupt("return",Promise.reject(P.VIDEO_NOT_STOP));e.next=6;break;case 6:if(t&&(t instanceof HTMLElement||rr(this._oPub,typeof t,"HTMLElement"),this.bindView(t)),this._container){e.next=9;break}return e.abrupt("return",Promise.reject(P.VIDEO_ELEMENT_REQUIRED));case 9:if(void 0===n||at(n)||rr(this._oPub,typeof n,"number"),void 0===r||at(r)||rr(this._oPub,typeof r,"number"),this._runPlaying=!0,e.prev=12,s=this._cameraMng.getCurrentCamera()){e.next=18;break}return e.next=17,this._cameraMng.selectCamera();case 17:s=e.sent;case 18:return null==i?(c=$.scannerViewer.fullScreen,this.config&&this.config.scannerViewer&&null!=this.config.scannerViewer.fullScreen&&(c=this.config.scannerViewer.fullScreen),s.setFillMode(c)):s.setFillMode(i),e.next=21,s.play(n,r,this._cameraMng);case 21:return o=e.sent,c=this.config.scannerViewer,u=(void 0===c?{}:c).torch,(u=void 0===u?{}:u).enableTorch?u.on=!0:u.on=!1,e.next=27,qe(this);case 27:e.next=33;break;case 29:return e.prev=29,e.t0=e.catch(12),this._setStopPlayingFlag(),e.abrupt("return",Promise.reject(e.t0));case 33:return e.abrupt("return",o);case 34:case"end":return e.stop()}},e,this,[[12,29]])}));return function(e,t,n,r,i){return a.apply(this,arguments)}}(),t.pause=function(){var e=this._cameraMng.getCurrentCamera();e&&e.pause()},t.stop=function(){var e=this._cameraMng.getCurrentCamera();e&&(this._setStopPlayingFlag(),e.stop())},t.resume=function(){var e=this._cameraMng.getCurrentCamera();e&&e.resume()},t.getStatus=function(){var e=this._cameraMng.getCurrentCamera();return e?e.getStatus():""},t.capture=function(e){var t=this._cameraMng.getCurrentCamera();return t?t.capture(e):Promise.reject(P.NO_CAMERA_SELECTED)},t.setImageDataBack=function(e){var t=this._cameraMng.getCurrentCamera();return t?t.setImageDataBack(e):(ot(this._oPub,P.NO_CAMERA_SELECTED),null)},t.getSourceList=function(){return this._cameraMng.getAllCamerasInfo()},t.selectSource=function(){var t=S(E().mark(function e(t){var n;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._cameraMng.selectCamera(t);case 2:if(n=e.sent,this._setStopPlayingFlag(),n){e.next=6;break}return e.abrupt("return",Promise.reject(P.SOURCE_NOT_FOUND));case 6:return e.abrupt("return",null==n?void 0:n.getCameraInfo());case 7:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),t._setStopPlayingFlag=function(){var e=this.config.scannerViewer,e=(void 0===e?{}:e).torch;(void 0===e?{}:e).on=!1,qe(this),this._runPlaying=!1},t.closeSource=function(){var e=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._cameraMng.getCurrentCamera())return this._setStopPlayingFlag(),t=t.getCameraInfo(),this._cameraMng.closeCamera(),e.abrupt("return",t);e.next=6;break;case 6:return this._runPlaying=!1,e.abrupt("return",Promise.reject(P.NO_CAMERA_SELECTED));case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.getCurrentSource=function(){var e=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._cameraMng.getCurrentCamera())return e.abrupt("return",t.getCameraInfo());e.next=3;break;case 3:return e.abrupt("return",null);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.getCurrentResolution=function(){var e=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._cameraMng.getCurrentCamera())return e.abrupt("return",t.getCurrentResolution());e.next=3;break;case 3:return e.abrupt("return",Promise.reject(P.NO_CAMERA_SELECTED));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.getResolution=function(){var e=S(E().mark(function e(){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._cameraMng.getCurrentCamera())return e.abrupt("return",t.getResolutions());e.next=3;break;case 3:return e.abrupt("return",Promise.reject(P.NO_CAMERA_SELECTED));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.setResolution=function(){var t=S(E().mark(function e(t){var n,r,i;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._cameraMng.getCurrentCamera())return it(t),t.width<=0||t.height,r=this.config.scannerViewer,r=(void 0===r?{}:r).torch,(r=void 0===r?{}:r).enableTorch?r.on=!0:r.on=!1,e.next=9,n.setResolution(t.width,t.height);e.next=13;break;case 9:return i=e.sent,e.next=12,qe(this);case 12:return e.abrupt("return",i);case 13:return e.abrupt("return",Promise.reject(P.NO_CAMERA_SELECTED));case 14:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),t.getVideoSetting=function(){var e=this._cameraMng.getCurrentCamera();return e?e.getVideoSetting():(ot(this._oPub,P.NO_CAMERA_SELECTED),null)},t.toggleCamera=function(){var n=S(E().mark(function e(t,n){var r,i,a;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._cameraMng.getCurrentCamera())return i=this.config.scannerViewer,i=(void 0===i?{}:i).torch,(i=void 0===i?{}:i).enableTorch?i.on=!0:i.on=!1,e.next=7,r.toggleCamera(t,n,this._cameraMng);e.next=11;break;case 7:return a=e.sent,e.next=10,qe(this);case 10:return e.abrupt("return",a);case 11:return e.abrupt("return",Promise.reject(P.NO_CAMERA_SELECTED));case 12:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),t.getCapabilities=function(){var e=this._cameraMng.getCurrentCamera();return e?e.getCapabilities():{}},t.turnOnTorch=function(){var e=this._cameraMng.getCurrentCamera();return e?e.turnOnTorch():Promise.reject(P.NO_CAMERA_SELECTED)},t.turnOffTorch=function(){var e=this._cameraMng.getCurrentCamera();return e?e.turnOffTorch():Promise.reject(P.NO_CAMERA_SELECTED)},t.isTorch=function(){var e=this.config.scannerViewer,e=(void 0===e?{}:e).torch;return(void 0===e?{}:e).on},t.show=function(){return!!this._container&&this.bindView()},t.isHidden=function(){return!this._container},t.hide=function(){this.unbindView()},t.getAreaDetectCallback=function(){return this._areaDetectCallback},t.getPerspectiveCallback=function(){return this._perspectiveCallback},t.getLicenseCallback=function(){return this._licenseCallback},t.getSavePhotoCallback=function(){return this._savePhotoCallback},t.getInsertPhotoCallback=function(){return this._insertPhotoCallback},t.getRemovePhotoCallback=function(){return this._removeImageCallback},t.getChangeIndexCallback=function(){return this._changeIndexCallback},t.getFreeHandle=function(){return this._freeCallback},t.getLoadCallback=function(){return this._loadCallback},t.bindAreaDetectFunction=function(e){return!!V(e)&&(this._areaDetectCallback=e,!0)},t.bindPerspectiveFunction=function(e){return!!V(e)&&(this._perspectiveCallback=e,!0)},t.bindLicenseCallback=function(e){return!!V(e)&&(this._licenseCallback=e,!0)},t.bindLoadHandle=function(e){return!!V(e)&&(this._loadCallback=e,!0)},t.bindFilterHandleList=function(e){return!!rt(e)&&(this._filterHandleList=e,!0)},t.bindFreeHandle=function(e){return!!V(e)&&(this._freeCallback=e,!0)},t.bindSavePhotoCallback=function(e){return!!V(e)&&(this._savePhotoCallback=e,!0)},t.bindInsertPhotoCallback=function(e){return!!V(e)&&(this._insertPhotoCallback=e,!0)},t.bindRemovePhotoCallback=function(e){return!!V(e)&&(this._removeImageCallback=e,!0)},t.bindChangeIndexCallback=function(e){return!!V(e)&&(this._changeIndexCallback=e,!0)},t.showDocumentScanPage=function(){var n=S(E().mark(function e(t,n){var o,s,r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),this.captureLoop||(this.captureLoop=new Qn(this)),o=this._uiRouters.showDocumentScanPage(t,n,this),s=this,r=function(){var r=S(E().mark(function e(t,n,r){var i,a;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.insertDataByIndex(t,n,r),a={action:"add",fileName:o.getFileName(),fromViewerBufferChanged:!1},e.next=4,s.syncFile(a,[i]);case 4:case"end":return e.stop()}},e)}));return function(e,t,n){return r.apply(this,arguments)}}(),this.bindInsertPhotoCallback(r),r=function(){var n=S(E().mark(function e(t,n){var r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.removeDataByIndex(t,n),r={action:"remove",fileName:o.getFileName(),fromViewerBufferChanged:!1},e.next=4,s.syncFile(r);case 4:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),this.bindRemovePhotoCallback(r),e.next=10,o.playVideo();case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),t.showInsertPage=function(){var n=S(E().mark(function e(t,n){var r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),r=this._uiRouters.showInsertPage(t,n,this),e.next=4,r.playVideo();case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),t.showDocumentEditPage=function(e,t){return this._uiRouters.showDocumentEditPage(e,t,this)},t.showCropPage=function(e,t){return this._uiRouters.showCropPage(e,t,this)},t.navigateToPage=function(){var n=S(E().mark(function e(t,n){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._uiRouters.navigateTo(t,n));case 1:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),t.destroyRemovedPages=function(){return this._uiRouters.destroyRemovedPages()},t.navigateBack=function(){var n=S(E().mark(function e(t,n){var r,i,a,o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=!0),r=o=!0,1==(t=void 0===t?1:t)&&(r=o=!1),this._uiRouters.navigatePopPageSync(t,o),e.next=7,this._uiRouters.resetCurrentPageAfterPopPage(r);case 7:if(i=e.sent,a=this._uiRouters.getRemovedPages(),1!=t){e.next=14;break}if(i)return e.next=13,i.show();e.next=13;break;case 13:a[0].hide();case 14:if(n&&this._uiRouters.destroyRemovedPages(),(!i||i instanceof N)&&this._cameraMng.getCurrentCamera()&&this.closeSource(),!i){e.next=20;break}i instanceof N&&(o=i.element.children[1],this.bindView(o),i.pageName==K&&i.getDcs().emit("focusPage")),e.next=22;break;case 20:return this.unbindView(),e.abrupt("return",[]);case 22:return e.abrupt("return",a);case 23:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),t.redirectToHome=function(){var e=S(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._uiRouters.redirectToHome());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.closeAllPages=function(){var e;this._uiRouters.closeAllPages(),null!=(e=this._container)&&e.classList.remove(B.relative),this._cameraMng.getCurrentCamera()&&this.closeSource(),document.body.classList.remove(B.overflowHidden)},t._checkLicense=function(){return!this._licenseCallback||(0===this._licenseCallback().errorCode||(ot(this._oPub,P.LICENSE_INVALID),!1))},t.showLoading=function(e){this._loadingNumber++,e&&T.log(["show loading: ",e,", num: ",this._loadingNumber].join(""));var t,n,e=this.getCurrentPage(),r={background:this._loadingConfig.background};e instanceof zt?(t=(t=null==(t=e.options)||null==(t=t.documentEditorSettings)?void 0:t.bodyStyle)||R(this.config.documentEditorSettings,"bodyStyle"),e.options&&e.options.documentEditorSettings&&(r.wrapperEl=e.options.documentEditorSettings.element,r.wrapperEl&&(r.confined=!0))):e instanceof N&&(t=(t=null==(n=e.options)||null==(n=n.scannerViewer)?void 0:n.bodyStyle)||R(this.config.scannerViewer,"bodyStyle"),e.options&&e.options.scannerViewer&&(r.wrapperEl=e.options.scannerViewer.element,r.wrapperEl&&(r.confined=!0))),t&&M(t.loaderBarSource)&&""!=t.loaderBarSource&&(r.imageSource=t.loaderBarSource),this._loadingConfig.imageSource!==r.imageSource&&(this._loadingConfig.imageSource=r.imageSource,C.Lib.hideMask()),C.Lib.showMask(r)},t.setLoadingNumber=function(e){this._loadingNumber=e},t.hideLoading=function(e){this._loadingNumber--,e&&T.log(["hide loading: ",e,", num: ",this._loadingNumber].join("")),this._loadingNumber<1&&(C.Lib.hideMask(),this._loadingNumber=0)},t.getDetectArea=function(e){return Ie(e,this)},t.filterHandler=function(){var n=S(E().mark(function e(t,n){var r,i;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=R(this.config,"documentEditorSettings.filter"),r=r.valueList,i=this._filterHandleList,e.abrupt("return",function(){return De.apply(this,arguments)}(this,t,i,r,n));case 4:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),t.filterHandlerByIImageData=function(){var r=S(E().mark(function e(t,n,r){var i;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.config.documentEditorSettings,i=(void 0===i?{}:i).filter,i=(void 0===i?{}:i).valueList,e.abrupt("return",function(){return Se.apply(this,arguments)}(t,n,this._filterHandleList,i,r));case 4:case"end":return e.stop()}},e,this)}));return function(e,t,n){return r.apply(this,arguments)}}(),t.packageBlobItemFromIImageData=function(e,t,n,r,i){return ye(e,this,t=void 0===t?!1:t,n=void 0===n?!1:n,r=void 0===r?!1:r,null,i)},t.on=function(e,t){this._oPub.on(e,t)},t.once=function(e,t){this._oPub.once(e,t)},t.off=function(e,t){this._oPub.off(e,t)},t.emit=function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this._oPub).emit.apply(t,[e].concat(r))},t.getCurrentPage=function(){return this._uiRouters.currentPage},t.getPreviousPage=function(){return this._uiRouters.previousPage},t.getPreviousPageByPage=function(e){for(var t=this._uiRouters.path,n=-1,r=0;r<t.length;r++)if(e==t[r]){n=r;break}return 0<n?t[n-1]:null},t.dispose=function(){var e;document.removeEventListener("click",er),window.removeEventListener("focus",nr),window.removeEventListener("blur",tr),Jn.clear(),Zn.clear(),(this._container=null)!=(e=this._cameraView)&&e.dispose(),(this._cameraView=null)!=(e=this._cameraMng)&&e.destroy(),(this._cameraMng=null)!=(e=this._uiRouters)&&e.closeAllPages(),(this._uiRouters=null)!=(e=this.captureLoop)&&e.dispose(),this.captureLoop=null,this._areaDetectCallback=null,this._perspectiveCallback=null,this._licenseCallback=null,this._filterHandleList=[],this._savePhotoCallback=null,this._insertPhotoCallback=null,this._removeImageCallback=null,this._changeIndexCallback=null,this._freeCallback=null,this._loadCallback=null},t.addGlobalClickEvent=function(e,t){var n;V(t)&&(n=this,Jn.set(e,function(e){t(e,n)&&n.removeGlobalClickEvent(e)}))},t.removeGlobalClickEvent=function(e){Jn.delete(e)},t.addGlobalBlurEvent=function(e,t){var n;V(t)&&(n=this,Zn.set(e,function(e){t(e,n)&&n.removeGlobalBlurEvent(e)}))},t.removeGlobalBlurEvent=function(e){Zn.delete(e)},t.addGlobalFocusEvent=function(e,t){var n;V(t)&&(n=this,Kn.set(e,function(e){t(e,n)&&n.removeGlobalBlurEvent(e)}))},t.removeGlobalFocusEvent=function(e){Kn.delete(e)},t.getCameraManage=function(){return this._cameraMng},t.isRunPlaying=function(){return this._runPlaying},t.setSavedFilename=function(e){this._savedFilename=e},t.getSavedFilename=function(){return this._savedFilename},t.setExternalViewerUid=function(e){e&&(this._externalViewerUid=e)},t.getExternalViewerUid=function(){return this._externalViewerUid},t.openSavedFile=function(e){var t=this.getSavedFilename();return t?(T.log("open file: "+t),e.File.openFile(t)):(T.log("open file: "+Z),e.File.openFile(Z)),!0},t.clearExitFlag=function(){this._exiting=!1},t.exit=function(e){this._exiting=!0,this._freeCallback&&this._freeCallback(),document.body.classList.remove(B.overflowHidden),this._savedFilename&&(this._savedFilename=null)},t.syncFile=function(){var n=S(E().mark(function e(t,n){var r,i,a,o,s;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._exiting)return e.abrupt("return");e.next=2;break;case 2:if(i=!1,!t){e.next=13;break}if("remove"!=t.action){e.next=8;break}e.next=12;break;case 8:if("add"!=t.action){e.next=11;break}e.next=12;break;case 11:return e.abrupt("return");case 12:void 0!==t.fromViewerBufferChanged&&(i=t.fromViewerBufferChanged);case 13:if(!(0<(a=this._uiRouters.path).length)){e.next=60;break}if((s=a[a.length-1])instanceof zt&&(o=s.getCurrentEditUid()),!((r=a[0])instanceof N)){e.next=32;break}if(1<a.length)return r=a[1],e.next=23,r.syncFileFromExternalEvent(i,n);e.next=30;break;case 23:if(!(2<a.length)){e.next=30;break}if(!((r=a[2])instanceof Vn)){e.next=28;break}e.next=30;break;case 28:return e.next=30,r.syncFileFromExternalEvent(i,n);case 30:e.next=41;break;case 32:return e.next=34,r.syncFileFromExternalEvent(i);case 34:if(!(1<a.length)){e.next=41;break}if(!((r=a[1])instanceof Vn)){e.next=39;break}e.next=41;break;case 39:return e.next=41,r.syncFileFromExternalEvent(i);case 41:if(!s){e.next=60;break}if(M(o)&&""!=o){e.next=48;break}if(s instanceof Vn)return e.abrupt("return");e.next=47;break;case 47:o=s.getCurrentEditUid();case 48:if(!(s instanceof y)){e.next=58;break}if(s.isInsertingImage())return e.next=52,s.clearInserting();e.next=54;break;case 52:e.next=56;break;case 54:return e.next=56,s.setEditUidAfterSyncImages(o);case 56:e.next=60;break;case 58:return e.next=60,s.setEditUidAfterSyncImages(o);case 60:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}(),e}();function er(e){Jn.forEach(function(e,t){V(e)&&e(t)})}function tr(e){Zn.forEach(function(e,t){V(e)&&e(t)})}function nr(e){Kn.forEach(function(e,t){V(e)&&e(t)})}function rr(e,t,n){e&&e.emit("typeError",t,n)}var ir=function(t){function e(e){var n=t.call(this,e)||this;return n.errorMessage="ok",n.errorCode=0,n._on(q,n.updateErrorMessage.bind(a(n))),n._on("error",function(e){var t=new Error(e.message);t.code=e.code,n._throwErr(t)}),n._on("typeError",function(e,t){e=new Error("Argument of type '"+e+"' is not assignable to parameter of type '"+t+"'.");e.code=-4212,n._throwErr(e)}),n._on("valueError",function(e,t){e=new Error("The argument '"+e+"' is not valid for the parameter '"+t+"'");e.code=-4213,n._throwErr(e)}),n}o(e,t);var n=e.prototype;return n.updateErrorMessage=function(e){this.errorMessage=e.message,this.errorCode=e.code},n._throwErr=function(e){throw this.updateErrorMessage(e),e},e}(e),n=function(a){function e(){var e=a.call(this,new dt)||this;return e.Error=null,e.videoShown=!1,e._dvs=null,e._dcs=null,e.Error=new ir(e._oPub),e._dcs=new $n(e._oPub),e}o(e,a);var t=e.prototype;return t.notBindCamera=function(){return!this._dvs},t.bindCamera=function(e,t){(this._dvs=t).ViewControl.bindViewUiConstructor(e),this._dcs.off("video-closed"),this._dcs.off("video-error");var n=this;return this._dcs.on("video-closed",function(){var e;n.videoShown=!1,L(n._dcs),null!=(e=t._oPub)&&e.emit("video-closed")}),this._dcs.on("video-error",function(e){t._oPub.emit("video-error",e)}),this._e(r),!0},t.bindAreaDetectFunction=function(e){return V(e)?(this._dcs.bindAreaDetectFunction(e),this._e(r),!0):(this._e(O),!1)},t.bindPerspectiveFunction=function(e){return V(e)?(this._dcs.bindPerspectiveFunction(e),this._e(r),!0):(this._e(O),!1)},t.bindLicenseCallback=function(e){return V(e)?(this._dcs.bindLicenseCallback(e),this._e(r),!0):(this._e(O),!1)},t.bindSavePhotoCallback=function(e){return V(e)?(this._dcs.bindSavePhotoCallback(e),this._e(r),!0):(this._e(O),!1)},t.bindInsertPhotoCallback=function(e){return V(e)?(this._dcs.bindInsertPhotoCallback(e),this._e(r),!0):(this._e(O),!1)},t.bindRemovePhotoCallback=function(e){return V(e)?(this._dcs.bindRemovePhotoCallback(e),this._e(r),!0):(this._e(O),!1)},t.bindFilterHandleList=function(e){return this._dcs.bindFilterHandleList(e),this._e(r),!0},t.bindFreeHandle=function(e){return rt(e)?(this._dcs.bindFreeHandle(e),this._e(r),!0):(this._e(O),!1)},t._e=function(e){a.prototype._emit.call(this,q,e)},t.dispose=function(){var e;a.prototype.dispose.call(this),null!=(e=this.Error)&&e.dispose(),this.Error=null,this._dcs&&(this._dcs.exit(this._dvs),this._dcs.off("video-closed"),this._dcs.off("video-error"),this._dcs.dispose()),this._dcs=null},t.on=function(e,t){a.prototype._on.call(this,e,t)},t.emit=function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=a.prototype._emit).call.apply(t,[this,e].concat(r))},t.off=function(e,t){a.prototype._off.call(this,e,t)},e}(e),e=function(e){function t(){return e.call(this)||this}o(t,e);var n=t.prototype;return n.showVideo=function(){var n=S(E().mark(function e(t,n){var r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.videoShown)return e.abrupt("return",Promise.reject(W));e.next=2;break;case 2:if(t){e.next=4;break}return e.abrupt("return",Promise.reject(j));case 4:if(this._dvs){e.next=6;break}return e.abrupt("return",Promise.reject(H));case 6:return this.videoShown=!0,(r=b(t,h($))).scannerViewer&&(this._dcs.config.scannerViewer=r.scannerViewer),r.documentEditorSettings&&(this._dcs.config.documentEditorSettings=r.documentEditorSettings),r.saveData=!0,r.fromInternal=!0,e.prev=12,this._dcs.clearExitFlag(),this._dcs.setSavedFilename(n),e.next=17,this._dcs.showDocumentScanPage(r,this._dvs);case 17:e.next=23;break;case 19:throw e.prev=19,e.t0=e.catch(12),this.videoShown=!1,e.t0;case 23:return this.videoShown=!0,e.next=26,this._dcs.getCurrentResolution();case 26:return e.abrupt("return",e.sent);case 27:case"end":return e.stop()}},e,this,[[12,19]])}));return function(e,t){return n.apply(this,arguments)}}(),n.closeVideo=function(){this._dcs.closeAllPages(),this._dcs.exit(this._dvs)},t}(n),n=function(e){function t(){return e.call(this)||this}o(t,e);var n=t.prototype;return n.createEditPage=function(e,t){if(!t)throw j;var n=t.fileName;if(!M(n)||""==n)throw G;var r=t.viewerUid,t=b(t,h($));t.initFileName=n,t.scannerViewer&&(this._dcs.config.scannerViewer=t.scannerViewer,delete t.scannerViewer);var i,a,o=!0;return t.documentEditorSettings&&(this._dcs.config.documentEditorSettings=t.documentEditorSettings,(void 0===(a=t.documentEditorSettings.defaultViewerName)?te:a).toLowerCase()==te.toLowerCase()?(i="crop",M(a=null==(a=this._dcs.config)||null==(a=a.documentEditorSettings)||null==(a=a.cropViewer)?void 0:a.visibility)&&"hidden"==a.toLowerCase()&&(o=!1)):i="edit"),this._dcs.setSavedFilename(n),this._dcs.setExternalViewerUid(r),t.saveData=!0,t.fromInternal=!1,t.curIndex=e,t.doFillData=!0,this._dcs.clearExitFlag(),"crop"==i&&o?this._dcs.showCropPage(t,this._dvs):this._dcs.showDocumentEditPage(t,this._dvs)},n.syncFile=function(e){this._dcs.syncFile(e)},n.removeEditPage=function(e){try{L(this._dcs),this._dcs.closeAllPages(),this._dcs.stop(),this._dcs.exit(null),e.isDestroyed||e.destroy()}catch(e){return!1}return!0},t}(n);window.Dynamsoft||(window.Dynamsoft={}),window.Dynamsoft.CameraViewer=$n,window.Dynamsoft.CameraModel=e,window.Dynamsoft.DocumentEditManager=n}();
});
Dynamsoft.AddonReady(function(d,e){var t;d.product.bHTML5Edition&&!Dynamsoft.navInfoSync.bIE&&(d.DynamicLoadAddonFuns&&d.DynamicLoadAddonFuns.push(function(e){function t(){this._stwain=e,this._viewer=null}t.prototype._getCameraViewer=function(){var e;return null==this._viewer&&(d.log("camera addon: bind viewer."),e=this._stwain,d.product.appendBrowserLicenseWhenServiceMode(e),this._viewer=new Dynamsoft.CameraViewer,e._ImgManager)&&e._ImgManager.getWebViewer()&&e._ImgManager.getWebViewer().bindCameraForCameraManager(),this._viewer},t.prototype._checkWasmAndLic=function(){var e=!0,t=this._stwain;return!e||t._isMobileMode()||Dynamsoft.DWT.UseCameraAddonWasm||(d.Errors.WasmNotLoaded_UseWasmFalse(t),e=!1),e&&!d.detect.wasmScriptLoaded&&(d.Errors.WasmNotLoaded(t),e=!1),!(e=e&&!d.License.checkProductKey(t,{Core:!0})?!1:e)&&{code:t._errorCode,message:t._errorString}},t.prototype.getSourceList=function(){var e=this,t=this._stwain,r=e._checkWasmAndLic();return r?d.Promise.reject(r):d.product.appendBrowserLicenseWhenServiceMode(t).then(function(){return e._getCameraViewer().getSourceList()})},t.prototype.selectSource=function(e){var t=this,r=this._stwain,i=t._checkWasmAndLic();return i?d.Promise.reject(i):(null!=this._viewer&&t._getCameraViewer().hide(),d.product.appendBrowserLicenseWhenServiceMode(r).then(function(){return t._getCameraViewer().selectSource(e)}))},t.prototype.closeSource=function(){var e,t=this._checkWasmAndLic();return t?d.Promise.reject(t):(t=!0,null!=this._viewer&&(this._getCameraViewer().hide(),t=this._getCameraViewer().closeSource(),this._stwain._ImgManager)&&this._stwain._ImgManager.getWebViewer()&&this._stwain._ImgManager.getWebViewer().SetWidth(this._stwain._ImgManager.getWebViewer().GetWidth()),(e=document.getElementById("dynamsoft_camera_inner_play"))&&e.parentNode.removeChild(e),t)},t.prototype.play=function(a,n,o){var s=this,e=this._stwain,c=e._ImgManager.getWebViewer(),t=s._checkWasmAndLic();return t?d.Promise.reject(t):d.License.checkProductKey(e,{Core:!0})?c&&c._imageEditorInner&&c._imageEditorInner.bShowImageEditForFullScreen?(d.Errors.ImageEditorOpenCannotPlayVideo(e),d.Promise.reject({code:e._errorCode,message:e._errorString})):d.product.appendBrowserLicenseWhenServiceMode(e).then(function(){if(!d.License.checkCameraProductKey(e))return d.Promise.reject({code:e._errorCode,message:e._errorString})}).then(function(){var e,t,r,i=a;return!i&&c&&(!c.myViewer||!c.myViewer.bOnlyShowThumbnailsView&&c.myViewer.showMain?(r=d.one(["#container",c.GetIdPostfix()].join("")))&&0<r.length&&r[0].className.indexOf("DVS_disabled")<0&&(i=r[0]):(r=d.one(["#showImageArea",c.GetIdPostfix()].join("")))&&0<r.length&&r[0].className.indexOf("DVS_disabled")<0&&(i=r[0])),i?("object"==typeof n&&(e=n.width,t=n.height),i&&"DIV"==i.nodeName||((i=document.getElementById(i)).offsetHeight||i.scrollHeight||i.clientHeight)&&(i.offsetWidth||i.scrollWidth||i.clientWidth)||((r=document.createElement("div")).id="dynamsoft_camera_inner_play",i.appendChild(r),i=r),i.offsetHeight||i.scrollHeight||i.clientHeight||(i.style.height="200px"),i.offsetWidth||i.scrollWidth||i.clientWidth||(i.style.width="200px"),s._getCameraViewer().show()):((r=s._getCameraViewer())&&r.hide(),c&&c.render()),d.log("camera addon: play."),d.isUndefined(o)&&(o=!1),s._getCameraViewer().play(i,e,t,o)}):d.Promise.reject({code:e._errorCode,message:e._errorString})},t.prototype.pause=function(){return d.log("camera addon: pause."),this._getCameraViewer().pause()},t.prototype.resume=function(){return d.log("camera addon: resume."),this._getCameraViewer().resume()},t.prototype.getStatus=function(){return d.log("camera addon: get status."),null==this._viewer?"":this._getCameraViewer().getStatus()},t.prototype.capture=function(){var e=this,s=this._stwain,t=e._checkWasmAndLic();return t?d.Promise.reject(t):d.License.checkProductKey(s,{Core:!0})?d.product.appendBrowserLicenseWhenServiceMode(s).then(function(){if(!d.License.checkCameraProductKey(s))return d.Promise.reject({code:s._errorCode,message:s._errorString})}).then(function(){return d.log("camera addon: start capture."),e._getCameraViewer().capture().then(function(o){return d.log("camera addon: captured."),new d.Promise(function(e,r){var t,i=o.imageData||o.blob,a=-1,n=Dynamsoft.DWT.EnumDWT_ImageType;s._isMobileMode()?(""==(t=s.GetCurrentDocumentName())&&(t=s._ImgManager.getWebViewer().GetDefaultFileName()),s._innerSendToMobile("LoadImageFromBinary",[i,3006,null,t],0,function(){d.log("camera addon: loaded image from capture."),e(i)},function(e,t){d.log("camera addon: failed to load image from capture."),r({code:e,message:t})})):(d.isString(i.type)&&("application/pdf"==i.type?a=n.IT_PDF:"image/png"==i.type?a=n.IT_PNG:"image/jpeg"==i.type||"image/jpg"==i.type?a=n.IT_JPG:"image/bmp"==i.type?a=n.IT_BMP:"image/tiff"==i.type||"image/tif"==i.type?a=n.IT_TIF:"image/jp2"==i.type&&(a=n.IT_J2K)),s.__captureImage(i,a,function(){d.log("camera addon: loaded image from capture."),e(i)},function(e,t){d.log("camera addon: failed to load image from capture."),r({code:e,message:t})}))})})}):d.Promise.reject({code:s._errorCode,message:s._errorString})},t.prototype.stop=function(){null!=this._viewer&&(this._getCameraViewer().hide(),d.log("camera addon: stop."),this._getCameraViewer().stop(),this._stwain._ImgManager)&&this._stwain._ImgManager.getWebViewer()&&(this._stwain._ImgManager.getWebViewer().SetWidth(this._stwain._ImgManager.getWebViewer().GetWidth()),this._stwain._ImgManager.getWebViewer().render());var e=document.getElementById("dynamsoft_camera_inner_play");return e&&e.parentNode.removeChild(e),!0},t.prototype.show=function(){if(d.log("camera addon: show."),null!=this._viewer)return this._getCameraViewer().show()},t.prototype.hide=function(){if(d.log("camera addon: hide."),null!=this._viewer)return this._getCameraViewer().hide()},t.prototype.getCurrentResolution=function(){return d.log("camera addon: get current resolution."),null==this._viewer?0:this._getCameraViewer().getCurrentResolution()},t.prototype.getCurrentSource=function(){return d.log("camera addon: get current source."),null==this._viewer?"":this._getCameraViewer().getCurrentSource()},t.prototype.getResolution=function(){var e=this._checkWasmAndLic();return e?d.Promise.reject(e):null==this._viewer?0:(d.log("camera addon: get resolution."),this._getCameraViewer().getResolution())},t.prototype.setResolution=function(e){var t=this._checkWasmAndLic();return t?d.Promise.reject(t):null!=this._viewer&&(d.log("camera addon: set resolution."),this._getCameraViewer().setResolution(e))},t.prototype.showVideo=function(e,t,r,i){var a=this._checkWasmAndLic();return a?d.Promise.reject(a):null!=this._viewer&&(this._getCameraViewer(),d.log("camera addon: show video."),!(!this._stwain._ImgManager||!this._stwain._ImgManager.getWebViewer()))&&this._stwain._ImgManager.getWebViewer().showVideo(e,t,r,i)},t.prototype.scanDocument=function(e){var t=this,r=this._stwain,i=t._checkWasmAndLic();return i?d.Promise.reject(i):d.product.appendBrowserLicenseWhenServiceMode(r).then(function(){return d.License.checkCameraProductKey(r)?(t._getCameraViewer(),d.log("camera addon: scan document."),r._ImgManager.getWebViewer().showVideoEx(e)):d.Promise.reject({code:r._errorCode,message:r._errorString})})},t.prototype.closeVideo=function(){var e=this._checkWasmAndLic();return e?d.Promise.reject(e):null!=this._viewer&&(d.log("camera addon: close video."),!(!this._stwain._ImgManager||!this._stwain._ImgManager.getWebViewer()))&&this._stwain._ImgManager.getWebViewer().closeVideo()},t.prototype.turnOnTorch=function(){return d.log("camera addon: turnOnTorch."),null!=this._viewer&&this._getCameraViewer().turnOnTorch()},t.prototype.turnOffTorch=function(){return d.log("camera addon: turnOffTorch."),null!=this._viewer&&this._getCameraViewer().turnOffTorch()},t.prototype.getCapabilities=function(){return d.log("camera addon: getCapabilities."),null!=this._viewer&&this._getCameraViewer().getCapabilities()},t.prototype.on=function(e,t){"video-closed"!=e&&"video-error"!=e?d.Errors.EventNotExist(this._stwain):d.isFunction(t)?(d.log("camera addon: add event "+e),this._stwain._ImgManager&&this._stwain._ImgManager.getWebViewer()?this._stwain._ImgManager.getWebViewer().camera_on(e,t):t()):d.Errors.CallbackNotAFunction(this._stwain)},t.prototype.off=function(e,t){"video-closed"!=e||"video-error"!=e?d.Errors.EventNotExist(this._stwain):d.isUndefined(t)?this._stwain._ImgManager&&this._stwain._ImgManager.getWebViewer()&&this._stwain._ImgManager.getWebViewer().off(e):d.isFunction(t)?(d.log("camera addon: remove event "+e),this._stwain._ImgManager&&this._stwain._ImgManager.getWebViewer()?this._stwain._ImgManager.getWebViewer().off(e,t):t()):d.Errors.CallbackNotAFunction(this._stwain)},e.__addon=e.__addon||{},e.__addon.Camera=new t}),t=[Dynamsoft.DWT.ResourcesPath,"/addon/dynamsoft.webtwain.addon.camera.css",d.timestamp].join(""),d.addCss(t))});